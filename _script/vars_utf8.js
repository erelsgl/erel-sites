/*
This file was automatically generated by:
	/_script/combine_js.php?files=_script/jquery-1.3.1.min+_script/jquery.hoverIntent.min+_script/vars0+_script/cookies+_script/rtelang/en+_script/rte+_script/elements+_script/form_validation+_script/fields+_script/arguments+_script/sites+_script/dates/dates+_script/templates+_script/magrim+http://www.google.com/friendconnect/script/friendconnect.js+_script/search+_script/etc+_script/jquery.taconite&out=_script/vars&minify=0
Don't edit it directly!
*/


/* _script/jquery-1.3.1.min */

/*
 * jQuery JavaScript Library v1.3.1
 * http://jquery.com/
 *
 * Copyright (c) 2009 John Resig
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * Date: 2009-01-21 20:42:16 -0500 (Wed, 21 Jan 2009)
 * Revision: 6158
 */
(function(){var l=this,g,y=l.jQuery,p=l.$,o=l.jQuery=l.$=function(E,F){return new o.fn.init(E,F)},D=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,f=/^.[^:#\[\.,]*$/;o.fn=o.prototype={init:function(E,H){E=E||document;if(E.nodeType){this[0]=E;this.length=1;this.context=E;return this}if(typeof E==="string"){var G=D.exec(E);if(G&&(G[1]||!H)){if(G[1]){E=o.clean([G[1]],H)}else{var I=document.getElementById(G[3]);if(I&&I.id!=G[3]){return o().find(E)}var F=o(I||[]);F.context=document;F.selector=E;return F}}else{return o(H).find(E)}}else{if(o.isFunction(E)){return o(document).ready(E)}}if(E.selector&&E.context){this.selector=E.selector;this.context=E.context}return this.setArray(o.makeArray(E))},selector:"",jquery:"1.3.1",size:function(){return this.length},get:function(E){return E===g?o.makeArray(this):this[E]},pushStack:function(F,H,E){var G=o(F);G.prevObject=this;G.context=this.context;if(H==="find"){G.selector=this.selector+(this.selector?" ":"")+E}else{if(H){G.selector=this.selector+"."+H+"("+E+")"}}return G},setArray:function(E){this.length=0;Array.prototype.push.apply(this,E);return this},each:function(F,E){return o.each(this,F,E)},index:function(E){return o.inArray(E&&E.jquery?E[0]:E,this)},attr:function(F,H,G){var E=F;if(typeof F==="string"){if(H===g){return this[0]&&o[G||"attr"](this[0],F)}else{E={};E[F]=H}}return this.each(function(I){for(F in E){o.attr(G?this.style:this,F,o.prop(this,E[F],G,I,F))}})},css:function(E,F){if((E=="width"||E=="height")&&parseFloat(F)<0){F=g}return this.attr(E,F,"curCSS")},text:function(F){if(typeof F!=="object"&&F!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(F))}var E="";o.each(F||this,function(){o.each(this.childNodes,function(){if(this.nodeType!=8){E+=this.nodeType!=1?this.nodeValue:o.fn.text([this])}})});return E},wrapAll:function(E){if(this[0]){var F=o(E,this[0].ownerDocument).clone();if(this[0].parentNode){F.insertBefore(this[0])}F.map(function(){var G=this;while(G.firstChild){G=G.firstChild}return G}).append(this)}return this},wrapInner:function(E){return this.each(function(){o(this).contents().wrapAll(E)})},wrap:function(E){return this.each(function(){o(this).wrapAll(E)})},append:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.appendChild(E)}})},prepend:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.insertBefore(E,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this)})},after:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this.nextSibling)})},end:function(){return this.prevObject||o([])},push:[].push,find:function(E){if(this.length===1&&!/,/.test(E)){var G=this.pushStack([],"find",E);G.length=0;o.find(E,this[0],G);return G}else{var F=o.map(this,function(H){return o.find(E,H)});return this.pushStack(/[^+>] [^+>]/.test(E)?o.unique(F):F,"find",E)}},clone:function(F){var E=this.map(function(){if(!o.support.noCloneEvent&&!o.isXMLDoc(this)){var I=this.cloneNode(true),H=document.createElement("div");H.appendChild(I);return o.clean([H.innerHTML])[0]}else{return this.cloneNode(true)}});var G=E.find("*").andSelf().each(function(){if(this[h]!==g){this[h]=null}});if(F===true){this.find("*").andSelf().each(function(I){if(this.nodeType==3){return}var H=o.data(this,"events");for(var K in H){for(var J in H[K]){o.event.add(G[I],K,H[K][J],H[K][J].data)}}})}return E},filter:function(E){return this.pushStack(o.isFunction(E)&&o.grep(this,function(G,F){return E.call(G,F)})||o.multiFilter(E,o.grep(this,function(F){return F.nodeType===1})),"filter",E)},closest:function(E){var F=o.expr.match.POS.test(E)?o(E):null;return this.map(function(){var G=this;while(G&&G.ownerDocument){if(F?F.index(G)>-1:o(G).is(E)){return G}G=G.parentNode}})},not:function(E){if(typeof E==="string"){if(f.test(E)){return this.pushStack(o.multiFilter(E,this,true),"not",E)}else{E=o.multiFilter(E,this)}}var F=E.length&&E[E.length-1]!==g&&!E.nodeType;return this.filter(function(){return F?o.inArray(this,E)<0:this!=E})},add:function(E){return this.pushStack(o.unique(o.merge(this.get(),typeof E==="string"?o(E):o.makeArray(E))))},is:function(E){return !!E&&o.multiFilter(E,this).length>0},hasClass:function(E){return !!E&&this.is("."+E)},val:function(K){if(K===g){var E=this[0];if(E){if(o.nodeName(E,"option")){return(E.attributes.value||{}).specified?E.value:E.text}if(o.nodeName(E,"select")){var I=E.selectedIndex,L=[],M=E.options,H=E.type=="select-one";if(I<0){return null}for(var F=H?I:0,J=H?I+1:M.length;F<J;F++){var G=M[F];if(G.selected){K=o(G).val();if(H){return K}L.push(K)}}return L}return(E.value||"").replace(/\r/g,"")}return g}if(typeof K==="number"){K+=""}return this.each(function(){if(this.nodeType!=1){return}if(o.isArray(K)&&/radio|checkbox/.test(this.type)){this.checked=(o.inArray(this.value,K)>=0||o.inArray(this.name,K)>=0)}else{if(o.nodeName(this,"select")){var N=o.makeArray(K);o("option",this).each(function(){this.selected=(o.inArray(this.value,N)>=0||o.inArray(this.text,N)>=0)});if(!N.length){this.selectedIndex=-1}}else{this.value=K}}})},html:function(E){return E===g?(this[0]?this[0].innerHTML:null):this.empty().append(E)},replaceWith:function(E){return this.after(E).remove()},eq:function(E){return this.slice(E,+E+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(E){return this.pushStack(o.map(this,function(G,F){return E.call(G,F,G)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(K,N,M){if(this[0]){var J=(this[0].ownerDocument||this[0]).createDocumentFragment(),G=o.clean(K,(this[0].ownerDocument||this[0]),J),I=J.firstChild,E=this.length>1?J.cloneNode(true):J;if(I){for(var H=0,F=this.length;H<F;H++){M.call(L(this[H],I),H>0?E.cloneNode(true):J)}}if(G){o.each(G,z)}}return this;function L(O,P){return N&&o.nodeName(O,"table")&&o.nodeName(P,"tr")?(O.getElementsByTagName("tbody")[0]||O.appendChild(O.ownerDocument.createElement("tbody"))):O}}};o.fn.init.prototype=o.fn;function z(E,F){if(F.src){o.ajax({url:F.src,async:false,dataType:"script"})}else{o.globalEval(F.text||F.textContent||F.innerHTML||"")}if(F.parentNode){F.parentNode.removeChild(F)}}function e(){return +new Date}o.extend=o.fn.extend=function(){var J=arguments[0]||{},H=1,I=arguments.length,E=false,G;if(typeof J==="boolean"){E=J;J=arguments[1]||{};H=2}if(typeof J!=="object"&&!o.isFunction(J)){J={}}if(I==H){J=this;--H}for(;H<I;H++){if((G=arguments[H])!=null){for(var F in G){var K=J[F],L=G[F];if(J===L){continue}if(E&&L&&typeof L==="object"&&!L.nodeType){J[F]=o.extend(E,K||(L.length!=null?[]:{}),L)}else{if(L!==g){J[F]=L}}}}}return J};var b=/z-?index|font-?weight|opacity|zoom|line-?height/i,q=document.defaultView||{},s=Object.prototype.toString;o.extend({noConflict:function(E){l.$=p;if(E){l.jQuery=y}return o},isFunction:function(E){return s.call(E)==="[object Function]"},isArray:function(E){return s.call(E)==="[object Array]"},isXMLDoc:function(E){return E.nodeType===9&&E.documentElement.nodeName!=="HTML"||!!E.ownerDocument&&o.isXMLDoc(E.ownerDocument)},globalEval:function(G){G=o.trim(G);if(G){var F=document.getElementsByTagName("head")[0]||document.documentElement,E=document.createElement("script");E.type="text/javascript";if(o.support.scriptEval){E.appendChild(document.createTextNode(G))}else{E.text=G}F.insertBefore(E,F.firstChild);F.removeChild(E)}},nodeName:function(F,E){return F.nodeName&&F.nodeName.toUpperCase()==E.toUpperCase()},each:function(G,K,F){var E,H=0,I=G.length;if(F){if(I===g){for(E in G){if(K.apply(G[E],F)===false){break}}}else{for(;H<I;){if(K.apply(G[H++],F)===false){break}}}}else{if(I===g){for(E in G){if(K.call(G[E],E,G[E])===false){break}}}else{for(var J=G[0];H<I&&K.call(J,H,J)!==false;J=G[++H]){}}}return G},prop:function(H,I,G,F,E){if(o.isFunction(I)){I=I.call(H,F)}return typeof I==="number"&&G=="curCSS"&&!b.test(E)?I+"px":I},className:{add:function(E,F){o.each((F||"").split(/\s+/),function(G,H){if(E.nodeType==1&&!o.className.has(E.className,H)){E.className+=(E.className?" ":"")+H}})},remove:function(E,F){if(E.nodeType==1){E.className=F!==g?o.grep(E.className.split(/\s+/),function(G){return !o.className.has(F,G)}).join(" "):""}},has:function(F,E){return F&&o.inArray(E,(F.className||F).toString().split(/\s+/))>-1}},swap:function(H,G,I){var E={};for(var F in G){E[F]=H.style[F];H.style[F]=G[F]}I.call(H);for(var F in G){H.style[F]=E[F]}},css:function(G,E,I){if(E=="width"||E=="height"){var K,F={position:"absolute",visibility:"hidden",display:"block"},J=E=="width"?["Left","Right"]:["Top","Bottom"];function H(){K=E=="width"?G.offsetWidth:G.offsetHeight;var M=0,L=0;o.each(J,function(){M+=parseFloat(o.curCSS(G,"padding"+this,true))||0;L+=parseFloat(o.curCSS(G,"border"+this+"Width",true))||0});K-=Math.round(M+L)}if(o(G).is(":visible")){H()}else{o.swap(G,F,H)}return Math.max(0,K)}return o.curCSS(G,E,I)},curCSS:function(I,F,G){var L,E=I.style;if(F=="opacity"&&!o.support.opacity){L=o.attr(E,"opacity");return L==""?"1":L}if(F.match(/float/i)){F=w}if(!G&&E&&E[F]){L=E[F]}else{if(q.getComputedStyle){if(F.match(/float/i)){F="float"}F=F.replace(/([A-Z])/g,"-$1").toLowerCase();var M=q.getComputedStyle(I,null);if(M){L=M.getPropertyValue(F)}if(F=="opacity"&&L==""){L="1"}}else{if(I.currentStyle){var J=F.replace(/\-(\w)/g,function(N,O){return O.toUpperCase()});L=I.currentStyle[F]||I.currentStyle[J];if(!/^\d+(px)?$/i.test(L)&&/^\d/.test(L)){var H=E.left,K=I.runtimeStyle.left;I.runtimeStyle.left=I.currentStyle.left;E.left=L||0;L=E.pixelLeft+"px";E.left=H;I.runtimeStyle.left=K}}}}return L},clean:function(F,K,I){K=K||document;if(typeof K.createElement==="undefined"){K=K.ownerDocument||K[0]&&K[0].ownerDocument||document}if(!I&&F.length===1&&typeof F[0]==="string"){var H=/^<(\w+)\s*\/?>$/.exec(F[0]);if(H){return[K.createElement(H[1])]}}var G=[],E=[],L=K.createElement("div");o.each(F,function(P,R){if(typeof R==="number"){R+=""}if(!R){return}if(typeof R==="string"){R=R.replace(/(<(\w+)[^>]*?)\/>/g,function(T,U,S){return S.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?T:U+"></"+S+">"});var O=o.trim(R).toLowerCase();var Q=!O.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!O.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||O.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!O.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!O.indexOf("<td")||!O.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!O.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!o.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];L.innerHTML=Q[1]+R+Q[2];while(Q[0]--){L=L.lastChild}if(!o.support.tbody){var N=!O.indexOf("<table")&&O.indexOf("<tbody")<0?L.firstChild&&L.firstChild.childNodes:Q[1]=="<table>"&&O.indexOf("<tbody")<0?L.childNodes:[];for(var M=N.length-1;M>=0;--M){if(o.nodeName(N[M],"tbody")&&!N[M].childNodes.length){N[M].parentNode.removeChild(N[M])}}}if(!o.support.leadingWhitespace&&/^\s/.test(R)){L.insertBefore(K.createTextNode(R.match(/^\s*/)[0]),L.firstChild)}R=o.makeArray(L.childNodes)}if(R.nodeType){G.push(R)}else{G=o.merge(G,R)}});if(I){for(var J=0;G[J];J++){if(o.nodeName(G[J],"script")&&(!G[J].type||G[J].type.toLowerCase()==="text/javascript")){E.push(G[J].parentNode?G[J].parentNode.removeChild(G[J]):G[J])}else{if(G[J].nodeType===1){G.splice.apply(G,[J+1,0].concat(o.makeArray(G[J].getElementsByTagName("script"))))}I.appendChild(G[J])}}return E}return G},attr:function(J,G,K){if(!J||J.nodeType==3||J.nodeType==8){return g}var H=!o.isXMLDoc(J),L=K!==g;G=H&&o.props[G]||G;if(J.tagName){var F=/href|src|style/.test(G);if(G=="selected"&&J.parentNode){J.parentNode.selectedIndex}if(G in J&&H&&!F){if(L){if(G=="type"&&o.nodeName(J,"input")&&J.parentNode){throw"type property can't be changed"}J[G]=K}if(o.nodeName(J,"form")&&J.getAttributeNode(G)){return J.getAttributeNode(G).nodeValue}if(G=="tabIndex"){var I=J.getAttributeNode("tabIndex");return I&&I.specified?I.value:J.nodeName.match(/(button|input|object|select|textarea)/i)?0:J.nodeName.match(/^(a|area)$/i)&&J.href?0:g}return J[G]}if(!o.support.style&&H&&G=="style"){return o.attr(J.style,"cssText",K)}if(L){J.setAttribute(G,""+K)}var E=!o.support.hrefNormalized&&H&&F?J.getAttribute(G,2):J.getAttribute(G);return E===null?g:E}if(!o.support.opacity&&G=="opacity"){if(L){J.zoom=1;J.filter=(J.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(K)+""=="NaN"?"":"alpha(opacity="+K*100+")")}return J.filter&&J.filter.indexOf("opacity=")>=0?(parseFloat(J.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}G=G.replace(/-([a-z])/ig,function(M,N){return N.toUpperCase()});if(L){J[G]=K}return J[G]},trim:function(E){return(E||"").replace(/^\s+|\s+$/g,"")},makeArray:function(G){var E=[];if(G!=null){var F=G.length;if(F==null||typeof G==="string"||o.isFunction(G)||G.setInterval){E[0]=G}else{while(F){E[--F]=G[F]}}}return E},inArray:function(G,H){for(var E=0,F=H.length;E<F;E++){if(H[E]===G){return E}}return -1},merge:function(H,E){var F=0,G,I=H.length;if(!o.support.getAll){while((G=E[F++])!=null){if(G.nodeType!=8){H[I++]=G}}}else{while((G=E[F++])!=null){H[I++]=G}}return H},unique:function(K){var F=[],E={};try{for(var G=0,H=K.length;G<H;G++){var J=o.data(K[G]);if(!E[J]){E[J]=true;F.push(K[G])}}}catch(I){F=K}return F},grep:function(F,J,E){var G=[];for(var H=0,I=F.length;H<I;H++){if(!E!=!J(F[H],H)){G.push(F[H])}}return G},map:function(E,J){var F=[];for(var G=0,H=E.length;G<H;G++){var I=J(E[G],G);if(I!=null){F[F.length]=I}}return F.concat.apply([],F)}});var C=navigator.userAgent.toLowerCase();o.browser={version:(C.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(C),opera:/opera/.test(C),msie:/msie/.test(C)&&!/opera/.test(C),mozilla:/mozilla/.test(C)&&!/(compatible|webkit)/.test(C)};o.each({parent:function(E){return E.parentNode},parents:function(E){return o.dir(E,"parentNode")},next:function(E){return o.nth(E,2,"nextSibling")},prev:function(E){return o.nth(E,2,"previousSibling")},nextAll:function(E){return o.dir(E,"nextSibling")},prevAll:function(E){return o.dir(E,"previousSibling")},siblings:function(E){return o.sibling(E.parentNode.firstChild,E)},children:function(E){return o.sibling(E.firstChild)},contents:function(E){return o.nodeName(E,"iframe")?E.contentDocument||E.contentWindow.document:o.makeArray(E.childNodes)}},function(E,F){o.fn[E]=function(G){var H=o.map(this,F);if(G&&typeof G=="string"){H=o.multiFilter(G,H)}return this.pushStack(o.unique(H),E,G)}});o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(E,F){o.fn[E]=function(){var G=arguments;return this.each(function(){for(var H=0,I=G.length;H<I;H++){o(G[H])[F](this)}})}});o.each({removeAttr:function(E){o.attr(this,E,"");if(this.nodeType==1){this.removeAttribute(E)}},addClass:function(E){o.className.add(this,E)},removeClass:function(E){o.className.remove(this,E)},toggleClass:function(F,E){if(typeof E!=="boolean"){E=!o.className.has(this,F)}o.className[E?"add":"remove"](this,F)},remove:function(E){if(!E||o.filter(E,[this]).length){o("*",this).add([this]).each(function(){o.event.remove(this);o.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){o(">*",this).remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(E,F){o.fn[E]=function(){return this.each(F,arguments)}});function j(E,F){return E[0]&&parseInt(o.curCSS(E[0],F,true),10)||0}var h="jQuery"+e(),v=0,A={};o.extend({cache:{},data:function(F,E,G){F=F==l?A:F;var H=F[h];if(!H){H=F[h]=++v}if(E&&!o.cache[H]){o.cache[H]={}}if(G!==g){o.cache[H][E]=G}return E?o.cache[H][E]:H},removeData:function(F,E){F=F==l?A:F;var H=F[h];if(E){if(o.cache[H]){delete o.cache[H][E];E="";for(E in o.cache[H]){break}if(!E){o.removeData(F)}}}else{try{delete F[h]}catch(G){if(F.removeAttribute){F.removeAttribute(h)}}delete o.cache[H]}},queue:function(F,E,H){if(F){E=(E||"fx")+"queue";var G=o.data(F,E);if(!G||o.isArray(H)){G=o.data(F,E,o.makeArray(H))}else{if(H){G.push(H)}}}return G},dequeue:function(H,G){var E=o.queue(H,G),F=E.shift();if(!G||G==="fx"){F=E[0]}if(F!==g){F.call(H)}}});o.fn.extend({data:function(E,G){var H=E.split(".");H[1]=H[1]?"."+H[1]:"";if(G===g){var F=this.triggerHandler("getData"+H[1]+"!",[H[0]]);if(F===g&&this.length){F=o.data(this[0],E)}return F===g&&H[1]?this.data(H[0]):F}else{return this.trigger("setData"+H[1]+"!",[H[0],G]).each(function(){o.data(this,E,G)})}},removeData:function(E){return this.each(function(){o.removeData(this,E)})},queue:function(E,F){if(typeof E!=="string"){F=E;E="fx"}if(F===g){return o.queue(this[0],E)}return this.each(function(){var G=o.queue(this,E,F);if(E=="fx"&&G.length==1){G[0].call(this)}})},dequeue:function(E){return this.each(function(){o.dequeue(this,E)})}});
/*
 * Sizzle CSS Selector Engine - v0.9.3
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var Q=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]+['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[]+)+|[>+~])(\s*,\s*)?/g,K=0,G=Object.prototype.toString;var F=function(X,T,aa,ab){aa=aa||[];T=T||document;if(T.nodeType!==1&&T.nodeType!==9){return[]}if(!X||typeof X!=="string"){return aa}var Y=[],V,ae,ah,S,ac,U,W=true;Q.lastIndex=0;while((V=Q.exec(X))!==null){Y.push(V[1]);if(V[2]){U=RegExp.rightContext;break}}if(Y.length>1&&L.exec(X)){if(Y.length===2&&H.relative[Y[0]]){ae=I(Y[0]+Y[1],T)}else{ae=H.relative[Y[0]]?[T]:F(Y.shift(),T);while(Y.length){X=Y.shift();if(H.relative[X]){X+=Y.shift()}ae=I(X,ae)}}}else{var ad=ab?{expr:Y.pop(),set:E(ab)}:F.find(Y.pop(),Y.length===1&&T.parentNode?T.parentNode:T,P(T));ae=F.filter(ad.expr,ad.set);if(Y.length>0){ah=E(ae)}else{W=false}while(Y.length){var ag=Y.pop(),af=ag;if(!H.relative[ag]){ag=""}else{af=Y.pop()}if(af==null){af=T}H.relative[ag](ah,af,P(T))}}if(!ah){ah=ae}if(!ah){throw"Syntax error, unrecognized expression: "+(ag||X)}if(G.call(ah)==="[object Array]"){if(!W){aa.push.apply(aa,ah)}else{if(T.nodeType===1){for(var Z=0;ah[Z]!=null;Z++){if(ah[Z]&&(ah[Z]===true||ah[Z].nodeType===1&&J(T,ah[Z]))){aa.push(ae[Z])}}}else{for(var Z=0;ah[Z]!=null;Z++){if(ah[Z]&&ah[Z].nodeType===1){aa.push(ae[Z])}}}}}else{E(ah,aa)}if(U){F(U,T,aa,ab)}return aa};F.matches=function(S,T){return F(S,null,null,T)};F.find=function(Z,S,aa){var Y,W;if(!Z){return[]}for(var V=0,U=H.order.length;V<U;V++){var X=H.order[V],W;if((W=H.match[X].exec(Z))){var T=RegExp.leftContext;if(T.substr(T.length-1)!=="\\"){W[1]=(W[1]||"").replace(/\\/g,"");Y=H.find[X](W,S,aa);if(Y!=null){Z=Z.replace(H.match[X],"");break}}}}if(!Y){Y=S.getElementsByTagName("*")}return{set:Y,expr:Z}};F.filter=function(ab,aa,ae,V){var U=ab,ag=[],Y=aa,X,S;while(ab&&aa.length){for(var Z in H.filter){if((X=H.match[Z].exec(ab))!=null){var T=H.filter[Z],af,ad;S=false;if(Y==ag){ag=[]}if(H.preFilter[Z]){X=H.preFilter[Z](X,Y,ae,ag,V);if(!X){S=af=true}else{if(X===true){continue}}}if(X){for(var W=0;(ad=Y[W])!=null;W++){if(ad){af=T(ad,X,W,Y);var ac=V^!!af;if(ae&&af!=null){if(ac){S=true}else{Y[W]=false}}else{if(ac){ag.push(ad);S=true}}}}}if(af!==g){if(!ae){Y=ag}ab=ab.replace(H.match[Z],"");if(!S){return[]}break}}}ab=ab.replace(/\s*,\s*/,"");if(ab==U){if(S==null){throw"Syntax error, unrecognized expression: "+ab}else{break}}U=ab}return Y};var H=F.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(S){return S.getAttribute("href")}},relative:{"+":function(W,T){for(var U=0,S=W.length;U<S;U++){var V=W[U];if(V){var X=V.previousSibling;while(X&&X.nodeType!==1){X=X.previousSibling}W[U]=typeof T==="string"?X||false:X===T}}if(typeof T==="string"){F.filter(T,W,true)}},">":function(X,T,Y){if(typeof T==="string"&&!/\W/.test(T)){T=Y?T:T.toUpperCase();for(var U=0,S=X.length;U<S;U++){var W=X[U];if(W){var V=W.parentNode;X[U]=V.nodeName===T?V:false}}}else{for(var U=0,S=X.length;U<S;U++){var W=X[U];if(W){X[U]=typeof T==="string"?W.parentNode:W.parentNode===T}}if(typeof T==="string"){F.filter(T,X,true)}}},"":function(V,T,X){var U="done"+(K++),S=R;if(!T.match(/\W/)){var W=T=X?T:T.toUpperCase();S=O}S("parentNode",T,U,V,W,X)},"~":function(V,T,X){var U="done"+(K++),S=R;if(typeof T==="string"&&!T.match(/\W/)){var W=T=X?T:T.toUpperCase();S=O}S("previousSibling",T,U,V,W,X)}},find:{ID:function(T,U,V){if(typeof U.getElementById!=="undefined"&&!V){var S=U.getElementById(T[1]);return S?[S]:[]}},NAME:function(S,T,U){if(typeof T.getElementsByName!=="undefined"&&!U){return T.getElementsByName(S[1])}},TAG:function(S,T){return T.getElementsByTagName(S[1])}},preFilter:{CLASS:function(V,T,U,S,Y){V=" "+V[1].replace(/\\/g,"")+" ";var X;for(var W=0;(X=T[W])!=null;W++){if(X){if(Y^(" "+X.className+" ").indexOf(V)>=0){if(!U){S.push(X)}}else{if(U){T[W]=false}}}}return false},ID:function(S){return S[1].replace(/\\/g,"")},TAG:function(T,S){for(var U=0;S[U]===false;U++){}return S[U]&&P(S[U])?T[1]:T[1].toUpperCase()},CHILD:function(S){if(S[1]=="nth"){var T=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(S[2]=="even"&&"2n"||S[2]=="odd"&&"2n+1"||!/\D/.test(S[2])&&"0n+"+S[2]||S[2]);S[2]=(T[1]+(T[2]||1))-0;S[3]=T[3]-0}S[0]="done"+(K++);return S},ATTR:function(T){var S=T[1].replace(/\\/g,"");if(H.attrMap[S]){T[1]=H.attrMap[S]}if(T[2]==="~="){T[4]=" "+T[4]+" "}return T},PSEUDO:function(W,T,U,S,X){if(W[1]==="not"){if(W[3].match(Q).length>1){W[3]=F(W[3],null,null,T)}else{var V=F.filter(W[3],T,U,true^X);if(!U){S.push.apply(S,V)}return false}}else{if(H.match.POS.test(W[0])){return true}}return W},POS:function(S){S.unshift(true);return S}},filters:{enabled:function(S){return S.disabled===false&&S.type!=="hidden"},disabled:function(S){return S.disabled===true},checked:function(S){return S.checked===true},selected:function(S){S.parentNode.selectedIndex;return S.selected===true},parent:function(S){return !!S.firstChild},empty:function(S){return !S.firstChild},has:function(U,T,S){return !!F(S[3],U).length},header:function(S){return/h\d/i.test(S.nodeName)},text:function(S){return"text"===S.type},radio:function(S){return"radio"===S.type},checkbox:function(S){return"checkbox"===S.type},file:function(S){return"file"===S.type},password:function(S){return"password"===S.type},submit:function(S){return"submit"===S.type},image:function(S){return"image"===S.type},reset:function(S){return"reset"===S.type},button:function(S){return"button"===S.type||S.nodeName.toUpperCase()==="BUTTON"},input:function(S){return/input|select|textarea|button/i.test(S.nodeName)}},setFilters:{first:function(T,S){return S===0},last:function(U,T,S,V){return T===V.length-1},even:function(T,S){return S%2===0},odd:function(T,S){return S%2===1},lt:function(U,T,S){return T<S[3]-0},gt:function(U,T,S){return T>S[3]-0},nth:function(U,T,S){return S[3]-0==T},eq:function(U,T,S){return S[3]-0==T}},filter:{CHILD:function(S,V){var Y=V[1],Z=S.parentNode;var X=V[0];if(Z&&(!Z[X]||!S.nodeIndex)){var W=1;for(var T=Z.firstChild;T;T=T.nextSibling){if(T.nodeType==1){T.nodeIndex=W++}}Z[X]=W-1}if(Y=="first"){return S.nodeIndex==1}else{if(Y=="last"){return S.nodeIndex==Z[X]}else{if(Y=="only"){return Z[X]==1}else{if(Y=="nth"){var ab=false,U=V[2],aa=V[3];if(U==1&&aa==0){return true}if(U==0){if(S.nodeIndex==aa){ab=true}}else{if((S.nodeIndex-aa)%U==0&&(S.nodeIndex-aa)/U>=0){ab=true}}return ab}}}}},PSEUDO:function(Y,U,V,Z){var T=U[1],W=H.filters[T];if(W){return W(Y,V,U,Z)}else{if(T==="contains"){return(Y.textContent||Y.innerText||"").indexOf(U[3])>=0}else{if(T==="not"){var X=U[3];for(var V=0,S=X.length;V<S;V++){if(X[V]===Y){return false}}return true}}}},ID:function(T,S){return T.nodeType===1&&T.getAttribute("id")===S},TAG:function(T,S){return(S==="*"&&T.nodeType===1)||T.nodeName===S},CLASS:function(T,S){return S.test(T.className)},ATTR:function(W,U){var S=H.attrHandle[U[1]]?H.attrHandle[U[1]](W):W[U[1]]||W.getAttribute(U[1]),X=S+"",V=U[2],T=U[4];return S==null?V==="!=":V==="="?X===T:V==="*="?X.indexOf(T)>=0:V==="~="?(" "+X+" ").indexOf(T)>=0:!U[4]?S:V==="!="?X!=T:V==="^="?X.indexOf(T)===0:V==="$="?X.substr(X.length-T.length)===T:V==="|="?X===T||X.substr(0,T.length+1)===T+"-":false},POS:function(W,T,U,X){var S=T[2],V=H.setFilters[S];if(V){return V(W,U,T,X)}}}};var L=H.match.POS;for(var N in H.match){H.match[N]=RegExp(H.match[N].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var E=function(T,S){T=Array.prototype.slice.call(T);if(S){S.push.apply(S,T);return S}return T};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(M){E=function(W,V){var T=V||[];if(G.call(W)==="[object Array]"){Array.prototype.push.apply(T,W)}else{if(typeof W.length==="number"){for(var U=0,S=W.length;U<S;U++){T.push(W[U])}}else{for(var U=0;W[U];U++){T.push(W[U])}}}return T}}(function(){var T=document.createElement("form"),U="script"+(new Date).getTime();T.innerHTML="<input name='"+U+"'/>";var S=document.documentElement;S.insertBefore(T,S.firstChild);if(!!document.getElementById(U)){H.find.ID=function(W,X,Y){if(typeof X.getElementById!=="undefined"&&!Y){var V=X.getElementById(W[1]);return V?V.id===W[1]||typeof V.getAttributeNode!=="undefined"&&V.getAttributeNode("id").nodeValue===W[1]?[V]:g:[]}};H.filter.ID=function(X,V){var W=typeof X.getAttributeNode!=="undefined"&&X.getAttributeNode("id");return X.nodeType===1&&W&&W.nodeValue===V}}S.removeChild(T)})();(function(){var S=document.createElement("div");S.appendChild(document.createComment(""));if(S.getElementsByTagName("*").length>0){H.find.TAG=function(T,X){var W=X.getElementsByTagName(T[1]);if(T[1]==="*"){var V=[];for(var U=0;W[U];U++){if(W[U].nodeType===1){V.push(W[U])}}W=V}return W}}S.innerHTML="<a href='#'></a>";if(S.firstChild&&S.firstChild.getAttribute("href")!=="#"){H.attrHandle.href=function(T){return T.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var S=F,T=document.createElement("div");T.innerHTML="<p class='TEST'></p>";if(T.querySelectorAll&&T.querySelectorAll(".TEST").length===0){return}F=function(X,W,U,V){W=W||document;if(!V&&W.nodeType===9&&!P(W)){try{return E(W.querySelectorAll(X),U)}catch(Y){}}return S(X,W,U,V)};F.find=S.find;F.filter=S.filter;F.selectors=S.selectors;F.matches=S.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){H.order.splice(1,0,"CLASS");H.find.CLASS=function(S,T){return T.getElementsByClassName(S[1])}}function O(T,Z,Y,ac,aa,ab){for(var W=0,U=ac.length;W<U;W++){var S=ac[W];if(S){S=S[T];var X=false;while(S&&S.nodeType){var V=S[Y];if(V){X=ac[V];break}if(S.nodeType===1&&!ab){S[Y]=W}if(S.nodeName===Z){X=S;break}S=S[T]}ac[W]=X}}}function R(T,Y,X,ab,Z,aa){for(var V=0,U=ab.length;V<U;V++){var S=ab[V];if(S){S=S[T];var W=false;while(S&&S.nodeType){if(S[X]){W=ab[S[X]];break}if(S.nodeType===1){if(!aa){S[X]=V}if(typeof Y!=="string"){if(S===Y){W=true;break}}else{if(F.filter(Y,[S]).length>0){W=S;break}}}S=S[T]}ab[V]=W}}}var J=document.compareDocumentPosition?function(T,S){return T.compareDocumentPosition(S)&16}:function(T,S){return T!==S&&(T.contains?T.contains(S):true)};var P=function(S){return S.nodeType===9&&S.documentElement.nodeName!=="HTML"||!!S.ownerDocument&&P(S.ownerDocument)};var I=function(S,Z){var V=[],W="",X,U=Z.nodeType?[Z]:Z;while((X=H.match.PSEUDO.exec(S))){W+=X[0];S=S.replace(H.match.PSEUDO,"")}S=H.relative[S]?S+"*":S;for(var Y=0,T=U.length;Y<T;Y++){F(S,U[Y],V)}return F.filter(W,V)};o.find=F;o.filter=F.filter;o.expr=F.selectors;o.expr[":"]=o.expr.filters;F.selectors.filters.hidden=function(S){return"hidden"===S.type||o.css(S,"display")==="none"||o.css(S,"visibility")==="hidden"};F.selectors.filters.visible=function(S){return"hidden"!==S.type&&o.css(S,"display")!=="none"&&o.css(S,"visibility")!=="hidden"};F.selectors.filters.animated=function(S){return o.grep(o.timers,function(T){return S===T.elem}).length};o.multiFilter=function(U,S,T){if(T){U=":not("+U+")"}return F.matches(U,S)};o.dir=function(U,T){var S=[],V=U[T];while(V&&V!=document){if(V.nodeType==1){S.push(V)}V=V[T]}return S};o.nth=function(W,S,U,V){S=S||1;var T=0;for(;W;W=W[U]){if(W.nodeType==1&&++T==S){break}}return W};o.sibling=function(U,T){var S=[];for(;U;U=U.nextSibling){if(U.nodeType==1&&U!=T){S.push(U)}}return S};return;l.Sizzle=F})();o.event={add:function(I,F,H,K){if(I.nodeType==3||I.nodeType==8){return}if(I.setInterval&&I!=l){I=l}if(!H.guid){H.guid=this.guid++}if(K!==g){var G=H;H=this.proxy(G);H.data=K}var E=o.data(I,"events")||o.data(I,"events",{}),J=o.data(I,"handle")||o.data(I,"handle",function(){return typeof o!=="undefined"&&!o.event.triggered?o.event.handle.apply(arguments.callee.elem,arguments):g});J.elem=I;o.each(F.split(/\s+/),function(M,N){var O=N.split(".");N=O.shift();H.type=O.slice().sort().join(".");var L=E[N];if(o.event.specialAll[N]){o.event.specialAll[N].setup.call(I,K,O)}if(!L){L=E[N]={};if(!o.event.special[N]||o.event.special[N].setup.call(I,K,O)===false){if(I.addEventListener){I.addEventListener(N,J,false)}else{if(I.attachEvent){I.attachEvent("on"+N,J)}}}}L[H.guid]=H;o.event.global[N]=true});I=null},guid:1,global:{},remove:function(K,H,J){if(K.nodeType==3||K.nodeType==8){return}var G=o.data(K,"events"),F,E;if(G){if(H===g||(typeof H==="string"&&H.charAt(0)==".")){for(var I in G){this.remove(K,I+(H||""))}}else{if(H.type){J=H.handler;H=H.type}o.each(H.split(/\s+/),function(M,O){var Q=O.split(".");O=Q.shift();var N=RegExp("(^|\\.)"+Q.slice().sort().join(".*\\.")+"(\\.|$)");if(G[O]){if(J){delete G[O][J.guid]}else{for(var P in G[O]){if(N.test(G[O][P].type)){delete G[O][P]}}}if(o.event.specialAll[O]){o.event.specialAll[O].teardown.call(K,Q)}for(F in G[O]){break}if(!F){if(!o.event.special[O]||o.event.special[O].teardown.call(K,Q)===false){if(K.removeEventListener){K.removeEventListener(O,o.data(K,"handle"),false)}else{if(K.detachEvent){K.detachEvent("on"+O,o.data(K,"handle"))}}}F=null;delete G[O]}}})}for(F in G){break}if(!F){var L=o.data(K,"handle");if(L){L.elem=null}o.removeData(K,"events");o.removeData(K,"handle")}}},trigger:function(I,K,H,E){var G=I.type||I;if(!E){I=typeof I==="object"?I[h]?I:o.extend(o.Event(G),I):o.Event(G);if(G.indexOf("!")>=0){I.type=G=G.slice(0,-1);I.exclusive=true}if(!H){I.stopPropagation();if(this.global[G]){o.each(o.cache,function(){if(this.events&&this.events[G]){o.event.trigger(I,K,this.handle.elem)}})}}if(!H||H.nodeType==3||H.nodeType==8){return g}I.result=g;I.target=H;K=o.makeArray(K);K.unshift(I)}I.currentTarget=H;var J=o.data(H,"handle");if(J){J.apply(H,K)}if((!H[G]||(o.nodeName(H,"a")&&G=="click"))&&H["on"+G]&&H["on"+G].apply(H,K)===false){I.result=false}if(!E&&H[G]&&!I.isDefaultPrevented()&&!(o.nodeName(H,"a")&&G=="click")){this.triggered=true;try{H[G]()}catch(L){}}this.triggered=false;if(!I.isPropagationStopped()){var F=H.parentNode||H.ownerDocument;if(F){o.event.trigger(I,K,F,true)}}},handle:function(K){var J,E;K=arguments[0]=o.event.fix(K||l.event);var L=K.type.split(".");K.type=L.shift();J=!L.length&&!K.exclusive;var I=RegExp("(^|\\.)"+L.slice().sort().join(".*\\.")+"(\\.|$)");E=(o.data(this,"events")||{})[K.type];for(var G in E){var H=E[G];if(J||I.test(H.type)){K.handler=H;K.data=H.data;var F=H.apply(this,arguments);if(F!==g){K.result=F;if(F===false){K.preventDefault();K.stopPropagation()}}if(K.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(H){if(H[h]){return H}var F=H;H=o.Event(F);for(var G=this.props.length,J;G;){J=this.props[--G];H[J]=F[J]}if(!H.target){H.target=H.srcElement||document}if(H.target.nodeType==3){H.target=H.target.parentNode}if(!H.relatedTarget&&H.fromElement){H.relatedTarget=H.fromElement==H.target?H.toElement:H.fromElement}if(H.pageX==null&&H.clientX!=null){var I=document.documentElement,E=document.body;H.pageX=H.clientX+(I&&I.scrollLeft||E&&E.scrollLeft||0)-(I.clientLeft||0);H.pageY=H.clientY+(I&&I.scrollTop||E&&E.scrollTop||0)-(I.clientTop||0)}if(!H.which&&((H.charCode||H.charCode===0)?H.charCode:H.keyCode)){H.which=H.charCode||H.keyCode}if(!H.metaKey&&H.ctrlKey){H.metaKey=H.ctrlKey}if(!H.which&&H.button){H.which=(H.button&1?1:(H.button&2?3:(H.button&4?2:0)))}return H},proxy:function(F,E){E=E||function(){return F.apply(this,arguments)};E.guid=F.guid=F.guid||E.guid||this.guid++;return E},special:{ready:{setup:B,teardown:function(){}}},specialAll:{live:{setup:function(E,F){o.event.add(this,F[0],c)},teardown:function(G){if(G.length){var E=0,F=RegExp("(^|\\.)"+G[0]+"(\\.|$)");o.each((o.data(this,"events").live||{}),function(){if(F.test(this.type)){E++}});if(E<1){o.event.remove(this,G[0],c)}}}}}};o.Event=function(E){if(!this.preventDefault){return new o.Event(E)}if(E&&E.type){this.originalEvent=E;this.type=E.type}else{this.type=E}this.timeStamp=e();this[h]=true};function k(){return false}function u(){return true}o.Event.prototype={preventDefault:function(){this.isDefaultPrevented=u;var E=this.originalEvent;if(!E){return}if(E.preventDefault){E.preventDefault()}E.returnValue=false},stopPropagation:function(){this.isPropagationStopped=u;var E=this.originalEvent;if(!E){return}if(E.stopPropagation){E.stopPropagation()}E.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=u;this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k};var a=function(F){var E=F.relatedTarget;while(E&&E!=this){try{E=E.parentNode}catch(G){E=this}}if(E!=this){F.type=F.data;o.event.handle.apply(this,arguments)}};o.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(F,E){o.event.special[E]={setup:function(){o.event.add(this,F,a,E)},teardown:function(){o.event.remove(this,F,a)}}});o.fn.extend({bind:function(F,G,E){return F=="unload"?this.one(F,G,E):this.each(function(){o.event.add(this,F,E||G,E&&G)})},one:function(G,H,F){var E=o.event.proxy(F||H,function(I){o(this).unbind(I,E);return(F||H).apply(this,arguments)});return this.each(function(){o.event.add(this,G,E,F&&H)})},unbind:function(F,E){return this.each(function(){o.event.remove(this,F,E)})},trigger:function(E,F){return this.each(function(){o.event.trigger(E,F,this)})},triggerHandler:function(E,G){if(this[0]){var F=o.Event(E);F.preventDefault();F.stopPropagation();o.event.trigger(F,G,this[0]);return F.result}},toggle:function(G){var E=arguments,F=1;while(F<E.length){o.event.proxy(G,E[F++])}return this.click(o.event.proxy(G,function(H){this.lastToggle=(this.lastToggle||0)%F;H.preventDefault();return E[this.lastToggle++].apply(this,arguments)||false}))},hover:function(E,F){return this.mouseenter(E).mouseleave(F)},ready:function(E){B();if(o.isReady){E.call(document,o)}else{o.readyList.push(E)}return this},live:function(G,F){var E=o.event.proxy(F);E.guid+=this.selector+G;o(document).bind(i(G,this.selector),this.selector,E);return this},die:function(F,E){o(document).unbind(i(F,this.selector),E?{guid:E.guid+this.selector+F}:null);return this}});function c(H){var E=RegExp("(^|\\.)"+H.type+"(\\.|$)"),G=true,F=[];o.each(o.data(this,"events").live||[],function(I,J){if(E.test(J.type)){var K=o(H.target).closest(J.data)[0];if(K){F.push({elem:K,fn:J})}}});o.each(F,function(){if(this.fn.call(this.elem,H,this.fn.data)===false){G=false}});return G}function i(F,E){return["live",F,E.replace(/\./g,"`").replace(/ /g,"|")].join(".")}o.extend({isReady:false,readyList:[],ready:function(){if(!o.isReady){o.isReady=true;if(o.readyList){o.each(o.readyList,function(){this.call(document,o)});o.readyList=null}o(document).triggerHandler("ready")}}});var x=false;function B(){if(x){return}x=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);o.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);o.ready()}});if(document.documentElement.doScroll&&typeof l.frameElement==="undefined"){(function(){if(o.isReady){return}try{document.documentElement.doScroll("left")}catch(E){setTimeout(arguments.callee,0);return}o.ready()})()}}}o.event.add(l,"load",o.ready)}o.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(F,E){o.fn[E]=function(G){return G?this.bind(E,G):this.trigger(E)}});o(l).bind("unload",function(){for(var E in o.cache){if(E!=1&&o.cache[E].handle){o.event.remove(o.cache[E].handle.elem)}}});(function(){o.support={};var F=document.documentElement,G=document.createElement("script"),K=document.createElement("div"),J="script"+(new Date).getTime();K.style.display="none";K.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var H=K.getElementsByTagName("*"),E=K.getElementsByTagName("a")[0];if(!H||!H.length||!E){return}o.support={leadingWhitespace:K.firstChild.nodeType==3,tbody:!K.getElementsByTagName("tbody").length,objectAll:!!K.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!K.getElementsByTagName("link").length,style:/red/.test(E.getAttribute("style")),hrefNormalized:E.getAttribute("href")==="/a",opacity:E.style.opacity==="0.5",cssFloat:!!E.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};G.type="text/javascript";try{G.appendChild(document.createTextNode("window."+J+"=1;"))}catch(I){}F.insertBefore(G,F.firstChild);if(l[J]){o.support.scriptEval=true;delete l[J]}F.removeChild(G);if(K.attachEvent&&K.fireEvent){K.attachEvent("onclick",function(){o.support.noCloneEvent=false;K.detachEvent("onclick",arguments.callee)});K.cloneNode(true).fireEvent("onclick")}o(function(){var L=document.createElement("div");L.style.width="1px";L.style.paddingLeft="1px";document.body.appendChild(L);o.boxModel=o.support.boxModel=L.offsetWidth===2;document.body.removeChild(L)})})();var w=o.support.cssFloat?"cssFloat":"styleFloat";o.props={"for":"htmlFor","class":"className","float":w,cssFloat:w,styleFloat:w,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};o.fn.extend({_load:o.fn.load,load:function(G,J,K){if(typeof G!=="string"){return this._load(G)}var I=G.indexOf(" ");if(I>=0){var E=G.slice(I,G.length);G=G.slice(0,I)}var H="GET";if(J){if(o.isFunction(J)){K=J;J=null}else{if(typeof J==="object"){J=o.param(J);H="POST"}}}var F=this;o.ajax({url:G,type:H,dataType:"html",data:J,complete:function(M,L){if(L=="success"||L=="notmodified"){F.html(E?o("<div/>").append(M.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(E):M.responseText)}if(K){F.each(K,[M.responseText,L,M])}}});return this},serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?o.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))}).map(function(E,F){var G=o(this).val();return G==null?null:o.isArray(G)?o.map(G,function(I,H){return{name:F.name,value:I}}):{name:F.name,value:G}}).get()}});o.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(E,F){o.fn[F]=function(G){return this.bind(F,G)}});var r=e();o.extend({get:function(E,G,H,F){if(o.isFunction(G)){H=G;G=null}return o.ajax({type:"GET",url:E,data:G,success:H,dataType:F})},getScript:function(E,F){return o.get(E,null,F,"script")},getJSON:function(E,F,G){return o.get(E,F,G,"json")},post:function(E,G,H,F){if(o.isFunction(G)){H=G;G={}}return o.ajax({type:"POST",url:E,data:G,success:H,dataType:F})},ajaxSetup:function(E){o.extend(o.ajaxSettings,E)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return l.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(M){M=o.extend(true,M,o.extend(true,{},o.ajaxSettings,M));var W,F=/=\?(&|$)/g,R,V,G=M.type.toUpperCase();if(M.data&&M.processData&&typeof M.data!=="string"){M.data=o.param(M.data)}if(M.dataType=="jsonp"){if(G=="GET"){if(!M.url.match(F)){M.url+=(M.url.match(/\?/)?"&":"?")+(M.jsonp||"callback")+"=?"}}else{if(!M.data||!M.data.match(F)){M.data=(M.data?M.data+"&":"")+(M.jsonp||"callback")+"=?"}}M.dataType="json"}if(M.dataType=="json"&&(M.data&&M.data.match(F)||M.url.match(F))){W="jsonp"+r++;if(M.data){M.data=(M.data+"").replace(F,"="+W+"$1")}M.url=M.url.replace(F,"="+W+"$1");M.dataType="script";l[W]=function(X){V=X;I();L();l[W]=g;try{delete l[W]}catch(Y){}if(H){H.removeChild(T)}}}if(M.dataType=="script"&&M.cache==null){M.cache=false}if(M.cache===false&&G=="GET"){var E=e();var U=M.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+E+"$2");M.url=U+((U==M.url)?(M.url.match(/\?/)?"&":"?")+"_="+E:"")}if(M.data&&G=="GET"){M.url+=(M.url.match(/\?/)?"&":"?")+M.data;M.data=null}if(M.global&&!o.active++){o.event.trigger("ajaxStart")}var Q=/^(\w+:)?\/\/([^\/?#]+)/.exec(M.url);if(M.dataType=="script"&&G=="GET"&&Q&&(Q[1]&&Q[1]!=location.protocol||Q[2]!=location.host)){var H=document.getElementsByTagName("head")[0];var T=document.createElement("script");T.src=M.url;if(M.scriptCharset){T.charset=M.scriptCharset}if(!W){var O=false;T.onload=T.onreadystatechange=function(){if(!O&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){O=true;I();L();H.removeChild(T)}}}H.appendChild(T);return g}var K=false;var J=M.xhr();if(M.username){J.open(G,M.url,M.async,M.username,M.password)}else{J.open(G,M.url,M.async)}try{if(M.data){J.setRequestHeader("Content-Type",M.contentType)}if(M.ifModified){J.setRequestHeader("If-Modified-Since",o.lastModified[M.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}J.setRequestHeader("X-Requested-With","XMLHttpRequest");J.setRequestHeader("Accept",M.dataType&&M.accepts[M.dataType]?M.accepts[M.dataType]+", */*":M.accepts._default)}catch(S){}if(M.beforeSend&&M.beforeSend(J,M)===false){if(M.global&&!--o.active){o.event.trigger("ajaxStop")}J.abort();return false}if(M.global){o.event.trigger("ajaxSend",[J,M])}var N=function(X){if(J.readyState==0){if(P){clearInterval(P);P=null;if(M.global&&!--o.active){o.event.trigger("ajaxStop")}}}else{if(!K&&J&&(J.readyState==4||X=="timeout")){K=true;if(P){clearInterval(P);P=null}R=X=="timeout"?"timeout":!o.httpSuccess(J)?"error":M.ifModified&&o.httpNotModified(J,M.url)?"notmodified":"success";if(R=="success"){try{V=o.httpData(J,M.dataType,M)}catch(Z){R="parsererror"}}if(R=="success"){var Y;try{Y=J.getResponseHeader("Last-Modified")}catch(Z){}if(M.ifModified&&Y){o.lastModified[M.url]=Y}if(!W){I()}}else{o.handleError(M,J,R)}L();if(X){J.abort()}if(M.async){J=null}}}};if(M.async){var P=setInterval(N,13);if(M.timeout>0){setTimeout(function(){if(J&&!K){N("timeout")}},M.timeout)}}try{J.send(M.data)}catch(S){o.handleError(M,J,null,S)}if(!M.async){N()}function I(){if(M.success){M.success(V,R)}if(M.global){o.event.trigger("ajaxSuccess",[J,M])}}function L(){if(M.complete){M.complete(J,R)}if(M.global){o.event.trigger("ajaxComplete",[J,M])}if(M.global&&!--o.active){o.event.trigger("ajaxStop")}}return J},handleError:function(F,H,E,G){if(F.error){F.error(H,E,G)}if(F.global){o.event.trigger("ajaxError",[H,F,G])}},active:0,httpSuccess:function(F){try{return !F.status&&location.protocol=="file:"||(F.status>=200&&F.status<300)||F.status==304||F.status==1223}catch(E){}return false},httpNotModified:function(G,E){try{var H=G.getResponseHeader("Last-Modified");return G.status==304||H==o.lastModified[E]}catch(F){}return false},httpData:function(J,H,G){var F=J.getResponseHeader("content-type"),E=H=="xml"||!H&&F&&F.indexOf("xml")>=0,I=E?J.responseXML:J.responseText;if(E&&I.documentElement.tagName=="parsererror"){throw"parsererror"}if(G&&G.dataFilter){I=G.dataFilter(I,H)}if(typeof I==="string"){if(H=="script"){o.globalEval(I)}if(H=="json"){I=l["eval"]("("+I+")")}}return I},param:function(E){var G=[];function H(I,J){G[G.length]=encodeURIComponent(I)+"="+encodeURIComponent(J)}if(o.isArray(E)||E.jquery){o.each(E,function(){H(this.name,this.value)})}else{for(var F in E){if(o.isArray(E[F])){o.each(E[F],function(){H(F,this)})}else{H(F,o.isFunction(E[F])?E[F]():E[F])}}}return G.join("&").replace(/%20/g,"+")}});var m={},n,d=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function t(F,E){var G={};o.each(d.concat.apply([],d.slice(0,E)),function(){G[this]=F});return G}o.fn.extend({show:function(J,L){if(J){return this.animate(t("show",3),J,L)}else{for(var H=0,F=this.length;H<F;H++){var E=o.data(this[H],"olddisplay");this[H].style.display=E||"";if(o.css(this[H],"display")==="none"){var G=this[H].tagName,K;if(m[G]){K=m[G]}else{var I=o("<"+G+" />").appendTo("body");K=I.css("display");if(K==="none"){K="block"}I.remove();m[G]=K}this[H].style.display=o.data(this[H],"olddisplay",K)}}return this}},hide:function(H,I){if(H){return this.animate(t("hide",3),H,I)}else{for(var G=0,F=this.length;G<F;G++){var E=o.data(this[G],"olddisplay");if(!E&&E!=="none"){o.data(this[G],"olddisplay",o.css(this[G],"display"))}this[G].style.display="none"}return this}},_toggle:o.fn.toggle,toggle:function(G,F){var E=typeof G==="boolean";return o.isFunction(G)&&o.isFunction(F)?this._toggle.apply(this,arguments):G==null||E?this.each(function(){var H=E?G:o(this).is(":hidden");o(this)[H?"show":"hide"]()}):this.animate(t("toggle",3),G,F)},fadeTo:function(E,G,F){return this.animate({opacity:G},E,F)},animate:function(I,F,H,G){var E=o.speed(F,H,G);return this[E.queue===false?"each":"queue"](function(){var K=o.extend({},E),M,L=this.nodeType==1&&o(this).is(":hidden"),J=this;for(M in I){if(I[M]=="hide"&&L||I[M]=="show"&&!L){return K.complete.call(this)}if((M=="height"||M=="width")&&this.style){K.display=o.css(this,"display");K.overflow=this.style.overflow}}if(K.overflow!=null){this.style.overflow="hidden"}K.curAnim=o.extend({},I);o.each(I,function(O,S){var R=new o.fx(J,K,O);if(/toggle|show|hide/.test(S)){R[S=="toggle"?L?"show":"hide":S](I)}else{var Q=S.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),T=R.cur(true)||0;if(Q){var N=parseFloat(Q[2]),P=Q[3]||"px";if(P!="px"){J.style[O]=(N||1)+P;T=((N||1)/R.cur(true))*T;J.style[O]=T+P}if(Q[1]){N=((Q[1]=="-="?-1:1)*N)+T}R.custom(T,N,P)}else{R.custom(T,S,"")}}});return true})},stop:function(F,E){var G=o.timers;if(F){this.queue([])}this.each(function(){for(var H=G.length-1;H>=0;H--){if(G[H].elem==this){if(E){G[H](true)}G.splice(H,1)}}});if(!E){this.dequeue()}return this}});o.each({slideDown:t("show",1),slideUp:t("hide",1),slideToggle:t("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(E,F){o.fn[E]=function(G,H){return this.animate(F,G,H)}});o.extend({speed:function(G,H,F){var E=typeof G==="object"?G:{complete:F||!F&&H||o.isFunction(G)&&G,duration:G,easing:F&&H||H&&!o.isFunction(H)&&H};E.duration=o.fx.off?0:typeof E.duration==="number"?E.duration:o.fx.speeds[E.duration]||o.fx.speeds._default;E.old=E.complete;E.complete=function(){if(E.queue!==false){o(this).dequeue()}if(o.isFunction(E.old)){E.old.call(this)}};return E},easing:{linear:function(G,H,E,F){return E+F*G},swing:function(G,H,E,F){return((-Math.cos(G*Math.PI)/2)+0.5)*F+E}},timers:[],fx:function(F,E,G){this.options=E;this.elem=F;this.prop=G;if(!E.orig){E.orig={}}}});o.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(o.fx.step[this.prop]||o.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(F){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var E=parseFloat(o.css(this.elem,this.prop,F));return E&&E>-10000?E:parseFloat(o.curCSS(this.elem,this.prop))||0},custom:function(I,H,G){this.startTime=e();this.start=I;this.end=H;this.unit=G||this.unit||"px";this.now=this.start;this.pos=this.state=0;var E=this;function F(J){return E.step(J)}F.elem=this.elem;if(F()&&o.timers.push(F)==1){n=setInterval(function(){var K=o.timers;for(var J=0;J<K.length;J++){if(!K[J]()){K.splice(J--,1)}}if(!K.length){clearInterval(n)}},13)}},show:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());o(this.elem).show()},hide:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(H){var G=e();if(H||G>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var E=true;for(var F in this.options.curAnim){if(this.options.curAnim[F]!==true){E=false}}if(E){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(o.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){o(this.elem).hide()}if(this.options.hide||this.options.show){for(var I in this.options.curAnim){o.attr(this.elem.style,I,this.options.orig[I])}}this.options.complete.call(this.elem)}return false}else{var J=G-this.startTime;this.state=J/this.options.duration;this.pos=o.easing[this.options.easing||(o.easing.swing?"swing":"linear")](this.state,J,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};o.extend(o.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(E){o.attr(E.elem.style,"opacity",E.now)},_default:function(E){if(E.elem.style&&E.elem.style[E.prop]!=null){E.elem.style[E.prop]=E.now+E.unit}else{E.elem[E.prop]=E.now}}}});if(document.documentElement.getBoundingClientRect){o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}var G=this[0].getBoundingClientRect(),J=this[0].ownerDocument,F=J.body,E=J.documentElement,L=E.clientTop||F.clientTop||0,K=E.clientLeft||F.clientLeft||0,I=G.top+(self.pageYOffset||o.boxModel&&E.scrollTop||F.scrollTop)-L,H=G.left+(self.pageXOffset||o.boxModel&&E.scrollLeft||F.scrollLeft)-K;return{top:I,left:H}}}else{o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}o.offset.initialized||o.offset.initialize();var J=this[0],G=J.offsetParent,F=J,O=J.ownerDocument,M,H=O.documentElement,K=O.body,L=O.defaultView,E=L.getComputedStyle(J,null),N=J.offsetTop,I=J.offsetLeft;while((J=J.parentNode)&&J!==K&&J!==H){M=L.getComputedStyle(J,null);N-=J.scrollTop,I-=J.scrollLeft;if(J===G){N+=J.offsetTop,I+=J.offsetLeft;if(o.offset.doesNotAddBorder&&!(o.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(J.tagName))){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}F=G,G=J.offsetParent}if(o.offset.subtractsBorderForOverflowNotVisible&&M.overflow!=="visible"){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}E=M}if(E.position==="relative"||E.position==="static"){N+=K.offsetTop,I+=K.offsetLeft}if(E.position==="fixed"){N+=Math.max(H.scrollTop,K.scrollTop),I+=Math.max(H.scrollLeft,K.scrollLeft)}return{top:N,left:I}}}o.offset={initialize:function(){if(this.initialized){return}var L=document.body,F=document.createElement("div"),H,G,N,I,M,E,J=L.style.marginTop,K='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';M={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(E in M){F.style[E]=M[E]}F.innerHTML=K;L.insertBefore(F,L.firstChild);H=F.firstChild,G=H.firstChild,I=H.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(G.offsetTop!==5);this.doesAddBorderForTableAndCells=(I.offsetTop===5);H.style.overflow="hidden",H.style.position="relative";this.subtractsBorderForOverflowNotVisible=(G.offsetTop===-5);L.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(L.offsetTop===0);L.style.marginTop=J;L.removeChild(F);this.initialized=true},bodyOffset:function(E){o.offset.initialized||o.offset.initialize();var G=E.offsetTop,F=E.offsetLeft;if(o.offset.doesNotIncludeMarginInBodyOffset){G+=parseInt(o.curCSS(E,"marginTop",true),10)||0,F+=parseInt(o.curCSS(E,"marginLeft",true),10)||0}return{top:G,left:F}}};o.fn.extend({position:function(){var I=0,H=0,F;if(this[0]){var G=this.offsetParent(),J=this.offset(),E=/^body|html$/i.test(G[0].tagName)?{top:0,left:0}:G.offset();J.top-=j(this,"marginTop");J.left-=j(this,"marginLeft");E.top+=j(G,"borderTopWidth");E.left+=j(G,"borderLeftWidth");F={top:J.top-E.top,left:J.left-E.left}}return F},offsetParent:function(){var E=this[0].offsetParent||document.body;while(E&&(!/^body|html$/i.test(E.tagName)&&o.css(E,"position")=="static")){E=E.offsetParent}return o(E)}});o.each(["Left","Top"],function(F,E){var G="scroll"+E;o.fn[G]=function(H){if(!this[0]){return null}return H!==g?this.each(function(){this==l||this==document?l.scrollTo(!F?H:o(l).scrollLeft(),F?H:o(l).scrollTop()):this[G]=H}):this[0]==l||this[0]==document?self[F?"pageYOffset":"pageXOffset"]||o.boxModel&&document.documentElement[G]||document.body[G]:this[0][G]}});o.each(["Height","Width"],function(H,F){var E=H?"Left":"Top",G=H?"Right":"Bottom";o.fn["inner"+F]=function(){return this[F.toLowerCase()]()+j(this,"padding"+E)+j(this,"padding"+G)};o.fn["outer"+F]=function(J){return this["inner"+F]()+j(this,"border"+E+"Width")+j(this,"border"+G+"Width")+(J?j(this,"margin"+E)+j(this,"margin"+G):0)};var I=F.toLowerCase();o.fn[I]=function(J){return this[0]==l?document.compatMode=="CSS1Compat"&&document.documentElement["client"+F]||document.body["client"+F]:this[0]==document?Math.max(document.documentElement["client"+F],document.body["scroll"+F],document.documentElement["scroll"+F],document.body["offset"+F],document.documentElement["offset"+F]):J===g?(this.length?o.css(this[0],I):null):this.css(I,typeof J==="string"?J:J+"px")}})})();

/* _script/jquery.hoverIntent.min */

/**
* hoverIntent r5 // 2007.03.27 // jQuery 1.1.2+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne <brian@cherne.net>
*/
(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);

/* _script/vars0 */

var path_from_root_to_document;
if (document.getElementsByName) {
	theArray = document.getElementsByName('jmQovc');
	path_from_root_to_document = theArray[0].content;
}
else if (document.all)
	path_from_root_to_document = document.all.jmQovc.content;
else
	path_from_root_to_document = window.location.href.replace(/^.*:\/\/\/?[^\/]*\/(.*)[.][^.]*$/, "$1");

var relative_depth=0;
for (i=0; i<path_from_root_to_document.length; ++i)
	if (path_from_root_to_document.charAt(i)=='/') relative_depth++;

var path_from_document_to_root = '';
for (i=0; i<relative_depth; ++i)
	path_from_document_to_root += '../';
/*
/_script/combine_js.php?files=_script/jquery-1.3.1.min+_script/jquery.hoverIntent.min+_script/vars0+_script/cookies+_script/rtelang/en+_script/rte+_script/elements+_script/form_validation+_script/fields+_script/arguments+_script/sites+_script/dates/dates+_script/templates+_script/magrim+http://www.google.com/friendconnect/script/friendconnect.js+_script/search+_script/etc+_script/jquery.taconite&out=_script/vars&minify=1
*/


/* _script/cookies */


/* arguments:
   name - name of the cookie
   value - value of the cookie
   [expirationDays] - expiration date of the cookie, in days from today
     (defaults to end of current session)
   [path] - path for which the cookie is valid
     (defaults to path of calling document)
   [domain] - domain for which the cookie is valid
     (defaults to domain of calling document)
   [secure] - Boolean value indicating if the cookie transmission requires
     a secure transmission
   * an argument defaults when it is assigned null as a placeholder
   * a null placeholder is not required for trailing omitted arguments
*/

function setCookie(name, value, expirationDays, path, domain, secure) {
  var expires = null;
  if (expirationDays) {
     // create an instance of the Date object
     expires = new Date();
     // fix the bug in Navigator 2.0, Macintosh
     fixDate(expires);
     expires.setTime(expires.getTime() + expirationDays * 24 * 60 * 60 * 1000);
  }
  var curCookie = name + "=" + escape(value) +
      ((expires) ? "; expires=" + expires.toGMTString() : "") +
      ((path) ? "; path=" + path : "") +
      ((domain) ? "; domain=" + domain : "") +
      ((secure) ? "; secure" : "");
  document.cookie = curCookie;
}


/*
  name - name of the desired cookie
  return string containing value of specified cookie or ""
  if cookie does not exist
*/

function getCookie(name) {
  var dc = document.cookie;
  var prefix = name + "=";
  var begin = dc.indexOf("; " + prefix);
  if (begin == -1) {
    begin = dc.indexOf(prefix);
    if (begin != 0) return "";       // instead of null
  } else
    begin += 2;
  var end = document.cookie.indexOf(";", begin);
  if (end == -1)
    end = dc.length;
  return unescape(dc.substring(begin + prefix.length, end));
}


/*
   name - name of the cookie
   [path] - path of the cookie (must be same as path used to create cookie)
   [domain] - domain of the cookie (must be same as domain used to
     create cookie)
   path and domain default if assigned null or omitted if no explicit
     argument proceeds
*/

function deleteCookie(name, path, domain) {
  if (getCookie(name)) {
    document.cookie = name + "=" +
    ((path) ? "; path=" + path : "") +
    ((domain) ? "; domain=" + domain : "") +
    "; expires=Thu, 01-Jan-70 00:00:01 GMT";
  }
}


function fixDate(date) {
  var base = new Date(0);
  var skew = base.getTime();
  if (skew > 0)
    date.setTime(date.getTime() - skew);
}




/* _script/rtelang/en */


var lblSubmit 				 = "Submit"; // Button value for non-designMode() & non fullsceen RTE
var lblModeRichText 	 = "Switch to RichText Mode"; // Label of the Show Design view link
var lblModeHTML 			 = "Switch to HTML Mode"; // Label of the Show Code view link
var lblPreview				 = "Preview";
var lblSave 				 	 = "Save";
var lblPrint					 = "Print";
var lblSelectAll			 = "Select/Deselect All";
var lblSpellCheck			 = "Spell Check";
var lblCut						 = "Cut";
var lblCopy						 = "Copy";
var lblPaste					 = "Paste";
var lblPasteText       = "Paste as Plain Text";
var lblPasteWord       = "Paste From Word";
var lblUndo						 = "Undo";
var lblRedo						 = "Redo";
var lblHR							 = "Horizontal Rule";
var lblInsertChar			 = "Insert Special Character";
var lblBold						 = "Bold";
var lblItalic					 = "Italic";
var lblUnderline			 = "Underline";
var lblStrikeThrough   = "Strike Through";
var lblSuperscript		 = "Superscript";
var lblSubscript			 = "Subscript";
var lblAlgnLeft				 = "Align Left";
var lblAlgnCenter			 = "Center";
var lblAlgnRight			 = "Align Right";
var lblJustifyFull		 = "Justify Full";
var lblOL							 = "Ordered List";
var lblUL							 = "Unordered List";
var lblOutdent				 = "Outdent";
var lblIndent					 = "Indent";
var lblTextColor			 = "Text Color";
var lblBgColor				 = "Background Color";
var lblSearch					 = "Search And Replace";
var lblInsertLink			 = "Insert Link";
var lblAddImage				 = "Add Image";
var lblInsertTable		 = "Insert Table";
var lblWordCount       = "Word Count";
var lblUnformat        = "Unformat";

var lblFormat  = "<option value=\"\"  selected=\"selected\">Format</option>";
lblFormat     += "<option value=\"p\">Default Paragraph</option>";
lblFormat     += "<option value=\"div\">Default Division</option>";
lblFormat     += "<option value=\"cite\">Citation</option>";      
lblFormat     += "<option value=\"q\">Quotation</option>";
lblFormat     += "<option value=\"q.psuq\">Quotation - Bible Verse</option>";
lblFormat     += "<option value=\"q.mfrj\">Quotation - Bible Commentator</option>";
lblFormat     += "<option value=\"dfn\">Definition</option>";
lblFormat     += "<option value=\"blockquote\">Block quotation</option>";
lblFormat     += "<option value=\"h1\">Heading 1</option>";
lblFormat     += "<option value=\"h2\">Heading 2</option>";
lblFormat     += "<option value=\"h3\">Heading 3</option>";
lblFormat     += "<option value=\"div.advanced\">div for advanced readers</option>";
lblFormat     += "<option value=\"span.advanced\">span for advanced readers</option>";
lblFormat     += "<option value=\"div.future\">div for future research</option>";
lblFormat     += "<option value=\"span.future\">span for future research</option>";
lblFormat     += "<option value=\"div.requirements\">div of requirements</option>";
lblFormat     += "<option value=\"span.field\">field template</option>";
lblFormat     += "<option value=\"div.revisions\">revision history</option>";
lblFormat     += "<option value=\"span.versionid\">version identifier</option>";
lblFormat     += "<option value=\"span.notes\">span of notes</option>";
lblFormat     += "<option value=\"div.submit\">div of submit</option>";
lblFormat     += "<option value=\"div.notes\">div of notes</option>";
lblFormat     += "<option value=\"h4\">Heading 4</option>";
lblFormat     += "<option value=\"h5\">Heading 5</option>";
lblFormat     += "<option value=\"h6\">Heading 6</option>";
lblFormat     += "<option value=\"abbr\">Abbreviation</option>";
lblFormat     += "<option value=\"acronym\">Acronym</option>";
lblFormat     += "<option value=\"address\">Address</option>";
lblFormat     += "<option value=\"pre\">Preformatted Text</option>";
lblFormat     += "<option value=\"code\">Code</option>";
lblFormat     += "<option value=\"kbd\">Text for keyboard</option>";
lblFormat     += "<option value=\"var\">Variable</option>";
lblFormat     += "<option value=\"samp\">Sample</option>";
lblFormat     += "<option value=\"ins\">Inserted text</option>";
lblFormat     += "<option value=\"del\">Deleted text</option>";



var lblFont 					 =  "<option value=\"\"  selected=\"selected\">Font</option>";
lblFont 							 += "<option value=\"Arial, Helvetica, sans-serif\">Arial</option>";
lblFont 							 += "<option value=\"Courier New, Courier, mono\">Courier New</option>";
lblFont 							 += "<option value=\"Palatino Linotype\">Palatino Linotype</option>";
lblFont 							 += "<option value=\"Times New Roman, Times, serif\">Times New Roman</option>";
lblFont 							 += "<option value=\"Verdana, Arial, Helvetica, sans-serif\">Verdana</option>";
var lblSize 					 =  "<option value=\"\">Size</option>";
lblSize 							 += "<option value=\"1\">1</option>";
lblSize 							 += "<option value=\"2\">2</option>";
lblSize 							 += "<option value=\"3\">3</option>";
lblSize 							 += "<option value=\"4\">4</option>";
lblSize 							 += "<option value=\"5\">5</option>";
lblSize 							 += "<option value=\"6\">6</option>";
lblSize 							 += "<option value=\"7\">7</option>";

var lblErrorPreload 	 = "Error preloading content.";
var lblSearchConfirm 	 =  "The search expression [SF] was found [RUNCOUNT] time(s).\n\n"; // Leave in [SF], [RUNCOUNT] and [RW]
lblSearchConfirm			 += "Are you sure you want to replace these entries with [RW] ?\n";
var lblSearchAbort 		 = "Operation Aborted.";
var lblSearchNotFound	 = "was not found.";
var lblCountTotal	     = "Total Word Count";
var lblCountSelection    = "Selection Word Count"; // Added by Erel
var lblCountChar	     = "Available Characters";
var lblCountCharWarn   = "Warning! Your content is too long and may not save correctly.";

var lblLinkType			 	 = "Link Type";
var lblLinkOldA				 = "existing anchor";
var lblLinkNewA 	 		 = "new anchor";
var lblLinkNoA     		 = "No Existing Anchors";
var lblLinkAnchors 		 = "Anchors";
var lblLinkAddress		 = "Address";
var lblLinkText		 		 = "Link Text";
var lblLinkOpenIn			 = "Open Link In";
var lblLinkVal0        = "Please enter a url.";
var lblLinkSubmit 		 = "OK";
var lblLinkCancel			 = "Cancel";
var lblImageURL			 	 = "Image URL";
var lblImageAltText		 = "Alternative Text";
var lblImageBorder 	 	 = "Border";
var lblImageBorderPx 	 = "Pixels";
var lblImageVal0     	 = "Please indicate the \"Image URL\".";
var lblImageSubmit 		 = "OK";
var lblImageCancel		 = "Cancel";
var lblTableRows			 = "Rows";
var lblTableColumns		 = "Columns";
var lblTableWidth 	 	 = "Table width";
var lblTablePx     		 = "pixels";
var lblTablePercent 	 = "percent";
var lblTableBorder		 = "Border thickness";
var lblTablePadding		 = "Cell padding";
var lblTableSpacing		 = "Cell spacing";
var lblTableSubmit 		 = "OK";
var lblTableCancel		 = "Cancel";
var lblSearchFind			 = "Find what";
var lblSearchReplace 	 = "Replace with";
var lblSearchMatch     = "Match case";
var lblSearchWholeWord = "Find whole words only";
var lblSearchVal0			 = "You must enter something into \"Find what:\".";
var lblSearchSubmit		 = "OK";
var lblSearchCancel		 = "Cancel";
var lblPasteTextHint   = "Hint: To paste you can either right-click and choose \"Paste\" or use the key combination of Ctrl-V.<br><br>";
var lblPasteTextVal0   = "Please enter text."
var lblPasteTextSubmit = "OK";
var lblPasteTextCancel = "Cancel";
var lblPasteWordHint   = "Hint: To paste you can either right-click and choose \"Paste\" or use the key combination of Ctrl-V.<br><br>";
var lblPasteWordVal0   = "Please enter text."
var lblPasteWordSubmit = "OK";
var lblPasteWordCancel = "Cancel";


var lblAutoBR					 = "Use Auto Line Breaks";
var lblRawHTML			 	 = "Use Only Raw HTML";
var lblnon_designMode  = 'To use the Rich Text Editor, a <a href="http://www.mozilla.org/" target="_new">Mozilla 1.3+</a> browser (eg, <a href="http://www.mozilla.org/products/firefox/" target=_new>Firefox</a>) or <a href="http://www.microsoft.com/windows/ie/default.asp" target="_new">MS IE5+</a> (Windows) are required. Apple Safari, IE5(Mac) and Opera browsers are not currently supported and all text must be in HTML.';


/* _script/rte */






var minWidth = 640;					// minumum width
var wrapWidth = 1245; 			//width at which all icons will appear on one bar
var maxchar = 64000;        // maximum number of characters per save



var lang_direction = "ltr";           // localization attribute added by Erel
var lang = "en"; 						//xhtml language
var encoding = "iso-8859-1"; 		//xhtml encoding, english only use "iso-8859-1"
if (document.body.lang != "en") {
	lang_direction = "rtl";
	lang = "he";
	encoding = "windows-1255";
}





var zeroBorder = "#c0c0c0"; //guideline color - see showGuidelines()
var btnText = "submit";			//Button value for non-designMode() & fullsceen rte
var resize_fullsrcreen = true;

var keep_absolute = true; // !!!Disabled - see line 456 for details!!!!!  

var InsertChar;
var InsertTable;
var InsertLink;
var InsertImg;
var dlgReplace;
var dlgPasteText;
var dlgPasteWord;

var ua = navigator.userAgent.toLowerCase();
var isIE = ((ua.indexOf("msie") != -1) && (ua.indexOf("opera") == -1) && (ua.indexOf("webtv") == -1))? true:false;
var isIE7 = ((isIE) && (ua.indexOf("msie 7.") != -1))? true:false;
var	isChrome = (ua.indexOf("chrome") != -1)? true:false;
var	isGecko = (ua.indexOf("gecko") != -1 || isChrome)? true:false;
var	isSafari = (ua.indexOf("safari") != -1)? true:false;
var	isKonqueror = (ua.indexOf("konqueror") != -1)? true:false;

var rng;  // global range
var currentRTE;
var allRTEs = "";
var obj_width;
var obj_height;
var imagesPath;
var includesPath;
var cssFile;
var generateXHTML = true;
var isRichText = false;
if(document.getElementById && document.designMode /*&& !isSafari */&& !isKonqueror) isRichText = true;

function initRTE(imgPath, incPath, css, genXHTML){
	// CM 05/04/05 check args for compatibility with old RTE implementations
	if (arguments.length == 3) {
		genXHTML = generateXHTML;
	}
	//set paths vars
	imagesPath = imgPath;
	includesPath = incPath;
	cssFile = css;
	generateXHTML = genXHTML;
	if(isRichText) document.writeln('<style type="text/css">@import "' + includesPath + 'rte.css";</style>');
	if(!isIE){
	  minWidth = minWidth-48;
	  wrapWidth = wrapWidth-102;
	}
}


function setRTE(rte, html, css, readOnly) {
	document.getElementById('hdn' + rte).value = html;  
	if(document.all){
		enableDesignMode(rte, css? css: cssFile, readOnly);  // enableDesignMode(rte, html, css, readOnly);
	}else{
		document.getElementById(rte).contentDocument.body.innerHTML = html;
	}
}


/* Doesn't work on IE! */
function setRTESize(rte,width,height) {
	var oRTE = document.getElementById(rte);
	var sRTE = document.getElementById('size'+rte);
	var oBut1 = document.getElementById('Buttons1_'+rte);
	var oVS = document.getElementById('vs'+rte);

	if (isIE) {
		oRTE.style = "width:"+(width-2)+"px; height:"+height+"px";  // Doesn't work!
	}
	else {
		oRTE.style.width = "" + width-2 + "px";
		oRTE.style.height = "" + height + "px";
	}

	if (sRTE) sRTE.value = height;
	if (oBut1) oBut1.style.width = "" + width + "px";
	if (oVS) oVS.style.width = "" + width + "px";
}



function showHideRTE(rte, showHide) {
	var display = (showHide == 'show'? '': 'none');
	// not all parts exist for each rte, so we ignore errors
	try {document.getElementById('Buttons1_'+rte).style.display = display ; } catch(e) {}
	try {document.getElementById('Buttons2_'+rte).style.display = display ; } catch(e) {}
	try {document.getElementById('vs'+rte).style.display = display ; } catch(e) {}
	if (isIE) {	document.getElementById(rte).style.display = display;	}
	else showHideElement(rte, showHide, false);  // "true" causes an error in Mozilla
}



function writeRichText(rte, html, css, width, height, buttons, readOnly, fullscreen) {
	currentRTE = rte;
	if(allRTEs.length > 0) allRTEs += ";";
	allRTEs += rte;
	// CM 06/04/05 stops single quotes from messing everything up
	html=replaceIt(html,'\'','&apos;');
	// CM 05/04/05 a bit of juggling for compatibility with old RTE implementations
	if (arguments.length == 6) {
		fullscreen = false;
		readOnly = buttons;
		buttons = height;
		height = width;
		width = css;
		css = "";
	}
	
	var iconWrapWidth = wrapWidth;
	if(readOnly) buttons = false;
	if(fullscreen)
	{
		readOnly = false; // fullscreen is not readOnly and must show buttons
		buttons = true;
		// resize rte on resize if the option resize_fullsrcreen = true.
		if(isRichText && resize_fullsrcreen) window.onresize = resizeRTE;
		document.body.style.margin = "0px";
		document.body.style.overflow = "hidden";
		//adjust maximum table widths
		findSize("");
		width = obj_width;
		if(width < iconWrapWidth) {
			height = (obj_height - 83);
		}else{
			height = (obj_height - 55);
		}
		if (width < minWidth){
			document.body.style.overflow = "auto";
			if(isIE){
				height = obj_height-22;
			}else{
				height = obj_height-24;
			}
			width = minWidth;
		}
		var tablewidth = width;
	}else{
		fullscreen = false;
		iconWrapWidth = iconWrapWidth-25;
		//adjust minimum table widths
		if (buttons && (width < minWidth)) width = minWidth;
		if(isIE){
			var tablewidth = width;
		}else{
			var tablewidth = width + 4;
		}
	}
	if(isRichText){
		var rte_css = "";
		if(css.length > 0) {
			rte_css = css;
		}else{
			rte_css = cssFile;
		}
		document.writeln('<div class="rteDiv">'); // Erel: changed from "span" to "div"
		if(buttons){
			document.writeln('<table class="rteBk" cellpadding=0 cellspacing=0 id="Buttons1_'+rte+'" width="' + tablewidth + '">');
			document.writeln('<tbody><tr>');
			insertBar();
			//document.writeln('<td><input type="image" class="rteImg" src="'+imagesPath+'save.gif" alt="'+lblSave+'" title="'+lblSave+'" onmouseover="this.className=\'rteImgUp\'" onmouseout="this.className=\'rteImg\'" onmousedown="this.className=\'rteImgDn\'" onmouseup="this.className=\'rteImgUp\'"></td>');
			insertImg(lblPrint,"print.gif","rtePrint('"+rte+"')");
			insertSep();
			insertImg(lblSelectAll,"selectall.gif","toggleSelection('"+rte+"')");
			insertImg(lblUnformat,"unformat.gif","rteCommand('"+rte+"','removeformat')");
			insertSep();
			if(isIE){
				insertImg(lblCut,"cut.gif","rteCommand('"+rte+"','cut')");
				insertImg(lblCopy,"copy.gif","rteCommand('"+rte+"','copy')");
				insertImg(lblPaste,"paste.gif","rteCommand('"+rte+"','paste')");
			}
			insertImg(lblPasteText,"pastetext.gif","dlgLaunch('"+rte+"','text')");
			insertImg(lblPasteWord,"pasteword.gif","dlgLaunch('"+rte+"','word')");
			insertSep();
			insertImg(lblUndo,"undo.gif","rteCommand('"+rte+"','undo')");
			insertImg(lblRedo,"redo.gif","rteCommand('"+rte+"','redo')");
			insertSep();
			document.writeln('<td><select id="formatblock_'+rte+'" onchange="selectClass(\''+rte+'\', this.id);" style="font-size:14px;width:155px;height:20px;margin:1px;">');  // Erel 2006/05/26: replaced "selectFont" with "selectClass"; added 50px for longer-named styles
			document.writeln(lblFormat);
			document.writeln('</select></td><td>');
			document.writeln('<select id="fontname_'+rte+'" onchange="selectFont(\''+rte+'\', this.id)" style="font-size:14px;width:125px;height:20px;margin:1px;">');
			document.writeln(lblFont);
			document.writeln('</select></td><td>');
	
			// Erel: removed 'unselectable="on"'
			document.writeln('<select id="fontsize_'+rte+'" onchange="selectFont(\''+rte+'\', this.id);" style="font-size:14px;width:75px;height:20px;margin:1px;">');
			document.writeln(lblSize);
			document.writeln('</select></td>');
			if(tablewidth < iconWrapWidth){
				document.writeln('<td width="100%"></td></tr></tbody></table>');
				document.writeln('<table class="rteBk" cellpadding="0" cellspacing="0" id="Buttons2_'+rte+'" width="' + tablewidth + '">');
				document.writeln('<tbody><tr>');
			}
			insertBar();
			insertImg(lblBold,"bold.gif","rteCommand('"+rte+"','bold')");
			insertImg(lblItalic,"italic.gif","rteCommand('"+rte+"','italic')");
			insertImg(lblUnderline,"underline.gif","rteCommand('"+rte+"','underline')");
			insertSep();
			insertImg(lblStrikeThrough,"strikethrough.gif","rteCommand('"+rte+"','strikethrough')");
			insertImg(lblSuperscript,"superscript.gif","rteCommand('"+rte+"','superscript')");
			insertImg(lblSubscript,"subscript.gif","rteCommand('"+rte+"','subscript')");
			insertSep();
			insertImg(lblAlgnLeft,"left_just.gif","rteCommand('"+rte+"','justifyleft')");
			insertImg(lblAlgnCenter,"centre.gif","rteCommand('"+rte+"','justifycenter')");
			insertImg(lblAlgnRight,"right_just.gif","rteCommand('"+rte+"','justifyright')");
			insertImg(lblJustifyFull,"justifyfull.gif","rteCommand('"+rte+"','justifyfull')");
			insertSep();
			insertImg(lblOL,"numbered_list.gif","rteCommand('"+rte+"','insertorderedlist')");
			insertImg(lblUL,"list.gif","rteCommand('"+rte+"','insertunorderedlist')");
			insertImg(lblOutdent,"outdent.gif","rteCommand('"+rte+"','outdent')");
			insertImg(lblIndent,"indent.gif","rteCommand('"+rte+"','indent')");
			insertSep();
			insertImg(lblTextColor,"textcolor.gif","dlgColorPalette('"+rte+"','forecolor')","forecolor_"+rte);
			insertImg(lblBgColor,"bgcolor.gif","dlgColorPalette('"+rte+"','hilitecolor')","hilitecolor_"+rte);
			insertSep();
			insertImg(lblHR,"hr.gif","rteCommand('"+rte+"','inserthorizontalrule')");
			insertSep();
			insertImg(lblInsertChar,"special_char.gif","dlgLaunch('"+rte+"','char')");
			insertImg(lblInsertLink,"hyperlink.gif","dlgLaunch('"+rte+"','link')");
			insertImg(lblAddImage,"image.gif","dlgLaunch('"+rte+"','image')");
			insertImg(lblInsertTable,"insert_table.gif","dlgLaunch('"+rte+"','table')");
			insertSep();
			insertImg(lblSearch,"replace.gif","dlgLaunch('"+rte+"','replace')");
			insertImg(lblWordCount,"word_count.gif","countWords('"+rte+"')");
			if(isIE)insertImg(lblSpellCheck,"spellcheck.gif","checkspell()");
			document.writeln('<td width="100%"></td></tr></tbody></table>');
		}
		document.writeln('<iframe id="'+rte+'" width="' + (tablewidth - 2) + 'px" height="' + height + 'px" frameborder=0 style="border: 1px solid #d2d2d2" src="' + includesPath + 'blank.htm" onfocus="dlgCleanUp();"></iframe>');
		if(!readOnly){
		  document.writeln('<table id="vs'+rte+'" class="rteBk" cellpadding=0 cellspacing=0 border=0 width="' + tablewidth + '"><tr>');
			document.writeln('<td onclick="toggleHTMLSrc(\''+rte+'\', ' + buttons + ');" nowrap><img class="rteBar" src="'+imagesPath+'bar.gif" alt="" align=absmiddle><span id="imgSrc'+rte+'"><img src="'+imagesPath+'code.gif" alt="" title="" style="margin:1px;" align=absmiddle></span><span id="txtSrc'+rte+'" style="font-family:tahoma,sans-serif;font-size:12px;color:#0000ff;CURSOR: default;">'+lblModeHTML+'</span></td>');
			document.writeln('<td width="100%" nowrap>&nbsp;</td></tr></table>');
		}
		document.writeln('<iframe width="142" height="98" id="cp'+rte+'" src="' + includesPath + 'palette.htm" scrolling="no" frameborder=0 style="margin:0;border:0;visibility:hidden;position:absolute;border:1px solid #cdcdcd;top:-1000px;left:-1000px"></iframe>');
		document.writeln('<input type="hidden" id="hdn'+rte+'" name="'+rte+'" value="" style="position: absolute;left:-1000px;top:-1000px;">');
		if(!fullscreen) document.writeln('<input type="hidden" id="size'+rte+'" value="'+height+'" style="position: absolute;left:-1000px;top:-1000px;">');
		document.writeln('</div><!--rteDiv-->');  // Erel: changed from "span" to "div"
		document.getElementById('hdn'+rte).value = html;  
		enableDesignMode(rte, rte_css, readOnly);            // "html" parameter removed by Erel -- see function definition
	}
	else{
		buttons = false;
		if(fullscreen && height > 90) height = (height - 75);tablewidth=tablewidth-30;
		// CM non-designMode() UI
		html = parseBreaks(html);
		document.writeln('<div style="font:12px Verdana, Arial, Helvetica, sans-serif;width: ' + tablewidth + 'px;padding:15px;">');
		if(!readOnly){
		  document.writeln('<div style="color:gray">'+lblnon_designMode+'</div><br>');
		  document.writeln('<input type="radio" name="' + rte + '_autobr" value="1" checked="checked" onclick="autoBRon(\'' + rte + '\');" /> '+lblAutoBR+'<input type="radio" name="' + rte + '_autobr" value="0" onclick="autoBRoff(\'' + rte + '\');" />'+lblRawHTML+'<br>');
		  document.writeln('<textarea name="'+rte+'" id="'+rte+'" style="width: ' + tablewidth + 'px; height: ' + height + 'px;">' + html + '</textarea>');
		}else{
			document.writeln('<textarea name="'+rte+'" id="'+rte+'" style="width: ' + tablewidth + 'px; height: ' + height + 'px;" readonly=readonly>' + html + '</textarea>');
		}
		if(fullscreen) document.writeln('<br><input type="submit" value="'+btnText+'" />');
		document.writeln('</div>');
	}
}


function insertBar(){
	document.writeln('<td><img class="rteBar" src="'+imagesPath+'bar.gif" alt=""></td>');
}
function insertSep(){
	document.writeln('<td><img class="rteSep" src="'+imagesPath+'blackdot.gif" alt=""></td>');
}
function insertImg(name, image, command, id){
	var td = "<td>";
	if(id!=null) td = "<td id='"+id+"'>";
	document.writeln(td+'<img class="rteImg" src="'+imagesPath+image+'" alt="'+name+'" title="'+name+'" onClick="'+command+'" onmouseover="this.className=\'rteImgUp\'" onmouseout="this.className=\'rteImg\'" onmousedown="this.className=\'rteImgDn\'" onmouseup="this.className=\'rteImgUp\'"></td>');
}



function enableDesignMode(rte, css, readOnly) {
	html = document.getElementById('hdn'+rte).value;       // line added by Erel
	var frameHtml = "<html dir='" + lang_direction + "' lang='" + lang + "' id='" + rte + "'>\n<head>\n";
	frameHtml += "<meta http-equiv='Content-Type' content='text/html; charset=" + encoding + "'>\n";
	frameHtml += "<meta http-equiv='Content-Language' content='" + lang + "'>\n";

	if(css.length > 0){
	  frameHtml += "<link media=\"all\" type=\"text/css\" href=\"" + css + "\" rel=\"stylesheet\">\n";
	}
	else {
	  // styles changed by Erel
	  frameHtml += "<style>" + 
	  	"@charset \"utf-8\"; " + 
		"body            { font-weight:normal; font-size:1.25em }" + 
		"small           { font-size: 0.6em }" + 
		"li table td { font-size: 0.7em }" + 
		"cite, .citut { font-weight: bolder; font-family: serif; font-style: normal; font-size:1.1em }" + 
		"cite small, .citut small, small cite, small .citut {font-size: 0.6em}" + 
		"textarea, input { font-family: 'Courier New', 'Courier', monospace; font-size: 0.6em }" + 
		"textarea.code   { font-size: 0.6em }" + 
		"button          { font-size: 0.6em }" + 
		"table  {border-spacing: 0}" + 
		"table td {border-style:ridge; border-width:1pt}" + 

		
		"h1           { font-weight:normal; font-size:2.5em; text-align:center; margin:auto }" + 
		"h2           { font-weight:normal; font-size:1.6em }" + 
		"h3           { font-weight:normal; font-size:1.3em }" + 
		"h4           { font-weight:normal; font-size:1.2em }" + 
		"h5           { font-weight:normal; font-size:1.1em }" + 
		"h6           { font-weight:normal; font-size:1em }" + 
		
		"td { vertical-align:top }" + 
		"form table tr { background:#dfdfdf; color:black  }" + 
		"form {border: dotted 1pt; margin:1em}" + 
		".notes {font-style:italic; font-size:smaller}" + 
		".requirements {color:#880000}" + 
		".field {border: solid 1pt black; padding-right:10em}" + 
		"a u, a .u {font-weight: bolder; border-bottom: solid 1px}" + 
		".u { text-decoration:underline }" + 
		"h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {text-decoration:none}" + 

		"div.lang  { border-top: 1px solid #eeeeee; border-bottom: 1px solid #eeeeee; padding-top: 1em }" + 
		"span.lang { border-left: 1px solid #eeeeee; border-right: 1px solid #eeeeee }" + 
		
		"textarea.code { background:#eeeeff; color:black; margin:auto }" + 
		"button {margin:auto; text-align:center}" + 
		"body.jsfunction, body.jsalgorithm { text-align:center; margin:auto }" + 
	
		"li table {border: none}" + 
		"li table td {border: groove 1.1px rgb(230,230,184)}" + 
		"li table td a {text-decoration: none}" + 
		
		".advanced, .revisions {background-color:#eee; border:dotted 1pt}" + 
		".versionid {border: solid 1pt #008; background: #ccf; margin:0 2em 0 2em; text-align:center; width:4em}" + 
		".future {font-size:smaller; background-color:#ccc}" + 
		"a.psuq {font-size:10px}" + 

		/* styles for sikum.php */

		"#etnachta {background:#fee}" + 
		
		"#mikraotgdolot {background:#eef}" + 
		"#mikraotgdolot #toc {display:none}" + 
		"#mikraotgdolot .links_in_title {display:none}" + 
		
		"#mamrim {background:#efe}" + 
		"#mamrim .skipped {font-size:10px}" + 
	


		"q:before {content: no-open-quote;}" + 
		"q:after {content: no-close-quote;}" + 
		"cite, .citut, q { font-family: serif; font-style: normal; font-size:1.1em }" + 
		"q      { color: #800 }" + 
		"q.psuq { color: #008; font-weight: bolder }" + 
		"q.mfrj { color: #080; font-weight: normal }" + 

		"body {background:#FFFFFF;margin:8px;padding:0px;font-size:15pt}" + 
		"</style>\n";   // style change by Erel
	}
	frameHtml += "</head><body class='RTE'>\n"+html+"\n</body></html>";     // class attribute added by Erel
	
	var oRTE = returnRTE(rte).document;
	if(document.all){
		oRTE.open();
		oRTE.write(frameHtml);
		oRTE.close();
		if(!readOnly){
			oRTE.designMode = "On";
		}
	}else{
		try{
			// Commented out the following line to confront a bug when loading multiple RTEs on one page in a MOZ browser
			// Fix provided by "Kings". Safari may have problems with this snytax - unable to test because I don't own a MAC.(Tim Bell)
			//
			if(!readOnly) document.getElementById(rte).contentDocument.designMode = "on";
			//if(!readOnly) {
			//	addLoadEvent(function() { document.getElementById(rte).contentDocument.designMode = "on"; });
			//}
			try{
				oRTE.open();
				oRTE.write(frameHtml);
				oRTE.close();
				if(isGecko && !readOnly){
				  //attach a keyboard handler for gecko browsers to make keyboard shortcuts work
				  oRTE.addEventListener("keypress", geckoKeyPress, true);
				  oRTE.addEventListener("focus", function (){dlgCleanUp()}, false);
				}
			}catch(e){
				alert(lblErrorPreload + ": " + e);   // added by Erel for clearer error diagnostics
			}
		}catch(e){
			dump('\nenableDesignMode(' + rte + ', ' + css + ', ' + readOnly + ')\n catch: ' + e + '\n');     // dump added by Erel for diagnostics
			//gecko may take some time to enable design mode.
			//Keep looping until able to set.
			if(isGecko){
				setTimeout("enableDesignMode('"+rte+"', '"+css+"', "+readOnly+");", 200); 
					// html parameter removed by Erel -- see function definition
			}else{
			  return false;
			}
		}
	}
	setTimeout('showGuidelines("'+rte+'")',300);
}


function addLoadEvent(func) {
	 var oldonload = window.onload;
	 if (typeof window.onload != 'function') {
	    window.onload = func;
	 } else {
	    window.onload = function() {
	       oldonload();
	       func();
	    }
	 }
}

function returnRTE(rte) {
	var rtn;
	if(document.all){
		rtn = frames[rte];
	}else{
		rtn = document.getElementById(rte).contentWindow;
	}
	return rtn;
}

function updateRTE(rte) {
	if(isRichText) {
		dlgCleanUp(); // 	Closes Pop-ups
		stripGuidelines(rte); // Removes Table Guidelines 
		// [Erel thinks the previous line is redundant because it is already done in parseRTE]
		// [Timm Bell says: "I can't remember the reason why stripGuidelines(rte); was added to updateRTE(), but it was added to fix a bug."]
	}
	parseRTE(rte);
}

function parseRTE(rte) {
	if (!isRichText) {
		 autoBRoff(rte); // sorts out autoBR
		 return false;
	}
	//check for readOnly mode
	var readOnly = false;
	var oRTE = returnRTE(rte);
	if(document.all){
		if (oRTE.document.designMode != "On") readOnly = true;
	}else{
		if (oRTE.document.designMode != "on") readOnly = true;
	}

	if(isRichText && !readOnly){
		//if viewing source, switch back to design view
		if(document.getElementById("txtSrc"+rte).innerHTML == lblModeRichText){
			if(document.getElementById("Buttons1_"+rte)){
				 toggleHTMLSrc(rte, true);
			}
			else{
				toggleHTMLSrc(rte, false);
			}
			stripGuidelines(rte);
		}
		setHiddenVal(rte);
	}
}

function setHiddenVal(rte){
	//set hidden form field value for current rte
	var oHdnField = document.getElementById('hdn'+rte);
	//convert html output to xhtml (thanks Timothy Bell and Vyacheslav Smolin!)
	if(oHdnField.value == null) oHdnField.value = "";
	var sRTE = returnRTE(rte).document.body;
	if(generateXHTML){
	  try{
		  oHdnField.value = get_xhtml(sRTE, lang, encoding);
	  }catch(e){
	    oHdnField.value = sRTE.innerHTML;
	  }
	}else{
	  oHdnField.value = sRTE.innerHTML;
	}
	// fix to replace special characters added here: 
	oHdnField.value = replaceSpecialChars(oHdnField.value); 
	//if there is no content (other than formatting) set value to nothing
	if(stripHTML(oHdnField.value.replace("&nbsp;", " ")) == "" &&
		oHdnField.value.toLowerCase().search("<hr") == -1 &&
		oHdnField.value.toLowerCase().search("<img") == -1) oHdnField.value = "";
}

function updateRTEs(){
	var vRTEs = allRTEs.split(";");
	for(var i=0; i<vRTEs.length; i++){
		updateRTE(vRTEs[i]);
	}
}

function rteCommand(rte, command, option){
	dlgCleanUp();
	//function to perform command
	var oRTE = returnRTE(rte);
	try{
		oRTE.focus();
		oRTE.document.execCommand(command, false, option);
		oRTE.focus();
	}catch(e){
	}
}

function toggleHTMLSrc(rte, buttons){
	dlgCleanUp();
	//contributed by Bob Hutzel (thanks Bob!)
	var cRTE = document.getElementById(rte);
	var hRTE = document.getElementById('hdn'+rte);
	var sRTE = document.getElementById("size"+rte);
	var tRTE = document.getElementById("txtSrc"+rte);
	var iRTE = document.getElementById("imgSrc"+rte);
	var oRTE = returnRTE(rte).document;
	if(sRTE){
		obj_height = parseInt(sRTE.value);
	}else{
		findSize(rte);
	}
	if(tRTE.innerHTML == lblModeHTML){
		//we are checking the box
		tRTE.innerHTML = lblModeRichText;
		stripGuidelines(rte);
		if(buttons){
			showHideElement("Buttons1_" + rte, "hide", true);
			if(document.getElementById("Buttons2_"+rte)){
				showHideElement("Buttons2_" + rte, "hide", true);
				cRTE.style.height = obj_height+56;
			}else{
				cRTE.style.height = obj_height+28;
			}
		}
		setHiddenVal(rte);
		if(document.all){
			oRTE.body.innerText = hRTE.value;
		}else{
			var htmlSrc = oRTE.createTextNode(hRTE.value);
			oRTE.body.innerHTML = "";
			oRTE.body.appendChild(htmlSrc);
		}
		iRTE.innerHTML = '<img src="'+imagesPath+'design.gif" alt="Switch Mode" style="margin:1px;" align=absmiddle>';
	}else{
		//we are unchecking the box
		obj_height = parseInt(cRTE.style.height);
		tRTE.innerHTML = lblModeHTML;
		if(buttons){
			showHideElement("Buttons1_" + rte, "show", true);
			if(document.getElementById("Buttons2_"+rte)){
				showHideElement("Buttons2_" + rte, "show", true);
				cRTE.style.height = obj_height-56;
			}else{
				cRTE.style.height = obj_height-28;
			}
		}
		if(document.all){
			//fix for IE
			var output = escape(oRTE.body.innerText);
			output = output.replace("%3CP%3E%0D%0A%3CHR%3E", "%3CHR%3E");
			output = output.replace("%3CHR%3E%0D%0A%3C/P%3E", "%3CHR%3E");
			oRTE.body.innerHTML = unescape(output);
			// Disabled due to flaw in the regular expressions, this fix 
	    // does not work with the revamped's enhanced insert link dialog window.
	    //
	    // Prevent links from changing to absolute paths
	    if(!keep_absolute){
	      var tagfix = unescape(output).match(/<a[^>]*href=(['"])([^\1>]*)\1[^>]*>/ig); 
	      var coll = oRTE.body.all.tags('A'); 
	      for(i=0; i<coll.length; i++){ 
	        // the 2 alerts below show when we hinder the links from becoming absolute			
	        //alert(tagfix[i]); 
	        coll[i].href = tagfix[i].replace(/.*href=(['"])([^\1]*)\1.*/i,"$2"); 
	        //alert(RegExp.$1 + " " + RegExp.$2 + " " + RegExp.$3); 
	      } 
	      var imgfix = unescape(output).match(/<img[^>]*src=['"][^'"]*['"][^>]*>/ig); 
	      var coll2 = oRTE.body.all.tags('IMG'); 
	      for(i=0; i<coll2.length; i++){ 
	        coll2[i].src = imgfix[i].replace(/.*src=['"]([^'"]*)['"].*/i,"$1"); 
	      } 
	    }
	    //end path fix			
		}else{
	 		var htmlSrc = oRTE.body.ownerDocument.createRange();
			htmlSrc.selectNodeContents(oRTE.body);
			oRTE.body.innerHTML = htmlSrc.toString();
		}
		oRTE.body.innerHTML = replaceSpecialChars(oRTE.body.innerHTML);
		showGuidelines(rte);
		// (IE Only)This prevents an undo operation from displaying a pervious HTML mode
		// This resets the undo/redo buffer.
		if(document.all){
			parseRTE(rte);
	  }
	  iRTE.innerHTML = '<img src="'+imagesPath+'code.gif" alt="Switch Mode" style="margin:1px;" align=absmiddle>';
	}
}

function toggleSelection(rte) {
	var rng = getRange(rte);
	var oRTE = returnRTE(rte).document;
	var length1;
	var length2;
	if(document.all){
		length1 = rng.text.length;
		var output = escape(oRTE.body.innerText);
		output = output.replace("%3CP%3E%0D%0A%3CHR%3E", "%3CHR%3E");
		output = output.replace("%3CHR%3E%0D%0A%3C/P%3E", "%3CHR%3E");
		length2 = unescape(output).length;
	}else{
		length1 = rng.toString().length;
		var htmlSrc = oRTE.body.ownerDocument.createRange();
		htmlSrc.selectNodeContents(oRTE.body);
	  length2 = htmlSrc.toString().length;
	}
	if(length1 < length2){
	  rteCommand(rte,'selectall','');
	} else {
		if(!document.all){
		  oRTE.designMode = "off";
		  oRTE.designMode = "on";
		}else{
		  rteCommand(rte,'unselect','');
		}
	}
}

function dlgColorPalette(rte, command) {
	//function to display or hide color palettes
	setRange(rte);
	//get dialog position
	var oDialog = document.getElementById('cp' + rte);
	var buttonElement = document.getElementById(command+"_"+rte);
	var iLeftPos = buttonElement.offsetLeft+5; 
	var iTopPos = buttonElement.offsetTop+53;
	if (!document.getElementById('Buttons2_'+rte)) iTopPos = iTopPos-28;
	oDialog.style.left = iLeftPos + "px";
	oDialog.style.top = iTopPos + "px";
	
	if((command == parent.command)&&(rte == currentRTE)){
		//if current command dialog is currently open, close it
		if(oDialog.style.visibility == "hidden"){
			showHideElement(oDialog, 'show', false);
		}else{
			showHideElement(oDialog, 'hide', false);
		}
	}else{
		//if opening a new dialog, close all others
		var vRTEs = allRTEs.split(";");
		for(var i = 0; i<vRTEs.length; i++){
			showHideElement('cp' + vRTEs[i], 'hide', false);
		}
		showHideElement(oDialog, 'show', false);
	}
	//save current values
	currentRTE = rte;
	parent.command = command;
}

function dlgLaunch(rte, command) {
	var selectedText = '';
	//save current values
	parent.command = command;
	currentRTE = rte;
	switch(command){
	case "char":
	  InsertChar = popUpWin(includesPath+'insert_char.htm', 'InsertChar', 50, 50, 'status=yes,');
	  break;
	case "table":
	  InsertTable = popUpWin(includesPath + 'insert_table.htm', 'InsertTable', 50, 50, 'status=yes,');
	  break;
	case "image":
	  setRange(rte);
	  parseRTE(rte);
	  InsertImg = popUpWin(includesPath + 'insert_img.htm','AddImage', 50, 50, 'status=yes,');
	  break;
	case "link":
	  selectedText = getText(rte);
	  InsertLink = popUpWin(includesPath + 'insert_link.htm', 'InsertLink', 50, 50, 'status=yes,');
	  setFormText("0", selectedText);
	  break;
	case "replace":
	  selectedText = getText(rte);
	  dlgReplace = popUpWin(includesPath + 'replace.htm', 'dlgReplace', 50, 50, 'status=yes,');
	  setFormText("1", selectedText);
	  break;
	case "text":
	  dlgPasteText = popUpWin(includesPath + 'paste_text.htm', 'dlgPasteText', 50, 50, 'status=yes,');
	  break;
	case "word":
	  dlgPasteWord = popUpWin(includesPath + 'paste_word.htm', 'dlgPasteWord', 50, 50, 'status=yes,');
	  break;
	}
}

function getText(rte) {
	//get currently highlighted text and set link text value
	setRange(rte);
	var rtn = '';
	if (isIE) {
	  rtn = stripHTML(rng.htmlText);
	} else {
	  rtn = stripHTML(rng.toString());
	}
	parseRTE(rte);
	if(document.all){
	  rtn = rtn.replace(/'/g,"\\\\\\'");    // Erel 2006/05/26: added "g" to fix double-quote bug
	}else{
	  rtn = rtn.replace(/'/g,"\\'");        // Erel 2006/05/26: added "g" to fix double-quote bug
	}
	return rtn;
}

function setFormText(popup, content){
	//set link text value in dialog windows
	if(content != "undefined")
	{
	  try{
		  switch(popup){
		    case "0": InsertLink.document.getElementById("linkText").value = content; break;
		    case "1": dlgReplace.document.getElementById("searchText").value = content; break;
		  }
	  }catch(e){
		  //may take some time to create dialog window.
		  //Keep looping until able to set.
		  setTimeout("setFormText('"+popup+"','" + content + "');", 10);
	  }
	}
}

function dlgCleanUp(){
	var vRTEs = allRTEs.split(";");
	for(var i = 0; i < vRTEs.length; i++){
		showHideElement('cp' + vRTEs[i], 'hide', false);
	}
	if(InsertChar!=null) InsertChar.close();InsertChar=null;
	if(InsertTable!=null) InsertTable.close();InsertTable=null;
	if(InsertLink!=null) InsertLink.close();InsertLink=null;
	if(InsertImg!=null) InsertImg.close();InsertImg=null;
	if(dlgReplace!=null) dlgReplace.close();dlgReplace=null;
	if(dlgPasteText!=null) dlgPasteText.close();dlgPasteText=null;
	if(dlgPasteWord!=null) dlgPasteWord.close();dlgPasteWord=null;
}

function popUpWin (url, win, width, height, options) {
	dlgCleanUp();
	var leftPos = (screen.availWidth - width) / 2;
	var topPos = (screen.availHeight - height) / 2;
	options += 'width=' + width + ',height=' + height + ',left=' + leftPos + ',top=' + topPos;
	return window.open(url, win, options);
}

function setColor(color) {
	//function to set color
	var rte = currentRTE;
	var parentCommand = parent.command;
	if(document.all){
		if(parentCommand == "hilitecolor") parentCommand = "backcolor";
		//retrieve selected range
		rng.select();
	}
	rteCommand(rte, parentCommand, color);
	showHideElement('cp'+rte, "hide", false);
}

function addImage(rte) {
	dlgCleanUp();
	//function to add image
	imagePath = prompt('Enter Image URL:', 'http://');				
	if((imagePath != null)&&(imagePath != "")){
		rteCommand(rte, 'InsertImage', imagePath);
	}
}

function rtePrint(rte) {
	dlgCleanUp();
	if(isIE){
	  document.getElementById(rte).contentWindow.document.execCommand('Print');
	}else{
 	  document.getElementById(rte).contentWindow.print();
	}
}

function selectFont(rte, selectname){
	//function to handle font changes
	var idx = document.getElementById(selectname).selectedIndex;
	// First one is always a label
	if(idx != 0){
		var selected = document.getElementById(selectname).options[idx].value;
		document.getElementById(selectname).selectedIndex = 0;
		var cmd = selectname.replace('_'+rte, '');
		rteCommand(rte, cmd, selected);
	}
}

function tagIsBlock(tag) {
	return (tag=="div" || tag=="p" || tag=="blockquote");
}

function selectClass(rte, selectname) {
	//function to handle font changes
	var idx = document.getElementById(selectname).selectedIndex;
	// First one is always a label
	if(idx != 0){
		var selected = document.getElementById(selectname).options[idx].value;
		document.getElementById(selectname).selectedIndex = 0;
		
		var tag_class = selected.split(".");
		var tag = tag_class[0].toLowerCase();    // for XHTML compliance
		var cls = tag_class[1];

		if (tagIsBlock(tag) && !cls)     // keep previous behaviour when there is no class
			rteCommand(rte, "formatblock", (isIE? "<"+tag+">": tag) );  // "<" and ">" needed in IE, but don't work in Mozilla in some of the tags
		else
			setTagAndClass(rte, tag, cls);
	}
}

function setTagAndClass(rte, tag, cls) {
	var rng = getRange(rte);

	// rng.toString destroys the current formatting, so we use it only for non-block tags.
	// surroundContents doesn't enable UNDO in Mozilla, so we use it only for block-tags.
	if (isIE || !tagIsBlock(tag)) {
		var currentText = isIE? rng.htmlText: rng.toString(); // NOTE: toString clears the current formatting tags!
		var newHTML = 
			"<" + tag + 
				(cls?  " class='"+cls+"'":  "") + 
			">" + currentText + "</" + tag + ">";
		currentRTE = rte;  // because insertHTML uses global variable currentRTE
		insertHTML(newHTML);
	}
	else {      // for DIV styles on non-IE browsers
		var newNode = document.createElement(tag);
		newNode.className = cls;
		rng.surroundContents(newNode);  // NOTE: Mozilla doesn't undo this!
	}
}

function insertHTML(html){
	//function to add HTML -- thanks dannyuk1982
	var rte = currentRTE;
	var oRTE = returnRTE(rte);
	oRTE.focus();
	if(document.all){
		var oRng = oRTE.document.selection.createRange();
		oRng.pasteHTML(html);
		oRng.collapse(false);
		oRng.select();
	}else{
		oRTE.document.execCommand('insertHTML', false, html);
	}
}

function replaceHTML(tmpContent, searchFor, replaceWith) {
	var runCount = 0;
	var intBefore = 0;
	var intAfter = 0;
	var tmpOutput = "";
	while(tmpContent.toUpperCase().indexOf(searchFor.toUpperCase()) > -1) {
	  runCount = runCount+1;
	  // Get all content before the match
	  intBefore = tmpContent.toUpperCase().indexOf(searchFor.toUpperCase());
	  tmpBefore = tmpContent.substring(0, intBefore);
	  tmpOutput = tmpOutput + tmpBefore;
	  // Get the string to replace
	  tmpOutput = tmpOutput + replaceWith;
	  // Get the rest of the content after the match until
	  // the next match or the end of the content
	  intAfter = tmpContent.length - searchFor.length + 1;
	  tmpContent = tmpContent.substring(intBefore + searchFor.length);
	}
	return runCount+"|^|"+tmpOutput+tmpContent;
}

function replaceSpecialChars(html){ 
	 var specials = new Array("&cent;","&euro;","&pound;","&curren;","&yen;","&copy;","&reg;","&trade;","&divide;","&times;","&plusmn;","&frac14;","&frac12;","&frac34;","&deg;","&sup1;","&sup2;","&sup3;","&micro;","&laquo;","&raquo;","&lsquo;","&rsquo;","&lsaquo;","&rsaquo;","&sbquo;","&bdquo;","&ldquo;","&rdquo;","&iexcl;","&brvbar;","&sect;","&not;","&macr;","&para;","&middot;","&cedil;","&iquest;","&fnof;","&mdash;","&ndash;","&bull;","&hellip;","&permil;","&ordf;","&ordm;","&szlig;","&dagger;","&Dagger;","&eth;","&ETH;","&oslash;","&Oslash;","&thorn;","&THORN;","&oelig;","&OElig;","&scaron;","&Scaron;","&acute;","&circ;","&tilde;","&uml;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&ccedil;","&Ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&igrave;","&iacute;","&icirc;","&iuml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ntilde;","&Ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&ugrave;","&uacute;","&ucirc;","&uuml;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&yacute;","&yuml;","&Yacute;","&Yuml;"); 
	 var unicodes = new Array("\u00a2","\u20ac","\u00a3","\u00a4","\u00a5","\u00a9","\u00ae","\u2122","\u00f7","\u00d7","\u00b1","\u00bc","\u00bd","\u00be","\u00b0","\u00b9","\u00b2","\u00b3","\u00b5","\u00ab","\u00bb","\u2018","\u2019","\u2039","\u203a","\u201a","\u201e","\u201c","\u201d","\u00a1","\u00a6","\u00a7","\u00ac","\u00af","\u00b6","\u00b7","\u00b8","\u00bf","\u0192","\u2014","\u2013","\u2022","\u2026","\u2030","\u00aa","\u00ba","\u00df","\u2020","\u2021","\u00f0","\u00d0","\u00f8","\u00d8","\u00fe","\u00de","\u0153","\u0152","\u0161","\u0160","\u00b4","\u02c6","\u02dc","\u00a8","\u00e0","\u00e1","\u00e2","\u00e3","\u00e4","\u00e5","\u00e6","\u00c0","\u00c1","\u00c2","\u00c3","\u00c4","\u00c5","\u00c6","\u00e7","\u00c7","\u00e8","\u00e9","\u00ea","\u00eb","\u00c8","\u00c9","\u00ca","\u00cb","\u00ec","\u00ed","\u00ee","\u00ef","\u00cc","\u00cd","\u00ce","\u00cf","\u00f1","\u00d1","\u00f2","\u00f3","\u00f4","\u00f5","\u00f6","\u00d2","\u00d3","\u00d4","\u00d5","\u00d6","\u00f9","\u00fa","\u00fb","\u00fc","\u00d9","\u00da","\u00db","\u00dc","\u00fd","\u00ff","\u00dd","\u0178"); 
	 for(var i=0; i<specials.length; i++){ 
	    html = replaceIt(html,unicodes[i],specials[i]); 
	 } 
	 return html; 
}

function SearchAndReplace(searchFor, replaceWith, matchCase, wholeWord) {
	 var cfrmMsg = lblSearchConfirm.replace("SF",searchFor).replace("RW",replaceWith);
	 var rte = currentRTE;
	 stripGuidelines(rte);
	 var oRTE = returnRTE(rte);
	 var tmpContent = oRTE.document.body.innerHTML.replace("'", "\'").replace('"', '\"');
	 var strRegex;
	 if (matchCase && wholeWord) {
	    strRegex = "/(?!<[^>]*)(\\b(" + searchFor + ")\\b)(?![^<]*>)/g";
	 }
	 else if (matchCase) {
	    strRegex = "/(?!<[^>]*)(" + searchFor + ")(?![^<]*>)/g";
	 }
	 else if (wholeWord) {
	    strRegex = "/(?!<[^>]*)(\\b(" + searchFor + ")\\b)(?![^<]*>)/gi";
	 } else {
	    strRegex = "/(?!<[^>]*)(" + searchFor + ")(?![^<]*>)/gi";
	 }
	 var cmpRegex=eval(strRegex);
	 var runCount = 0;
	 var tmpNext = tmpContent;
	 var intFound = tmpNext.search(cmpRegex);
	 while(intFound > -1) {
	    runCount = runCount+1;
	    tmpNext = tmpNext.substr(intFound + searchFor.length);
	    intFound = tmpNext.search(cmpRegex);
	 }
	 if (runCount > 0) {
	    cfrmMsg = cfrmMsg.replace("[RUNCOUNT]",runCount);
	    if(confirm(cfrmMsg)) {
	       tmpContent=tmpContent.replace(cmpRegex,replaceWith);
	       oRTE.document.body.innerHTML = tmpContent.replace("\'", "'").replace('\"', '"');
	    } else {
	     alert(lblSearchAbort);
	  }
	    showGuidelines(rte);
	 }
	 else {
	   showGuidelines(rte);
	    alert("["+searchFor+"] "+lblSearchNotFound);
	 }
}
		
function showHideElement(element, showHide, rePosition){
	//function to show or hide elements
	//element variable can be string or object
	if(document.getElementById(element)){
		element = document.getElementById(element);
	}
	if(showHide == "show"){
		element.style.visibility = "visible";
		if(rePosition){
			element.style.position = "relative";
			element.style.left = "auto";
			element.style.top = "auto";
		}
	}else if(showHide == "hide"){
		element.style.visibility = "hidden";
		if(rePosition){
				element.style.position = "absolute";
				element.style.left = "-1000px";
				element.style.top = "-1000px";
		}
	}
}

function getRange(rte){
	var oRTE = returnRTE(rte);
	var rng;
	if(document.all){
		var selection = oRTE.document.selection;
		if(selection != null) rng = selection.createRange();
	}else{
		var selection = oRTE.getSelection();
		rng = selection.getRangeAt(selection.rangeCount - 1).cloneRange();
	}
	return rng;
}

function setRange(rte){
	rng = getRange(rte);
}



function stripHTML(strU) {
	//strip all html
	var strN = strU.replace(/(<([^>]+)>)/ig,"");
	//replace carriage returns and line feeds
	strN = strN.replace(/\r\n/g," ");
	strN = strN.replace(/\n/g," ");
	strN = strN.replace(/\r/g," ");
	strN = trim(strN);
	return strN;
}

function trim(inputString) {
	if (typeof inputString != "string") return inputString;
	var retValue = inputString;
	var ch = retValue.substring(0, 1);
	while(ch == " "){
	  retValue = retValue.substring(1, retValue.length);
	  ch = retValue.substring(0, 1);
	}
	ch = retValue.substring(retValue.length - 1, retValue.length);
	while(ch == " "){
	  retValue = retValue.substring(0, retValue.length - 1);
	  ch = retValue.substring(retValue.length - 1, retValue.length);
	}
	// Note that there are two spaces in the string - look for multiple spaces within the string
	while (retValue.indexOf("  ") != -1) {
	  // Again, there are two spaces in each of the strings
	  retValue = retValue.substring(0, retValue.indexOf("  ")) + retValue.substring(retValue.indexOf("  ") + 1, retValue.length);
	}
	return retValue; // Return the trimmed string back to the user
}

function showGuidelines(rte) {
	return; // TEMPORARY by Erel
	if(rte.length == 0) rte = currentRTE;
	var oRTE = returnRTE(rte);
	var tables = oRTE.document.getElementsByTagName("table");
	for(var i=0; i<tables.length; i++){
	  if(tables[i].getAttribute("border") == "0"){
	    var trs = tables[i].getElementsByTagName("tr");
	    for(var j=0; j<trs.length; j++){
	      var tds = trs[j].getElementsByTagName("td");
	      for(var k=0; k<tds.length; k++){
					if(j == 0 && k == 0){
			   	  tds[k].style.border = "dashed 1px "+zeroBorder;
					}else if(j == 0 && k != 0){
	  		    tds[k].style.borderBottom = "dashed 1px "+zeroBorder;
						tds[k].style.borderTop = "dashed 1px "+zeroBorder;
						tds[k].style.borderRight = "dashed 1px "+zeroBorder;
	        }else if(j != 0 && k == 0) {
			      tds[k].style.borderBottom = "dashed 1px "+zeroBorder;
					  tds[k].style.borderLeft = "dashed 1px "+zeroBorder;
						tds[k].style.borderRight = "dashed 1px "+zeroBorder;
	        }else if(j != 0 && k != 0) {
	          tds[k].style.borderBottom = "dashed 1px "+zeroBorder;
					  tds[k].style.borderRight = "dashed 1px "+zeroBorder;
		      }
	      }
	    }
	  }
	}
}

function stripGuidelines(rte) {
	return; // TEMPORARY by Erel
	var oRTE = returnRTE(rte);
	var tbls = oRTE.document.getElementsByTagName("table");
	for(var j=0; j<tbls.length; j++) {
	  if(tbls[j].getAttribute("border") == "0") {
	    var tds = tbls[j].getElementsByTagName("td");
	    for(var k=0; k<tds.length; k++) {
	      tds[k].removeAttribute("style");
	    }
	  }
	}
}

function findSize(obj) {
	if(obj.length > 0 && document.all) {
	  obj = frames[obj];
	} else if(obj.length > 0 && !document.all) {
	  obj = document.getElementById(obj).contentWindow;
	} else {
	  obj = this;
	}
	
	if ( typeof( obj.window.innerWidth ) == 'number' ) {
	  //Non-IE
	  obj_width = obj.window.innerWidth;
	  obj_height = obj.window.innerHeight;
	} else if( obj.document.documentElement && ( obj.document.documentElement.clientWidth || obj.document.documentElement.clientHeight ) ) {
	  //IE 6+ in 'standards compliant mode'
	  obj_width = document.documentElement.clientWidth;
	  obj_height = document.documentElement.clientHeight;
	} else if( obj.document.body && ( obj.document.body.clientWidth || obj.document.body.clientHeight ) ) {
	  //IE 4 compatible
	  obj_width = obj.document.body.clientWidth;
	  obj_height = obj.document.body.clientHeight;
	}

}

function resizeRTE() {
	document.body.style.overflow = "hidden";
	var rte = currentRTE;
	var oRTE = document.getElementById(rte);
	var oBut1 = document.getElementById('Buttons1_'+rte);
	var oBut2;
	var oVS = document.getElementById('vs'+rte);
	findSize("");
	width = obj_width;
	if (width < minWidth){
		document.body.style.overflow = "auto";
		width = minWidth;
	}
	var height = obj_height - 83;
	if (document.getElementById("txtSrc"+rte).innerHTML == lblModeRichText) {
		height = obj_height-28;
		if (!document.getElementById('Buttons2_'+rte) && width < wrapWidth) {
			document.body.style.overflow = "auto";
			width = wrapWidth;
		}
		if (document.getElementById('Buttons2_'+rte)) document.getElementById('Buttons2_'+rte).style.width = width;
	} else {
		if (document.getElementById('Buttons2_'+rte)) {
			document.getElementById('Buttons2_'+rte).style.width = width;
		} else {
				height = obj_height - 55;
				if(width < wrapWidth){
					document.body.style.overflow = "auto";
					width = wrapWidth;
				}
		}
	}
	if (document.body.style.overflow == "auto" && isIE) height = height-18;
	if (document.body.style.overflow == "auto" && !isIE) height = height-24;
	oBut1.style.width = width;
	oVS.style.width = width;
	oRTE.style.width = width-2;
	oRTE.style.height = height;
	if(!document.all)oRTE.contentDocument.designMode = "on";
}

function replaceIt(string,text,by) {
	// CM 19/10/04 custom replace function
	var strLength = string.length, txtLength = text.length;
	if ((strLength == 0) || (txtLength == 0)) return string;
	var i = string.indexOf(text);
	if ((!i) && (text != string.substring(0,txtLength))) return string;
	if (i == -1) return string;
	var newstr = string.substring(0,i) + by;
	if (i+txtLength < strLength)
	  newstr += replaceIt(string.substring(i+txtLength,strLength),text,by);
	return newstr;
}

function countWords(rte){
	parseRTE(rte);
	var words = document.getElementById("hdn"+rte).value;
	var totalWordCount = getWordCount(words);
	var selectionWordCount = getWordCount(getSelectionedText(rte));
	
	var chars = trim(words);
	chars = chars.length;
	chars = maxchar - chars;

	var alarm = "";
	if(chars<0) alarm = "\n\n"+lblCountCharWarn;
	
	alert(
		lblCountSelection+": "+selectionWordCount+"\n\n"+
		lblCountTotal+": "+totalWordCount+ "\n\n"+
		lblCountChar+": "+chars+alarm);
}


function getWordCount(words) {
	var str = stripHTML(words);
	str = str+" a ";  // word added to avoid error
	str = str.
		replace(/&nbsp;/gi,' ').
		replace(/([\n\r\t])/g,' ').
		replace(/(  +)/g,' ').
		replace(/&[a-z]*;/gi,' ').      //bug fix by Erel
		replace(/^\s*|\s*$/g,'');
	var count = 0;
	for (x=0;x<str.length;x++) {
	  if (str.charAt(x)==" " && str.charAt(x-1)!=" ") count++;  
	}
	if (str.charAt(str.length-1) != " ") count++;
	count = count - 1; // extra word removed
	return count;
}




function getSelectionedText(rte) {
	var oRTE = returnRTE(rte);
	var txt = '';
	if (oRTE.window && oRTE.window.getSelection) {
		txt = oRTE.window.getSelection();
	}
	else if (oRTE.document.getSelection) {
		txt = oRTE.document.getSelection();
	}
	else if (oRTE.document.selection) {
		txt = oRTE.document.selection.createRange().text;
	}
	return txt.toString();
}


function autoBRon(rte) {
	// CM 19/10/04 used for non RTE browsers to deal with auto <BR> (and clean up other muck)
	var oRTE = document.forms[0].elements[rte];
	oRTE.value=parseBreaks(oRTE.value);
	oRTE.value=replaceIt(oRTE.value,'&apos;','\'');
}

function autoBRoff(rte) {
	// CM 19/10/04 used for non RTE browsers to deal with auto <BR> (auto carried out when the form is submitted)
	var oRTE = document.forms[0].elements[rte];
	oRTE.value=replaceIt(oRTE.value,'\n','<br />');
	oRTE.value=replaceIt(oRTE.value,'\'','&apos;');
}

function parseBreaks(argIn) {
	// CM 19/10/04 used for non RTE browsers to deal with auto <BR> (and clean up other muck)
	argIn=replaceIt(argIn,'<br>','\n');
	argIn=replaceIt(argIn,'<BR>','\n');
	argIn=replaceIt(argIn,'<br/>','\n');
	argIn=replaceIt(argIn,'<br />','\n');
	argIn=replaceIt(argIn,'\t',' ');
	argIn=replaceIt(argIn,'    ',' ');
	argIn=replaceIt(argIn,'   ',' ');
	argIn=replaceIt(argIn,'  ',' ');
	argIn=replaceIt(argIn,'  ',' ');
	argIn=replaceIt(argIn,'\n ','\n');
	argIn=replaceIt(argIn,' <p>','<p>');
	argIn=replaceIt(argIn,'</p><p>','\n\n');
	argIn=replaceIt(argIn,'&apos;','\'');
	return argIn;
}

function geckoKeyPress(evt) {
	//function to add bold, italic, and underline shortcut commands to gecko RTEs
	//contributed by Anti Veeranna (thanks Anti!)
	var rte = evt.target.id;
	if (evt.ctrlKey) {
		var key = String.fromCharCode(evt.charCode).toLowerCase();
		var cmd = '';
		switch (key) {
			case 'b': case 'נ': rteCommand(rte,"bold",null); break;
			case 'i': case 'ן': rteCommand(rte,"italic",null); break;
			case 'u': case 'ו': rteCommand(rte,"underline",null); break;
			//case 'b': setTagAndClass(rte,"strong"); break;     // breaks containing spans!
			//case 'i': setTagAndClass(rte,"em"); break;         // breaks containing spans!  
			//case 'u': setTagAndClass(rte,"span.u"); break;     // breaks containing spans!
	
			case 'q': case '/': setTagAndClass(rte,"q","psuq"); break;
			case 'p': case 'פ': setTagAndClass(rte,"q","mfrj"); break;
			case 'w': case "'": setTagAndClass(rte,"q"); break;

			case 'd': case 'ג': setTagAndClass(rte,"dfn"); break;
			case '0': rteCommand(rte, 'removeformat'); break;
			case '1': setTagAndClass(rte,"h1"); break;
			case '2': setTagAndClass(rte,"h2"); break;
			case '3': setTagAndClass(rte,"h3"); break;
			case '4': setTagAndClass(rte,"h4"); break;
			case '5': setTagAndClass(rte,"h5"); break;
			case '6': setTagAndClass(rte,"h6"); break;
			case 'k': case 'ל': dlgLaunch(rte,"link"); break;
			default: return;
		}
		// if there was a command, stop the event bubble
		evt.preventDefault();
		evt.stopPropagation();
 	}
}

function checkspell() {
	dlgCleanUp();
	//function to perform spell check
	try {
		var tmpis = new ActiveXObject("ieSpell.ieSpellExtension");
		tmpis.CheckAllLinkedDocuments(document);
	}
	catch(exception) {
		if(exception.number==-2146827859) {
			if (confirm("ieSpell not detected.  Click Ok to go to download page."))
				window.open("http://www.iespell.com/download.php","DownLoad");
		} else {
			alert("Error Loading ieSpell: Exception " + exception.number);
		}
	}
}




replacements = new Array (
	//convert all types of single quotes
	new RegExp(String.fromCharCode(145),'g'), "'",
	new RegExp(String.fromCharCode(146),'g'), "'",
	new RegExp("'",'g'), "&#39;",

	//convert all types of double quotes
	new RegExp(String.fromCharCode(147),'g'), "\"",
	new RegExp(String.fromCharCode(148),'g'), "\"",
	//new RegExp("\"",'g'), "&#34;",

	//replace carriage returns & line feeds
	new RegExp("[\r\n]",'g'), " "
);


function rteSafe(html) {
	for (i=0; i<replacements.length; i+=2) {
		html = html.replace(replacements[i], replacements[i+1]);
	}
	return html;
}


/* _script/elements */




function isAlien(a) {
   return isObject(a) && typeof a.constructor != 'function';
}

function isArray(a) {
    return isObject(a) && a.constructor == Array;
}

function isBoolean(a) {
    return typeof a == 'boolean';
}

function isEmpty(o) {
    var i, v;
    if (isObject(o)) {
        for (i in o) {
            v = o[i];
            if (isUndefined(v) && isFunction(v)) {
                return false;
            }
        }
    }
    return true;
}

function isFunction(a) {
    return typeof a == 'function';
}

function isNull(a) {
    return typeof a == 'object' && !a;
}

function isNumber(a) {
    return typeof a == 'number' && isFinite(a);
}

function isObject(a) {
    return (a && typeof a == 'object') || isFunction(a);
}

function isString(a) {
    return typeof a == 'string';
}

function isUndefined(a) {
    return typeof a == 'undefined';
} 



function getFirstElementNamed(theName) {
	theArray = document.getElementsByName(theName);
	if (theArray.length>0)
		return theArray[0].content;
	else
		return null;
}

function getElement(obj) {
	if (isString(obj))
		return document.getElementById(obj);
	else
		return obj;
}


function mark(obj) {	getElement(obj).style.color='green'}
function unmark(obj) {	getElement(obj).style.color=''}



function setdisplay(obj, value) {
	var e = getElement(obj);
	if (!e)
		throw('cant setdisplay of '+obj+' to '+value);
	if (!e.style)  // no style - can't change it
		return;

	if (value=='switch')
		value = (e.style.display=='none'? '': 'none');
	e.style.display = value;
}
function show(obj) {setdisplay(obj,'');}
function hide(obj) {setdisplay(obj,'none');}
function showorhide(obj, value) {
	if (arguments.length==1)
		setdisplay(obj,'switch');
	else if (value)
		setdisplay(obj,'');
	else
		setdisplay(obj,'nonw');
}


function setdisplayGroup(elements, display) {
	for (var i=0; i<elements.length; ++i)
		setdisplay(elements[i], display);
}
function showGroup(n) {setdisplayGroup(n,'')};
function hideGroup(n) {setdisplayGroup(n,'none')};
function showorhideGroup(n) {setdisplayGroup(n,'switch')};


function setdisplayByClass(c, display) {
	var alltags = document.all? document.all: document.getElementsByTagName('*');
	for (i in alltags) {
		obj = alltags[i];
		if (obj.className == c) {
			//alert("setting display of obj");
			setdisplay(obj, display);
		}
	}
}
function showByClass(c) {setdisplayByClass(c,'')};
function hideByClass(c) {setdisplayByClass(c,'none')};
function showorhideByClass(c) {setdisplayByClass(c,'switch')};


function setdisplaySiblings(element, display) {
	var siblings = element.parentNode.childNodes;
	for (var i=0; i<siblings.length; ++i) {
		var child = siblings[i];
		if (child!=element)
			setdisplay(child, display);
	}
}
function showSiblings(n) {setdisplaySiblings(n,'')};
function hideSiblings(n) {setdisplaySiblings(n,'none')};
function showorhideSiblings(n) {setdisplaySiblings(n,'switch')};


function setdisplayByName(n, display) { setdisplayGroup(document.getElementsByName(n)); }
function showByName(n) {setdisplayByName(n,'')};
function hideByName(n) {setdisplayByName(n,'none')};
function showorhideByName(n) {setdisplayByName(n,'switch')};



/* show_only_siblings(obj, delay_milliseconds) - Show only the siblings of the given object, after a delay of "delay" milliseconds */
var object_to_show;
var timeout_id = 0;
function show_only_siblings(obj, delay_milliseconds) {
	object_to_show = obj;
	if (!delay_milliseconds) delay_milliseconds=500;
	if (timeout_id) clearTimeout(timeout_id);
	timeout_id = setTimeout(
		"hideByClass('dor2');showSiblings(object_to_show);",
		delay_milliseconds);
}


var theCurrentLanguage = '';

function showSingleLanguage(l) {
	regexp = new RegExp(l);
	var alltags = document.all? document.all: document.getElementsByTagName('*');
	for (i in alltags) {
		obj = alltags[i];
		if (!obj || isFunction(obj) || !obj.lang) continue;
		if (regexp.test(obj.lang)) {
			obj.style.display='';
		}
		else if (obj.lang.length>0 && obj.tagName!='HTML' && obj.tagName!='BODY' && obj.tagName!='META' && obj.style) 
			obj.style.display='none';
	}
	theCurrentLanguage = l;
}



function activate(obj) {
	if (obj.hiddenText)
		obj.innerHTML=obj.hiddenText;
}
function deactivate(obj) {
	if (obj.innerHTML.length > 0) {
		alert(obj.innerHTML)
		obj.hiddenText = obj.innerHTML;
		obj.innerHTML="";
	}
}


var ContentEditableSupportedCache;
var undefined;
function ContentEditableSupported() {
  if (ContentEditableSupportedCache == undefined) {
    ContentEditableSupportedCache = false;
    document.write("<span id='test' style='line-height:0'>&nbsp;</span>");
    testElement = document.getElementById("test");
    if (testElement != null) {
      if (testElement["contentEditable"] != null) {
        ContentEditableSupportedCache = true;
      }
    }
  }
  return ContentEditableSupportedCache;
}

function makeEditable(theElement, isEditable) {
	if (theElement) {
		theElement.contentEditable=isEditable;
		theElement.className = isEditable? 'edited': '';
	}
}

function AllPropertiesOf(object) {
	result = "<div dir=ltr>";
	for (i in object) {
		if (!/function/.test(object[i]))
			result += ("<br>" + i + ": " + object[i] + "\n");
	} 
	result += "</div>";
	return result;
}

function AllFunctionsOf(object) {
	result = "<div dir=ltr>";
	for (i in object) {
		if (/function/.test(object[i]))
			result += ("<br>" + i + ": " + object[i] + "\n");
	} 
	result += "</div>";
	return result;
}

function bilingual(lang, lang2, tag, he_text, en_text) {
	if (lang2)
		return "<" + tag + " dir='ltr' lang='en'>" + en_text + "</" + tag + ">\n<" + tag + " dir='rtl' lang='he'>" + he_text + "</" + tag + ">\n";
	else {
		theText = (lang=='en'? en_text: he_text);
		if (tag=="div" || tag=="span")          // don't add the tag - it's redundant
			return theText;
		else 
			return "<" + tag + ">" + theText + "</" + tag + ">";
	}
}





function markOnly(theButton) {
	try {
		for (i=1; i<10; ++i)
			unmark('button' + i);
	} catch(e) {}
	mark(theButton);
}

function buttonHTML(id, action, title, description) {
	if (!action || !title) 
		return "<td id='" + id + "'>";
	else {
		action = "markOnly('" + id + "');" + action;
		return "<td id='" + id + "'><button title='" + description.replace(/["]/g,"").replace(/[']/g,"") + "' onclick=\"" + action + "\">" + title + "</button>&nbsp;";
	}
}

function buttonGroup() {
	theText = '<p class="buttons" id="buttons">' + 
		'<table class="buttons"><tr>';
	for (i=0; i<arguments.length; i += 3)
		theText += buttonHTML('button' + (i/3 + 1), arguments[i], arguments[i+1], arguments[i+2]);
	theText += 
		'</table>'+
		'</p>';
	return theText;
}


function addEvent(elm, evType, fn, useCapture)
{
  if (elm.addEventListener){
    elm.addEventListener(evType, fn, useCapture);
    return true;
  } else if (elm.attachEvent){
    var r = elm.attachEvent("on"+evType, fn);
    return r;
  } else {
    alert("Handler could not be removed");
  }
}

/* _script/form_validation */

/**
 * 1. create the validator over a row in your form. this row should have a label, and a method to indicate of errors.
 * 	var my_row = $('div.form_row');
 * 2. Add a validator function, and a parameter which it will receive
 * 	my_row.validation.add(function(field){return !(!(field.value); }, my_row.find('input').get(0));
 * 3. You can get the validation object using my_row.validation.get();
 * 4. To run the validator use my_row.run(); it will return true if valid, false if not valid, and will notify the row of errors.
 */
jQuery.fn.extend({
	// is_v is the validation function, param is its parameter
	validation_unshift : function (is_v, param) {
		var v_arr = this.data("validation");
		if (!v_arr)
			v_arr = new Array();
		v_arr.unshift({'is_v':is_v,'param':param});
		this.data("validation",v_arr);
		return this;
	},
	validation_push : function (is_v, param) {
		var v_arr = this.data("validation");
		if (!v_arr)
			v_arr = new Array();
		v_arr.push({'is_v':is_v,'param':param});
		this.data("validation",v_arr);
		return this;
	},
	validation_clear_errors : function () {
		this.find('label,legend,fieldset').removeClass('wrong').attr('title','').end().find('span.wrong').remove();		
	},
	validation_run : function() {
		var v_arr = this.data("validation");
		this.validation_clear_errors();
		if (!v_arr)
			return true; // No validators
		var l = v_arr.length;
		for (var i = 0; i < l; i++) {
			var v_obj = v_arr[i];
			switch (v_obj.is_v(v_obj.param)) {
				case false: return false; break;
				case 'valid': return true; break;
				// case true: continue 2; break;
			}
		}
		return true;
	}
});

function validator_handler(e) {
	var res = $(this).closest(".row").validation_run();
	if (e && e.type && e.type == 'keypress') 
		res = true; // Don't return false on key press - it will disable keyboard
	else
		if (res) $(this).trigger('field_validated'); // Trigger update in background
	if (!res && e) e.stopImmediatePropagation(); // Enough validators
	return res;
}
function on_submit_form(){
	window.form_cancled = false;
	$('.wrong').removeClass('wrong');
	var form_rows = $(this).find("div.row");
	window.GrowlValidatorSetError = true
	for (var i = 0; i < form_rows.length; i++) {
		if (!$(form_rows[i]).validation_run()) {
			window.form_cancled = true;
			window.GrowlValidatorSetError = false;
			return false;
		}
	}
	window.GrowlValidatorSetError = false;
	return true;
}
function RadioSetError(field, errorMessage) {
    var legend = field.closest('.radio_fieldset').find('p.legend').andSelf().find('legend,fieldset').andSelf(); 
    legend.addClass('wrong');
    legend.attr('title',errorMessage);
    if (window.GrowlValidatorSetError)
		$.jGrowl(errorMessage, {sticky:true});
}
function ValidatorSetError(field, errorMessage, silent) {
	var label = field.closest('div.row').find('label'); 
	silent = (silent == null) ? false : silent;
	label.addClass('wrong');
	label.attr('title',errorMessage);
	label.parents('.category_close').find('h3').trigger('click');
	if (!silent && window.GrowlValidatorSetError) 
		$.jGrowl(errorMessage, {sticky:true});
}
function ValidatorUnsetError(field) {
	field.parents('div.row').find('label,legend,fieldset').removeClass('wrong').attr('title','').end().find('span.wrong').remove();
}
function ValidatePassword(field, errorMessage) {
    if (!field) {
		$.jGrowl(static_text["missing fields"] + errorMessage, {sticky:true});
	    return false;
	}
	var a = field.val();
	if (a.length <= 3 && a.length > 0) {
        ValidatorSetError(field, errorMessage + static_text["password length"]);
        return false;
    }
    return true;
}

function ValidateBirthday (year_field, month_field, day_field, errorMessage, tooYoungMessage, current) {
    var today=new Date();
    if (!year_field || !month_field || !day_field) {
		$.jGrowl(static_text["missing fields"] + errorMessage, {sticky:true});
	    return false;
	}
	var year_val = parseInt(year_field.val());
	var month_val = parseInt(month_field.val());
	var day_val = parseInt(day_field.val());
	if (($(current).attr("name") && !$(current).val())) {
        ValidatorSetError(year_field, errorMessage);
		return false;
	} else if (!year_val || !month_val || !day_val) {
		// If there is a "current" birth_day field - it's probably valid otherwise we would already return by the statement above.
		// If it is valid - then we need a silent error
		ValidatorSetError(year_field, errorMessage);
			return false;
	}
    if((year_val  > today.getFullYear()-18) || 
       (year_val == today.getFullYear()-18 && month_val  > today.getMonth()+1) || 
       (year_val == today.getFullYear()-18 && month_val == today.getMonth()+1 && day_val > today.getDate()))
       {
        ValidatorSetError(year_field, tooYoungMessage);
        return false;
    }
    return true;
}

function ValidateFieldPresent(field, errorMessage) {
	if (!field) {
		return false;
		//$.jGrowl(static_text["missing fields"] + errorMessage, {sticky:true});
		//return false;
	}
	return true;
}

function ValidateInputNotEmpty(field, errorMessage) {
	// If the fields isnt' present, it best that it won't trigger an error otherwise the user couldn't fill in the form.
	if (!ValidateFieldPresent(field, errorMessage))
		return true; 
	if (!field.val()) {
		ValidatorSetError(field, errorMessage);
		return false;
	}
	return true;
}

function ValidateSelect(field, errorMessage) {
    if (!ValidateFieldPresent(field, errorMessage))
        return true;
	if (!field.get(0).selectedIndex) {
	    ValidatorSetError (field, errorMessage);
		return false;
	}
	return true;
}

function ValidateEmail(field) {
	var email = field.val();
	var email_error_message;
	email_error_message = get_email_string_validation_error_message(email);
	if (email && email_error_message) {
		ValidatorSetError (field, email_error_message);
		return false;
	}
	return true;
}

function ValidateEqual(field1, field2, errorMessage) {
    if (!ValidateFieldPresent(field1, errorMessage))
        return false; 
    if (!ValidateFieldPresent(field2, errorMessage))
        return false; 
	if (field1.val() != field2.val()) {
	    ValidatorSetError (field2, errorMessage);
		return false;
	}
	return true;
}

function ValidateChecked(field, errorMessage) {
	if (field.attr("disabled"))
		return true;
		
    if (!ValidateFieldPresent(field, errorMessage))
        return false; 
	if (!field.filter(':checked').length) {
	    ValidatorSetError (field, errorMessage);
		return false;
	}
	return true;
}

function ValidateRadioChecked(field, errorMessage) {
	if (!field.filter(':checked').length) {
	    RadioSetError (field, errorMessage);
		return false;
	}
	return true;
}

function ValidateAllOrNone(fields, errorMessage) {
/*
	for (var i=0; i<fields.length; ++i) {

	}
	return true;
*/
}

function ValidateNotEmpty(field, fieldName, youForgotLabel) {
	if (!youForgotLabel)
		youForgotLabel = sprintf(static_text["you forgot"],fieldName);
	return ValidateInputNotEmpty(field, youForgotLabel + fieldName + ".");
}

function ValidateAllNotEmpty(theForm, youForgotLabel) {
	var all_ok = true;
	for (var i=1; i<arguments.length; ++i) {
		fieldInternalName = arguments[i];
		fieldName = fieldInternalName.replace(/_/g," ");
	    all_ok = all_ok && ValidateNotEmpty(theForm[fieldInternalName], fieldName, youForgotLabel);
	}
    return all_ok;
}


/**
 * @see admin/make_js.php (relevant_properties)
 * @see email_validation_system.php get_email_string_validation_error_message()
 */
function get_email_string_validation_error_message(email_address) {
	var forbidden_chars = {
		"comma": ",", 
		"semicolon": ";",  
		"space": " ", 
		"quote": "\"", 
		"apostrophe": "\'",
		"greater_than": ">",
		"less_than": "<"
		};
	var forbidden_leading_chars = {
		"dot": ".",
		"at_sign": "@"
		};
	var forbidden_trailing_chars = forbidden_leading_chars;

	if (!email_address)
		return static_text["missing fields"];

	message = sprintf(static_text["email invalid"],email_address);
	if (email_address.indexOf('@') == -1) {
		return message + static_text["email invalid no at"];
	}

	for (var bad_char in forbidden_chars) {
		if (email_address.indexOf(forbidden_chars[bad_char]) > -1) {
			return message + sprintf(static_text["email invalid forbidden char"],static_text[bad_char],forbidden_chars[bad_char]);
		}
	}

	for (var bad_char in forbidden_leading_chars) {
		if (email_address.charAt(0) == forbidden_leading_chars[bad_char]) {
			return message + sprintf(static_text["email invalid forbidden leading char"],static_text[bad_char],forbidden_leading_chars[bad_char]);
		}
	}

	for (var bad_char in forbidden_trailing_chars) {
		if (email_address.charAt(email_address.length-1) == forbidden_trailing_chars[bad_char]) {
			return message + sprintf(static_text["email invalid forbidden trailing char"],static_text[bad_char],forbidden_trailing_chars[bad_char]);
		}
	}

	return "";
}

/* _script/fields */



var lang = document.body && document.body.lang? document.body.lang: 'he';


var title_without_quotes = document.title.replace(/["]/g,"").replace(/[']/g,"");

var submitLabel = (lang=='en'? "submit": "שליחה");
var saveLabel =   (lang=='en'? "[s]ave changes": "שמירת השינויים");
var undoLabel =   (lang=='en'? "return to the non-formal version": "הפוך את הגירסה הלא-רשמית לרשמית");
var formatLabel =   (lang=='en'? "match destination formatting": "התאם עיצוב יעד");
var versionsLabel =   (lang=='en'? "show former versions": "הצג גירסאות קודמות");

var nameLabel = (lang=='en'? 'user name': 'שם משתמש');
var passwordLabel = (lang=='en'? 'password': 'סיסמה');
var subjectLabel = (lang=='en'? 'subject': 'נושא');
var youForgotLabel = (lang=='en'? 'You forgot to fill in the ': 'שכחת למלא '); // for ValidateNotEmpty
var authorLabel = (lang=='en'? 'Author - if different than username': 'מחבר המאמר - אם זה לא את/ה');


function setCookies (name, email, rememberme, password) {
   if (name) setCookie('name',name.value,365,"/",null,null);   // remember the name and email for a year
   if (email) {setCookie('email',email.value, 365,"/",null,null);} // remember the name and email for a year
   if (rememberme && rememberme.checked && password) {
      setCookie('password',password.value,null,"/",null,null); // remember the password only for this session
   }
   else {
      deleteCookie('password',"/");
   }
}



titleInputHidden = '<input type="hidden" name="title" value="'+title_without_quotes+'">' + 
             '<input type="hidden" name="titlechanged" value="">';
languageInputHidden = '<input type="hidden" name="lang" value="' + lang + '">';



titleInputVisible = '<input type="text" disabled="disabled" name="title" size="50" value="" />';

authorInputVisible = '<p>' + authorLabel + ': <input type="text" name="author" size="50" value="" />' + '</p>';

languageInputVisible = '<select size=1 name="lang">' + 
	(lang=='en'? 
		'<option value="en" selected="selected">English' + '<option value="he">עברית' : 
		'<option value="he" selected="selected">עברית' + '<option value="en">English'  ) + 
	'</select>&nbsp;';

	
function bodyclass_title(the_bodyclass_text, the_bodyclass) {
	if (the_bodyclass_text == 'הודעה חשובה')
		alert('אזהרה: אין אפשרות להפוך הודעה חשובה להודעה רגילה, ולכן אם הנהלת האתר תחליט שההודעה לא מספיק חשובה, היא תימחק לגמרי!');
	
	if (the_bodyclass == 'new')
		return '';
	else
		return the_bodyclass_text + 
		(lang=='en'? ": ": " על: ") +
		title_without_quotes;
}

bodyclassInput = '<select size="1" name="bodyclass" onchange="theAddForm.lang.selectedIndex=0; if (selectedIndex>0) {this.form.title.value=bodyclass_title(options[selectedIndex].text, options[selectedIndex].value); this.form.title.disabled=false;}">' + 
  '<option value="" selected="selected">' + (lang=='en'? '* add what? *': '* מה להוסיף? *') + 
'</select>';

bodyclassInput_short = '<input type="hidden" name="bodyclass" value="short">';


function validate(theForm) {
	if (
		/*ValidateNotEmpty(theForm.username, nameLabel, youForgotLabel) &&*/
		ValidateNotEmpty(theForm.title, subjectLabel, youForgotLabel) &&
		/*(!passwordIsRequired || ValidateNotEmpty(theForm.password, passwordLabel, youForgotLabel))*/
		1
		) {
			setCookies (theForm.username, theForm.email, theForm.rememberme, theForm.password); 
			return true;
	}
	else 
		return false;
}

function formHeader(formId, target, action) {
	if (!action)
		action = path_from_document_to_root + '_script/rewrite.php?to=add';
	theHeader = "<form method='post' id='" + formId + "'" +
		" enctype='multipart/form-data'" +
		(target? " target='" + target + "'": "") +
		" action='" + action + "'" +
		" onsubmit='return validate(this)'>" + 
		"\n";
	return theHeader;
}


function idFields(path_from_root_to_document,usernameHint,passwordHint,emailHint) {
	theText =  
	'<table>\n'+
	'<tr>' + 
		'<td><label>' + (lang=='en'? 'user n<u>a</u>me:': '<u>ש</u>ם משתמש:') + '</label>' + 
		'<td><input type="text" name="username" accesskey="a" value="' +  getCookie('name') +  '" size="50">' + 
		'<br /><small>' + usernameHint + '</small>' +
	'<tr>' + 
		'<td><label>' + (lang=='en'? "<u>p</u>assword:": "סיסמה:") + '</label>' + 
	 	'<td><input accesskey="p" type="password" name="password" value="' + getCookie('password') + '">' + 
		'<br /><small>' + passwordHint + '</small>' +
	(emailHint==undefined? "": 
	'<tr>' +
		'<td><label>' + (lang=='en'? "<u>e</u>mail / published at:": "דואל / פורסם ב:") + '</label>' + 
		'<td><input accesskey="e" type="text" name="email" value="' + getCookie('email') + '" size="50">' + 
		'<br /><small>' + emailHint + '</small>') +
	'<tr>' + 
		'<td style="text-align:left"><input accesskey="k" name="rememberme" type="checkbox"' + (getCookie('name')? ' checked="checked"': '') + '>' + 
		'<td><label>' + (lang=='en'? "<u>k</u>eep my details on this computer": "שמור את הפרטים ש<u>ל</u>י על המחשב הזה (עד שאסגור את החלון)") + '</label>' + 
		'' + 
	'<input type="hidden" name="followup" value='+path_from_root_to_document+'>'+
	'<input type="hidden" name="file" value='+path_from_root_to_document+'>'+
	"</table>\n";
	return theText;
	// both "followup" and "file" are sent - to handle Holam bug in MSIE
}


function idFields_short(path_from_root_to_document) {
	theText =  
	'<input type="hidden" name="username" value="-">'+
	'<input type="hidden" name="password" value="-">'+
	'<input type="hidden" name="followup" value='+path_from_root_to_document+'>'+
	/*'Additional info (optional): <input type="text" name="email" value="">' + */
	'<input type="hidden" name="file" value='+path_from_root_to_document+'>';
	return theText;
}


/* _script/arguments */




var path_from_root_to_document, theAuthor, theReceiver, theTvnit;
if (document.getElementsByName) {
	path_from_root_to_document = getFirstElementNamed('jmQovc');
	theAuthor = getFirstElementNamed('author');
	theReceiver = getFirstElementNamed('receiver');
	theTvnit = getFirstElementNamed('tvnit');
	theLang2 = getFirstElementNamed('lang2');
}
else if (document.all) {
	path_from_root_to_document = document.all.jmQovc.content;
	theAuthor = document.all.author.content;
	theReceiver = document.all.receiver.content;
	theTvnit = document.all.tvnit.content;
	theLang2 = document.all.lang2.content;
}
else {
	path_from_root_to_document = window.location.href.replace(/^.*:\/\/\/?[^\/]*\/(.*)[.][^.]*$/, "$1");
	theAuthor = "";
	theReceiver = "";
	theTvnit = "";
	theLang2 = "";
}








/* _script/sites */


var server = "http://tora.us.fm/";

var relative_depth=0;
for (i=0; i<path_from_root_to_document.length; ++i) {
	if (path_from_root_to_document.charAt(i)=='/') relative_depth++;
}

var path_from_document_to_site = '';
for (i=1; i<relative_depth; ++i) {
	path_from_document_to_site += '../';
}

function fileparse(theFullPath) {
	hasDirectory = /[\/\\]/.test(theFullPath);
	hasExtension = /\.[^\/\\\.]*$/.test(theFullPath);
	if (hasDirectory && hasExtension)
		return /^(.*)[\/\\]([^\/\\]*)(\.[^\/\\\.]*)$/.exec(theFullPath);
	else if (hasDirectory && !hasExtension)
		return /^(.*)[\/\\]([^\/\\]*)()$/.exec(theFullPath);
	else if (!hasDirectory && hasExtension)
		return /^()(.*)(\.[^\/\\\.]*)$/.exec(theFullPath);
	else
		return /^()(.*)()$/.exec(theFullPath);
}

var site, path_from_site_to_document, path_from_document_to_document, siomt;
path_components = /^([^\/\\]*)\/(.*)$/.exec(path_from_root_to_document);
if (path_components) {
	site = path_components[1];
	path_from_site_to_document = path_components[2];
	path_components = fileparse(path_from_root_to_document);
	path_from_document_to_document = path_components[2] + path_components[3];
	siomt = path_components[3]? "": ".html";
} else {
	site = "";
	path_from_site_to_document = path_from_root_to_document;
	path_from_document_to_document = path_from_root_to_document;
	siomt = ".html";
}

var absolute_site_url = server + site;
var absolute_document_url = absolute_site_url + "/" + path_from_site_to_document + siomt;

var path_from_site_to_cgi = "../cgi-bin";
var filepath_from_cgi_to_site = (/localhost|127.0.0.1/.test(document.URL))? "../"+site : "../httpdocs/"+site;
var linkpath_from_cgi_to_site = "../"+site;
var path_from_document_to_cgi = path_from_document_to_site + path_from_site_to_cgi;


var passwordIsRequired = false;
var site_name, usernameHint, passwordHint, emailHint;
if (document.body.lang=='en') {
	site_name='site';
	usernameHint = '';
	passwordHint = '(If you leave blank, your changes will enter a non-formal version)';
	emailHint = '(optional)';
}
else {
	site_name='האתר';
	usernameHint = '';
	passwordHint = '(אם אין לך סיסמה, יש להשאיר ריק. השינויים שלך ייכנסו לגירסה לא רשמית)';
	emailHint = '(לא חובה למלא)';
}

if (site=='tnk1') {
	site_name='אתר הניווט בתנך';
	passwordHint = '(אם אין לך סיסמה, יש לכתוב את 3 האותיות הראשונות בספר צפניה, בלי ניקוד. במצב עריכה, השינויים שלך ייכנסו לגירסה לא רשמית)';
	passwordIsRequired = true;
}
else if ((site=='nxt') || (site=='~nachat')) {
	site_name='אתר נוער חובב תנך';
}
else if (site=='tokxot')
	site_name='האתר למחאות מקוריות';
else if (site=='limudim')
	site_name='אתר הלימודים של יעל פרקל';
else if (site=='fuelcell')
	site_name='פרוייקט מטוס ללא טייס מונע בתאי דלק';
else if (site=='js')
	site_name='Javascript Algorithm Encyclopedia';
else if (site=='tryg')
	site_name='האתר למקוריות במצוות';
else if (site=='erelsgl')
	site_name='האתר של אראל סגל';
else if (site=='levisegal') {
	passwordIsRequired = true;
	site_name='אתר משפחת המבורגר-לוי-סגל';
}
else if (site=='dugma') {
	usernameHint = '(בעריכת האתר לדוגמה, יש להשתמש בשם "הנהלה")';
	passwordHint = '(בעריכת האתר לדוגמה, יש להשתמש בסיסמה "הנהלה")';
	passwordIsRequired = true;
	site_name='אתר לדוגמה';
}
else if (site=='demo') {
	usernameHint = '(for the demo site, use "admin")';
	passwordHint = '(for the demo site, use "admin")';
	passwordIsRequired = true;
	site_name='English Demonstration site';
}


/* _script/dates/dates */


var sunsetMinuteOfDayGMT = new Array(12);
sunsetMinuteOfDayGMT[0] = 15*60 + 1;
sunsetMinuteOfDayGMT[1] = 15*60 + 28;
sunsetMinuteOfDayGMT[2] = 15*60 + 49;
sunsetMinuteOfDayGMT[3] = 16*60 + 9;
sunsetMinuteOfDayGMT[4] = 16*60 + 30;
sunsetMinuteOfDayGMT[5] = 16*60 + 48;
sunsetMinuteOfDayGMT[6] = 16*60 + 49;
sunsetMinuteOfDayGMT[7] = 16*60 + 26;
sunsetMinuteOfDayGMT[8] = 15*60 + 50;
sunsetMinuteOfDayGMT[9] = 15*60 + 11;
sunsetMinuteOfDayGMT[10] = 14*60 + 44;
sunsetMinuteOfDayGMT[11] = 14*60 + 40;


function isShabbat() {
	now = new Date();
	currentWeekday = now.getDay()+1;
	currentMinuteOfDayGMT = now.getHours()*60 + now.getMinutes() + now.getTimezoneOffset();
	meanSunsetMinuteOfDayGMT = sunsetMinuteOfDayGMT[now.getMonth()];
	return (currentWeekday==6 && currentMinuteOfDayGMT>meanSunsetMinuteOfDayGMT) ||
	       (currentWeekday==7 && currentMinuteOfDayGMT<meanSunsetMinuteOfDayGMT);
	return weekday;
}


/* _script/templates */





var theBnim, theBnimArray, theWrittenBnim;  
function AnalyzeBnim() {  // called from  a <script> block afterwards
	//start = new Date();
	theBnim = document.getElementById('ulbnim');
	theBnimArray = theBnim.innerHTML.replace(/<\/li>/ig,"").split(/<li>/i);
	if (theBnimArray[0].length<10)  {
		theBnimArray.shift();
	}
	theWrittenBnim = new Array(theBnimArray.length);
	theBnim.style.display = 'none';
}

var theBnimHash;
function CreateHash() {
	theBnimHash = new Array();
	theRegexp = new RegExp("^((<a[^<>]*>)?)([^<>]*?)([0-9-]+:)((.|\r|\n)*)$");

	for (var i=theBnimArray.length-1; i>=0; --i) {
		bn = theBnimArray[i];
		parts = theRegexp.exec(bn);
		if (parts!=null) {
			psuq = parts[4];
			rest = parts[1] + parts[3] + parts[5];
		}
		else {
			psuq = 0;
			rest = bn;
		}
		
		if (! theBnimHash[psuq] ) {
			theBnimHash[psuq] = new Array();
		}
		theBnimHash[psuq].push(i);
		theBnimArray[i] = rest;
	}
	
}


function replace_type_with_typeimage(bn) {
   if (site=='tnk1')
      return bn.
            replace(/ על: /, ": ").
            replace(/שיר:/, "<img title='שיר' src="+path_from_document_to_site+"_themes/tw.gif>").
            replace(/סרט:/, "<img title='סרט' src="+path_from_document_to_site+"_themes/srt.gif>").
            replace(/סיפור:/, "<img title='סיפור' src="+path_from_document_to_site+"_themes/storybook.gif>").
            replace(/משחק:/, "<img title='סיפור' src="+path_from_document_to_site+"_themes/games.gif>").
            replace(/הבדלים:/, "").
            replace(/מאמר דמיוני:/, "<img title='דימיוני' src="+path_from_document_to_site+"_themes/ein_knisa.gif>מאמר דימיוני:").
            replace(/מאמר:/, "").
            replace(/תרגומים:/, "").
            replace(/אוסף:/, "").
            replace(/כלל:/, "").
            replace(/מאמר לא גמור:/, "<img title='לא גמור' src="+path_from_document_to_site+"_themes/jtil.gif> ").
            replace(/שאלה:/, "<img title='שאלה' src="+path_from_document_to_site+"_themes/jtil.gif> ").
            replace(/מצוות:/, "<img title='מצוה' src="+path_from_document_to_site+"_themes/mcwa.gif> ").
            replace(/מבנה:/, "");
   else
      return bn;
}

function ktov_bnim(header, pattern, footer) {
   var regexp = new RegExp(pattern,"i");
   var regexp1 = new RegExp(">"+pattern, "i");
   var regexp2 = new RegExp("^"+pattern, "i");
   var theText = "";
   var numWritten = 0;
   for (i=0; i<theBnimArray.length; ++i) {
      var bn = theBnimArray[i];
      if (regexp1.test(bn) || regexp2.test(bn)) {
        if (/href/.test(bn) || !/: -/.test(bn)) {
          if (numWritten==0) theText += header;
          if (!/img/i.test(bn)) {
            theText += "<li>";
            bn = bn.replace(/ציור/, "<img title='ציור' src="+path_from_document_to_site+"_themes/cyur.gif>ציור");
          }
          bn = replace_type_with_typeimage(bn).replace(regexp,"");

          theText += bn + "</li>";
          ++numWritten;
          theWrittenBnim[i] = 1;
	}
      }
   }
   if (numWritten>0) theText += footer;
   document.write(theText);
}


function ktov_bnim_axrim(header, footer) {
   if (!header) header=""; 
   if (!footer) footer="";
   theText = "";
   numWritten = 0;
   for (i=0; i<theBnimArray.length; ++i) {
      if (!theWrittenBnim[i]) {
        bn = theBnimArray[i];
        if (/href/.test(bn) || !/: -/.test(bn)) {
          if (numWritten==0) theText += header;
          theText += ("<li>"+replace_type_with_typeimage(bn));
          ++numWritten;
        }
     }
   }
   if (numWritten>0) theText += footer;
   document.write(theText);
}

function ktov_bnim_tnk() {
	ktov_bnim('', 'מבוא:', ' ');
	document.write (
			"<ol class='awsp_mpwrt'>");
				ktov_bnim('', 'מצוות:', ' ');
				ktov_bnim('', 'אוסף:', ' ');
	document.write (
			"</ol>");
					ktov_bnim('<h2>מאמרים</h2> <ol class="awsp_mpwrt"> ', '(תרגומים|אתר|הבדלים|מאמר|מבנה|מצגת|קובץ|כלל|ספר|הגדרה):', ' </ol>');
					ktov_bnim('<h2>מאמרים דמיוניים ואמנותיים</h2> <ol class="awsp_mpwrt"> ', '(מאמר דמיוני|סיפור|שיר|ציור|סרט):', ' </ol>');
					ktov_bnim('<h2>משחקים ופעילויות</h2> <ol class="awsp_mpwrt"> ', 'משחק:', ' </ol>');
					ktov_bnim('<h2>שאלות ומאמרים לא גמורים</h2> <ol class="awsp_mpwrt"> ', '(מאמר לא גמור|מאמר שלא פורסם|שאלה):', ' </ol>');
	document.write ("<br style='clear:all' />");
}



function ktov_bnim_jorj() {
	hide(theBnim);
	ktov_bnim('', 'הגדרה_[^<>]*:', '');
	document.write (
		"<div class='tt_jorjim'>");
			ktov_bnim('<ul> ', '(אשמז|סשמז|שזמש):', ' </ul>');
			ktov_bnim('<ul> ', '([^<>]*שורש[^<>]*):', ' </ul>');
			ktov_bnim('<h3>שורשים נובעים</h3> <ul> ', 'שנ:', ' </ul>');
	document.write (
		"</div>" + 

		"<table class='milim_mjorj'><thead><col><col></thead><tbody>" + 
		"<tr><td>");
			ktov_bnim('<h3>שמות של ה\'</h3> <ul> ', 'שם1:', ' </ul>');
			ktov_bnim('<h3>תארים ושמות מתוארים</h3> <ul> ', 'תואר:', ' </ul>');
			ktov_bnim('<h3>אותיות</h3> <ul> ', 'אות:', ' </ul>');
			ktov_bnim('<h3>פעלים</h3> <ul> ', 'פועל:', ' </ul>');
			ktov_bnim('<h3>מילים כלליות</h3> <ul> ', 'מילה:', ' </ul>');
			ktov_bnim('', 'צי[^<>]*ו[^<>]*:', '');
	document.write (
		"<td>");
			ktov_bnim('<h3>חיות וצמחים</h3> <ul> ', 'חיה:', ' </ul>');
			ktov_bnim('<h3>עצמים מוחשיים</h3> <ul> ', 'עצם:', ' </ul>');
			ktov_bnim('<h3>כלים מלאכותיים</h3> <ul> ', 'כלי:', ' </ul>');
			ktov_bnim('<h3>שמות מופשטים</h3> <ul> ', 'מופשט:', ' </ul>');
	document.write (
		"</table>" + 
		"<table class='mamrim_mjorj'><thead><col><col></thead><tbody>" + 
		"<tr><td>");
			ktov_bnim('<h2>הגדרות</h2> <ul> ', 'הגדרה:', ' </ul>');
			ktov_bnim('<h2>הבדלים</h2> <ul> ', 'הבדל:', ' </ul>');
	document.write (
		"<td>");
			ktov_bnim('<h2>פירושי פסוקים</h2> <ul> ', '(תוכן1|דיון1):', ' </ul>');
			ktov_bnim('<h2>מאמרים</h2> <ul> ', '(מאמר|כלל|מאמר לא גמור|מאמר שלא פורסם|מאמר דמיוני):', ' </ul>');
	document.write (
		"</table>");
			ktov_bnim('<h3 id=bituy>ביטויים</h3> <ul> ', '[^<>]*ביטוי[^<>]*:', ' </ul>');
	document.write ("<br style='clear:all' />");
}


function ktov_bnim_mcwa() {
	ktov_bnim("<div class='pswqym'> <h2>פסוקים</h2> <ul> ", "פסוק:", " </ul> </div>");
	ktov_bnim("<div class='femym'> <h2>טעמים</h2> <ul> ", "טעם:", " </ul> </div>");
	ktov_bnim("<div class='hgdrwt'> <h2>הגדרות והלכות</h2> <ul> ", "(הגדרה|הלכות):", " </ul> </div>");
	ktov_bnim("<div class='drkym'> <ul> ", "דרך:", " </ul> </div>");
	ktov_bnim("<div class='sywwgym'> <h2>סיווג המצוה (גורמים שהמצוה תלויה בהם)</h2> <ul> ", "סיווג:", " </ul> </div>");
}

function ktov_bnim_mcwot(tdirut) {
	ktov_bnim("", "מבוא:", "");
	
	document.write(
		"<table width='100%'>" + 
		"<tbody>" + 
		"<tr>" + 
		
		"<td class='drkym'>");
		ktov_bnim("<h2>דרכים לקיום המצוות בימינו</h2> <ol class='TableSublists'>",
			"דרך:"," </ol>");

	document.write(
		"<td class='mcwwt'>");
		
	if (tdirut == 'erua') {
		ktov_bnim("<h2>מצוות שיש לקיים כשקורה ארוע זה</h2> <ol class='TableSublists'>", 
			"(מצוות_רגע|מצוה|מצוות|מצוות_ארוע|מצוות_זמן):", "</ol>");
		ktov_bnim("<h2>מצוות שתלויות באדם מסויים או בחפץ מסויים</h2> <ol class='TableSublists'>",
			"(מצוות_אדם|מצוות_עצם|מצוות_מקום):","</ol>");
		ktov_bnim("<h2>מצוות שיש לקיים כשרוצים לעשות פעולה מסויימת</h2> <ol class='TableSublists'>",
			"מצוות_רצון:","</ol>");
		ktov_bnim("<h2>נושאים קרובים</h2> <ol class='TableSublists'>",
			"(מצוות_ערך|מצוות_חובת):", " </ol>");
	}
	else if (tdirut == 'rcon') {
		ktov_bnim("<h2>מצוות שיש לקיים כשרוצים לעשות פעולה זו</h2> <ol class='TableSublists'>", 
			"(מצוות_רגע|מצוה|מצוות|מצוות_רצון):", "</ol>");
		ktov_bnim("<h2>מצוות שתלויות באדם מסויים או בחפץ מסויים</h2> <ol class='TableSublists'>",
			"(מצוות_אדם|מצוות_עצם|מצוות_מקום):","</ol>");
		ktov_bnim("<h2>מצוות שיש לקיים כשקורה ארוע מסויים</h2> <ol class='TableSublists'>",
			"(מצוות_ארוע|מצוות_זמן):", "</ol>");
		ktov_bnim("<h2>נושאים קרובים</h2> <ol class='TableSublists'>",
			"(מצוות_ערך|מצוות_חובת):", " </ol>");
	}
	else if (tdirut == 'ecm') {
		ktov_bnim("<h2>מצוות שצריך לקיים בקשר לאדם זה / חפץ זה</h2> <ol class='TableSublists'>", 
			"(מצוות_רגע|מצוה|מצוות|מצוות_עצם|מצוות_אדם|מצוות_מקום):", "</ol>");
		ktov_bnim("<h2>מצוות שיש לקיים כשרוצים לעשות פעולה מסויימת</h2> <ol class='TableSublists'>",
			"מצוות_רצון:","</ol>");
		ktov_bnim("<h2>מצוות שיש לקיים כשקורה ארוע מסויים</h2> <ol class='TableSublists'>",
			"(מצוות_ארוע|מצוות_זמן):", "</ol>");
		ktov_bnim("<h2>נושאים קרובים</h2> <ol class='TableSublists'>",
			"(מצוות_ערך|מצוות_חובת):", " </ol>");
	}
	else if (tdirut == 'mcwot') {
		ktov_bnim("<h2>מצוות וטעמים</h2> <ol class='TableSublists'>", 
			"(מצוות_רגע|מצוה|מצוות|מצוות_עצם|מצוות_אדם|מצוות_מקום|מצוות_ארוע|מצוות_זמן|מצוות_רצון|מצוות_חובת):", "</ol>");
		ktov_bnim("<h2>מצוות אחרות בנושאים קרובים</h2> <ol class='TableSublists'>",
			"מצוות_ערך:", " </ol>");
	}
	else /*if (tdirut == 'mcwot1')*/ {
		ktov_bnim("<ol class='TableSublists'>", 
			"(מצוות_רגע|מצוה|מצוות|מצוות_עצם|מצוות_אדם|מצוות_מקום|מצוות_ארוע|מצוות_זמן|מצוות_רצון|מצוות_חובת|מצוות_ערך):", "</ol>");
	}

	document.write(
		"</table>" + 
		"<table width='100%'>" + 
		"<col width='*'>" + 
		"<tbody>" + 
		"<tr>" + 
		"<td class='qyjwrym'>");

		ktov_bnim_axrim("<h2>מאמרים, דיונים וקישורים</h2> <ol class='TableSublists'>",
			"</ol>");
	document.write(
		"</table>");
}




/* _script/magrim */

var magrim_root = path_from_document_to_root + "tnk1/_magr/";
function table_link_item(table_name, table_description) {
	return "<li>" +
		"<b>" + table_name + "</b> (" +
		"<a href='" + magrim_root + table_name + ".sql'>הגדרה</a>, " +
		"<a href='" + magrim_root + table_name + ".txt'>תוכן</a>): " +
		table_description +
		"</li>\n";
}
function show_table(table_name, table_description) {
	document.write(table_link_item(table_name, table_description));
}

function mdb_table_link_item(table_name, table_description) {
	return "<li>" +
		"<b>" + table_name + "</b> (" +
		"<a href='" + path_from_document_to_root + "tnk1/_mdb/" + table_name +  ".txt'>תוכן</a>; <small>השורה הראשונה מכילה את שמות השדות</small>): " +
		table_description +
		"</li>\n";
}
function show_mdb_table(table_name, table_description) {
	document.write(mdb_table_link_item(table_name, table_description));
}

function show_table_warning() {
	document.write("<li>זהירות! חלק מהקבצים גדולים מאד (בסביבות 2 מ&quot;ב). לא מומלץ להקליק עליהם עם הכפתור השמאלי, כי זה יגרום להם להיפתח בחלון הדפדפן ולתקוע אותו. עדיף להקליק עליהם עם הכפתור הימני ולשמור אותם על המחשב שלכם. לאחר מכן ניתן לערוך אותם בעזרת &quot;אקסל&quot;." + 
	"</li>\n" + 
	"<li>חלק מהקבצים הם בקידוד חלונות 1255, וחלק בקידוד utf-8. אם אתם פותחים קובץ ורואים סימנים מוזרים, נסו להחליף את הקידוד." + 
	"</li>\n");
}


/* http://www.google.com/friendconnect/script/friendconnect.js */

window.google = window["google"] || {};google.friendconnect = google.friendconnect_ || {};if (!window['__ps_loaded__']) {/*http://www.a.friendconnect.gmodules.com/gadgets/js/rpc.js?c=1*/
var gadgets=gadgets||{},shindig=shindig||{};
;
gadgets.config=function(){var A=[];
var B;
return{register:function(E,D,C){var F=A[E];
if(!F){F=[];
A[E]=F
}F.push({validators:D||{},callback:C})
},get:function(C){if(C){return B[C]||{}
}return B
},init:function(E,L){B=E;
for(var C in A){if(A.hasOwnProperty(C)){var D=A[C],I=E[C];
for(var H=0,G=D.length;
H<G;
++H){var J=D[H];
if(I&&!L){var F=J.validators;
for(var K in F){if(F.hasOwnProperty(K)){if(!F[K](I[K])){throw new Error('Invalid config value "'+I[K]+'" for parameter "'+K+'" in component "'+C+'"')
}}}}if(J.callback){J.callback(E)
}}}}},EnumValidator:function(F){var E=[];
if(arguments.length>1){for(var D=0,C;
(C=arguments[D]);
++D){E.push(C)
}}else{E=F
}return function(H){for(var G=0,I;
(I=E[G]);
++G){if(H===E[G]){return true
}}}
},RegExValidator:function(C){return function(D){return C.test(D)
}
},ExistsValidator:function(C){return typeof C!=="undefined"
},NonEmptyStringValidator:function(C){return typeof C==="string"&&C.length>0
},BooleanValidator:function(C){return typeof C==="boolean"
},LikeValidator:function(C){return function(E){for(var F in C){if(C.hasOwnProperty(F)){var D=C[F];
if(!D(E[F])){return false
}}}return true
}
}}
}();;
gadgets.log=(function(){var E=1;
var A=2;
var F=3;
var C=4;
var D=function(I){B(E,I)
};
gadgets.warn=function(I){B(A,I)
};
gadgets.error=function(I){B(F,I)
};
gadgets.setLogLevel=function(I){H=I
};
function B(J,I){if(J<H||!G){return 
}if(J===A&&G.warn){G.warn(I)
}else{if(J===F&&G.error){G.error(I)
}else{if(G.log){G.log(I)
}}}}D.INFO=E;
D.WARNING=A;
D.NONE=C;
var H=E;
var G=window.console?window.console:window.opera?window.opera.postError:undefined;
return D
})();;
var tamings___=tamings___||[];
tamings___.push(function(A){___.grantRead(gadgets.log,"INFO");
___.grantRead(gadgets.log,"WARNING");
___.grantRead(gadgets.log,"ERROR");
___.grantRead(gadgets.log,"NONE");
caja___.whitelistFuncs([[gadgets,"log"],[gadgets,"warn"],[gadgets,"error"],[gadgets,"setLogLevel"]])
});;
if(window.JSON&&window.JSON.parse&&window.JSON.stringify){gadgets.json=(function(){var A=/___$/;
return{parse:function(C){try{return window.JSON.parse(C)
}catch(B){return false
}},stringify:function(C){try{return window.JSON.stringify(C,function(E,D){return !A.test(E)?D:null
})
}catch(B){return null
}}}
})()
}else{gadgets.json=function(){function f(n){return n<10?"0"+n:n
}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join("")
};
var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
function stringify(value){var a,i,k,l,r=/["\\\x00-\x1f\x7f-\x9f]/g,v;
switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];
if(c){return c
}c=a.charCodeAt();
return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"':'"'+value+'"';
case"number":return isFinite(value)?String(value):"null";
case"boolean":case"null":return String(value);
case"object":if(!value){return"null"
}a=[];
if(typeof value.length==="number"&&!value.propertyIsEnumerable("length")){l=value.length;
for(i=0;
i<l;
i+=1){a.push(stringify(value[i])||"null")
}return"["+a.join(",")+"]"
}for(k in value){if(k.match("___$")){continue
}if(value.hasOwnProperty(k)){if(typeof k==="string"){v=stringify(value[k]);
if(v){a.push(stringify(k)+":"+v)
}}}}return"{"+a.join(",")+"}"
}}return{stringify:stringify,parse:function(text){if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")
}return false
}}
}()
};;
var tamings___=tamings___||[];
tamings___.push(function(A){___.tamesTo(gadgets.json.stringify,safeJSON.stringify);
___.tamesTo(gadgets.json.parse,safeJSON.parse)
});;
gadgets.util=function(){function G(L){var M;
var K=L;
var I=K.indexOf("?");
var J=K.indexOf("#");
if(J===-1){M=K.substr(I+1)
}else{M=[K.substr(I+1,J-I-1),"&",K.substr(J+1)].join("")
}return M.split("&")
}var E=null;
var D={};
var C={};
var F=[];
var A={0:false,10:true,13:true,34:true,39:true,60:true,62:true,92:true,8232:true,8233:true};
function B(I,J){return String.fromCharCode(J)
}function H(I){D=I["core.util"]||{}
}if(gadgets.config){gadgets.config.register("core.util",null,H)
}return{getUrlParameters:function(Q){if(E!==null&&typeof Q==="undefined"){return E
}var M={};
E={};
var J=G(Q||document.location.href);
var O=window.decodeURIComponent?decodeURIComponent:unescape;
for(var L=0,K=J.length;
L<K;
++L){var N=J[L].indexOf("=");
if(N===-1){continue
}var I=J[L].substring(0,N);
var P=J[L].substring(N+1);
P=P.replace(/\+/g," ");
M[I]=O(P)
}if(typeof Q==="undefined"){E=M
}return M
},makeClosure:function(L,N,M){var K=[];
for(var J=2,I=arguments.length;
J<I;
++J){K.push(arguments[J])
}return function(){var O=K.slice();
for(var Q=0,P=arguments.length;
Q<P;
++Q){O.push(arguments[Q])
}return N.apply(L,O)
}
},makeEnum:function(J){var L={};
for(var K=0,I;
(I=J[K]);
++K){L[I]=I
}return L
},getFeatureParameters:function(I){return typeof D[I]==="undefined"?null:D[I]
},hasFeature:function(I){return typeof D[I]!=="undefined"
},getServices:function(){return C
},registerOnLoadHandler:function(I){F.push(I)
},runOnLoadHandlers:function(){for(var J=0,I=F.length;
J<I;
++J){F[J]()
}},escape:function(I,M){if(!I){return I
}else{if(typeof I==="string"){return gadgets.util.escapeString(I)
}else{if(typeof I==="array"){for(var L=0,J=I.length;
L<J;
++L){I[L]=gadgets.util.escape(I[L])
}}else{if(typeof I==="object"&&M){var K={};
for(var N in I){if(I.hasOwnProperty(N)){K[gadgets.util.escapeString(N)]=gadgets.util.escape(I[N],true)
}}return K
}}}}return I
},escapeString:function(M){if(!M){return M
}var J=[],L,N;
for(var K=0,I=M.length;
K<I;
++K){L=M.charCodeAt(K);
N=A[L];
if(N===true){J.push("&#",L,";")
}else{if(N!==false){J.push(M.charAt(K))
}}}return J.join("")
},unescapeString:function(I){if(!I){return I
}return I.replace(/&#([0-9]+);/g,B)
}}
}();
gadgets.util.getUrlParameters();;
var tamings___=tamings___||[];
tamings___.push(function(A){caja___.whitelistFuncs([[gadgets.util,"escapeString"],[gadgets.util,"getFeatureParameters"],[gadgets.util,"getUrlParameters"],[gadgets.util,"hasFeature"],[gadgets.util,"registerOnLoadHandler"],[gadgets.util,"unescapeString"]])
});;
gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.wpm){gadgets.rpctx.wpm=function(){var A;
return{getCode:function(){return"wpm"
},isParentVerifiable:function(){return true
},init:function(B,C){A=C;
var D=function(E){B(gadgets.json.parse(E.data))
};
if(typeof window.addEventListener!="undefined"){window.addEventListener("message",D,false)
}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onmessage",D)
}}A("..",true);
return true
},setup:function(C,B){if(C===".."){gadgets.rpc.call(C,gadgets.rpc.ACK)
}return true
},call:function(C,G,F){var E=gadgets.rpc._getTargetWin(C);
var D=gadgets.rpc.getRelayUrl(C)||gadgets.util.getUrlParameters()["parent"];
var B=gadgets.rpc.getOrigin(D);
if(B){E.postMessage(gadgets.json.stringify(F),B)
}else{gadgets.error("No relay set (used as window.postMessage targetOrigin), cannot send cross-domain message")
}return true
}}
}()
};;
gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.frameElement){gadgets.rpctx.frameElement=function(){var E="__g2c_rpc";
var B="__c2g_rpc";
var D;
var C;
function A(G,K,J){try{if(K!==".."){var F=window.frameElement;
if(typeof F[E]==="function"){if(typeof F[E][B]!=="function"){F[E][B]=function(L){D(gadgets.json.parse(L))
}
}F[E](gadgets.json.stringify(J));
return 
}}else{var I=document.getElementById(G);
if(typeof I[E]==="function"&&typeof I[E][B]==="function"){I[E][B](gadgets.json.stringify(J));
return 
}}}catch(H){}return true
}return{getCode:function(){return"fe"
},isParentVerifiable:function(){return false
},init:function(F,G){D=F;
C=G;
return true
},setup:function(J,F){if(J!==".."){try{var I=document.getElementById(J);
I[E]=function(K){D(gadgets.json.parse(K))
}
}catch(H){return false
}}if(J===".."){C("..",true);
var G=function(){window.setTimeout(function(){gadgets.rpc.call(J,gadgets.rpc.ACK)
},500)
};
gadgets.util.registerOnLoadHandler(G)
}return true
},call:function(F,H,G){A(F,H,G)
}}
}()
};;
gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.nix){gadgets.rpctx.nix=function(){var C="GRPC____NIXVBS_wrapper";
var D="GRPC____NIXVBS_get_wrapper";
var F="GRPC____NIXVBS_handle_message";
var B="GRPC____NIXVBS_create_channel";
var A=10;
var J=500;
var I={};
var H;
var G=0;
function E(){var L=I[".."];
if(L){return 
}if(++G>A){gadgets.warn("Nix transport setup failed, falling back...");
H("..",false);
return 
}if(!L&&window.opener&&"GetAuthToken" in window.opener){L=window.opener;
if(L.GetAuthToken()==gadgets.rpc.getAuthToken("..")){var K=gadgets.rpc.getAuthToken("..");
L.CreateChannel(window[D]("..",K),K);
I[".."]=L;
window.opener=null;
H("..",true);
return 
}}window.setTimeout(function(){E()
},J)
}return{getCode:function(){return"nix"
},isParentVerifiable:function(){return false
},init:function(L,M){H=M;
if(typeof window[D]!=="unknown"){window[F]=function(O){window.setTimeout(function(){L(gadgets.json.parse(O))
},0)
};
window[B]=function(O,Q,P){if(gadgets.rpc.getAuthToken(O)===P){I[O]=Q;
H(O,true)
}};
var K="Class "+C+"\n Private m_Intended\nPrivate m_Auth\nPublic Sub SetIntendedName(name)\n If isEmpty(m_Intended) Then\nm_Intended = name\nEnd If\nEnd Sub\nPublic Sub SetAuth(auth)\n If isEmpty(m_Auth) Then\nm_Auth = auth\nEnd If\nEnd Sub\nPublic Sub SendMessage(data)\n "+F+"(data)\nEnd Sub\nPublic Function GetAuthToken()\n GetAuthToken = m_Auth\nEnd Function\nPublic Sub CreateChannel(channel, auth)\n Call "+B+"(m_Intended, channel, auth)\nEnd Sub\nEnd Class\nFunction "+D+"(name, auth)\nDim wrap\nSet wrap = New "+C+"\nwrap.SetIntendedName name\nwrap.SetAuth auth\nSet "+D+" = wrap\nEnd Function";
try{window.execScript(K,"vbscript")
}catch(N){return false
}}return true
},setup:function(O,K){if(O===".."){E();
return true
}try{var M=document.getElementById(O);
var N=window[D](O,K);
M.contentWindow.opener=N
}catch(L){return false
}return true
},call:function(K,N,M){try{if(I[K]){I[K].SendMessage(gadgets.json.stringify(M))
}}catch(L){return false
}return true
}}
}()
};;
gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.rmr){gadgets.rpctx.rmr=function(){var G=500;
var E=10;
var H={};
var B;
var I;
function K(P,N,O,M){var Q=function(){document.body.appendChild(P);
P.src="about:blank";
if(M){P.onload=function(){L(M)
}
}P.src=N+"#"+O
};
if(document.body){Q()
}else{gadgets.util.registerOnLoadHandler(function(){Q()
})
}}function C(O){if(typeof H[O]==="object"){return 
}var P=document.createElement("iframe");
var M=P.style;
M.position="absolute";
M.top="0px";
M.border="0";
M.opacity="0";
M.width="10px";
M.height="1px";
P.id="rmrtransport-"+O;
P.name=P.id;
var N=gadgets.rpc.getRelayUrl(O);
if(!N){N=gadgets.rpc.getOrigin(gadgets.util.getUrlParameters()["parent"])+"/robots.txt"
}H[O]={frame:P,receiveWindow:null,relayUri:N,searchCounter:0,width:10,waiting:true,queue:[],sendId:0,recvId:0};
if(O!==".."){K(P,N,A(O))
}D(O)
}function D(O){var Q=null;
H[O].searchCounter++;
try{var N=gadgets.rpc._getTargetWin(O);
if(O===".."){Q=N.frames["rmrtransport-"+gadgets.rpc.RPC_ID]
}else{Q=N.frames["rmrtransport-.."]
}}catch(P){}var M=false;
if(Q){M=F(O,Q)
}if(!M){if(H[O].searchCounter>E){return 
}window.setTimeout(function(){D(O)
},G)
}}function J(N,P,T,S){var O=null;
if(T!==".."){O=H[".."]
}else{O=H[N]
}if(O){if(P!==gadgets.rpc.ACK){O.queue.push(S)
}if(O.waiting||(O.queue.length===0&&!(P===gadgets.rpc.ACK&&S&&S.ackAlone===true))){return true
}if(O.queue.length>0){O.waiting=true
}var M=O.relayUri+"#"+A(N);
try{O.frame.contentWindow.location=M;
var Q=O.width==10?20:10;
O.frame.style.width=Q+"px";
O.width=Q
}catch(R){return false
}}return true
}function A(N){var O=H[N];
var M={id:O.sendId};
if(O){M.d=Array.prototype.slice.call(O.queue,0);
M.d.push({s:gadgets.rpc.ACK,id:O.recvId})
}return gadgets.json.stringify(M)
}function L(X){var U=H[X];
var Q=U.receiveWindow.location.hash.substring(1);
var Y=gadgets.json.parse(decodeURIComponent(Q))||{};
var N=Y.d||[];
var O=false;
var T=false;
var V=0;
var M=(U.recvId-Y.id);
for(var P=0;
P<N.length;
++P){var S=N[P];
if(S.s===gadgets.rpc.ACK){I(X,true);
if(U.waiting){T=true
}U.waiting=false;
var R=Math.max(0,S.id-U.sendId);
U.queue.splice(0,R);
U.sendId=Math.max(U.sendId,S.id||0);
continue
}O=true;
if(++V<=M){continue
}++U.recvId;
B(S)
}if(O||(T&&U.queue.length>0)){var W=(X==="..")?gadgets.rpc.RPC_ID:"..";
J(X,gadgets.rpc.ACK,W,{ackAlone:O})
}}function F(P,S){var O=H[P];
try{var N=false;
N="document" in S;
if(!N){return false
}N=typeof S.document=="object";
if(!N){return false
}var R=S.location.href;
if(R==="about:blank"){return false
}}catch(M){return false
}O.receiveWindow=S;
function Q(){L(P)
}if(typeof S.attachEvent==="undefined"){S.onresize=Q
}else{S.attachEvent("onresize",Q)
}if(P===".."){K(O.frame,O.relayUri,A(P),P)
}else{L(P)
}return true
}return{getCode:function(){return"rmr"
},isParentVerifiable:function(){return true
},init:function(M,N){B=M;
I=N;
return true
},setup:function(O,M){try{C(O)
}catch(N){gadgets.warn("Caught exception setting up RMR: "+N);
return false
}return true
},call:function(M,O,N){return J(M,N.s,O,N)
}}
}()
};;
gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.ifpc){gadgets.rpctx.ifpc=function(){var E=[];
var D=0;
var C;
function B(H){var F=[];
for(var I=0,G=H.length;
I<G;
++I){F.push(encodeURIComponent(gadgets.json.stringify(H[I])))
}return F.join("&")
}function A(I){var G;
for(var F=E.length-1;
F>=0;
--F){var J=E[F];
try{if(J&&(J.recyclable||J.readyState==="complete")){J.parentNode.removeChild(J);
if(window.ActiveXObject){E[F]=J=null;
E.splice(F,1)
}else{J.recyclable=false;
G=J;
break
}}}catch(H){}}if(!G){G=document.createElement("iframe");
G.style.border=G.style.width=G.style.height="0px";
G.style.visibility="hidden";
G.style.position="absolute";
G.onload=function(){this.recyclable=true
};
E.push(G)
}G.src=I;
window.setTimeout(function(){document.body.appendChild(G)
},0)
}return{getCode:function(){return"ifpc"
},isParentVerifiable:function(){return true
},init:function(F,G){C=G;
C("..",true);
return true
},setup:function(G,F){C(G,true);
return true
},call:function(F,K,I){var J=gadgets.rpc.getRelayUrl(F);
++D;
if(!J){gadgets.warn("No relay file assigned for IFPC");
return 
}var H=null;
if(I.l){var G=I.a;
H=[J,"#",B([K,D,1,0,B([K,I.s,"","",K].concat(G))])].join("")
}else{H=[J,"#",F,"&",K,"@",D,"&1&0&",encodeURIComponent(gadgets.json.stringify(I))].join("")
}A(H);
return true
}}
}()
};;
if(!gadgets.rpc){gadgets.rpc=function(){var T="__cb";
var S="";
var G="__ack";
var R=500;
var J=10;
var B={};
var C={};
var X={};
var K={};
var N=0;
var i={};
var W={};
var D={};
var f={};
var L={};
var V={};
var M=(window.top!==window.self);
var O=window.name;
var g=(function(){function j(k){return function(){gadgets.log("gadgets.rpc."+k+"("+gadgets.json.stringify(Array.prototype.slice.call(arguments))+"): call ignored. [caller: "+document.location+", isChild: "+M+"]")
}
}return{getCode:function(){return"noop"
},isParentVerifiable:function(){return true
},init:j("init"),setup:j("setup"),call:j("call")}
})();
if(gadgets.util){f=gadgets.util.getUrlParameters()
}var a=(f.rpc_earlyq==="1");
function A(){return typeof window.postMessage==="function"?gadgets.rpctx.wpm:typeof window.postMessage==="object"?gadgets.rpctx.wpm:window.ActiveXObject?gadgets.rpctx.nix:navigator.userAgent.indexOf("WebKit")>0?gadgets.rpctx.rmr:navigator.product==="Gecko"?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc
}function b(o,m){var k=c;
if(!m){k=g
}L[o]=k;
var j=V[o]||[];
for(var l=0;
l<j.length;
++l){var n=j[l];
n.t=Y(o);
k.call(o,n.f,n)
}V[o]=[]
}function U(k){if(k&&typeof k.s==="string"&&typeof k.f==="string"&&k.a instanceof Array){if(K[k.f]){if(K[k.f]!==k.t){throw new Error("Invalid auth token. "+K[k.f]+" vs "+k.t)
}}if(k.s===G){window.setTimeout(function(){b(k.f,true)
},0);
return 
}if(k.c){k.callback=function(l){gadgets.rpc.call(k.f,T,null,k.c,l)
}
}var j=(B[k.s]||B[S]).apply(k,k.a);
if(k.c&&typeof j!=="undefined"){gadgets.rpc.call(k.f,T,null,k.c,j)
}}}function e(l){if(!l){return""
}l=l.toLowerCase();
if(l.indexOf("//")==0){l=window.location.protocol+l
}if(l.indexOf("://")==-1){l=window.location.protocol+"//"+l
}var m=l.substring(l.indexOf("://")+3);
var j=m.indexOf("/");
if(j!=-1){m=m.substring(0,j)
}var o=l.substring(0,l.indexOf("://"));
var n="";
var p=m.indexOf(":");
if(p!=-1){var k=m.substring(p+1);
m=m.substring(0,p);
if((o==="http"&&k!=="80")||(o==="https"&&k!=="443")){n=":"+k
}}return o+"://"+m+n
}function I(k){if(typeof k==="undefined"||k===".."){return window.parent
}k=String(k);
var j=window.frames[k];
if(j){return j
}j=document.getElementById(k);
if(j&&j.contentWindow){return j.contentWindow
}return null
}var c=A();
B[S]=function(){gadgets.warn("Unknown RPC service: "+this.s)
};
B[T]=function(k,j){var l=i[k];
if(l){delete i[k];
l(j)
}};
function P(l,j){if(W[l]===true){return 
}if(typeof W[l]==="undefined"){W[l]=0
}var k=document.getElementById(l);
if(l===".."||k!=null){if(c.setup(l,j)===true){W[l]=true;
return 
}}if(W[l]!==true&&W[l]++<J){window.setTimeout(function(){P(l,j)
},R)
}else{L[l]=g;
W[l]=true
}}function F(k,n){if(typeof D[k]==="undefined"){D[k]=false;
var m=gadgets.rpc.getRelayUrl(k);
if(e(m)!==e(window.location.href)){return false
}var l=I(k);
try{D[k]=l.gadgets.rpc.receiveSameDomain
}catch(j){gadgets.error("Same domain call failed: parent= incorrectly set.")
}}if(typeof D[k]==="function"){D[k](n);
return true
}return false
}function H(k,j,l){C[k]=j;
X[k]=!!l
}function Y(j){return K[j]
}function E(j,k){k=k||"";
K[j]=String(k);
P(j,k)
}function Q(j){function l(o){var q=o?o.rpc:{};
var n=q.parentRelayUrl;
if(n.substring(0,7)!=="http://"&&n.substring(0,8)!=="https://"&&n.substring(0,2)!=="//"){if(typeof f.parent==="string"&&f.parent!==""){if(n.substring(0,1)!=="/"){var m=f.parent.lastIndexOf("/");
n=f.parent.substring(0,m+1)+n
}else{n=e(f.parent)+n
}}}var p=!!q.useLegacyProtocol;
H("..",n,p);
if(p){c=gadgets.rpctx.ifpc;
c.init(U,b)
}E("..",j)
}var k={parentRelayUrl:gadgets.config.NonEmptyStringValidator};
gadgets.config.register("rpc",k,l)
}function Z(l,j){var k=j||f.parent;
if(k){H("..",k);
E("..",l)
}}function d(j,n,p){if(!gadgets.util){return 
}var m=document.getElementById(j);
if(!m){throw new Error("Cannot set up gadgets.rpc receiver with ID: "+j+", element not found.")
}var k=n||m.src;
H(j,k);
var o=gadgets.util.getUrlParameters(m.src);
var l=p||o.rpctoken;
E(j,l)
}function h(j,l,m){if(j===".."){var k=m||f.rpctoken||f.ifpctok||"";
if(window.__isgadget===true){Q(k)
}else{Z(k,l)
}}else{d(j,l,m)
}}return{register:function(k,j){if(k===T||k===G){throw new Error("Cannot overwrite callback/ack service")
}if(k===S){throw new Error("Cannot overwrite default service: use registerDefault")
}B[k]=j
},unregister:function(j){if(j===T||j===G){throw new Error("Cannot delete callback/ack service")
}if(j===S){throw new Error("Cannot delete default service: use unregisterDefault")
}delete B[j]
},registerDefault:function(j){B[S]=j
},unregisterDefault:function(){delete B[S]
},forceParentVerifiable:function(){if(!c.isParentVerifiable()){c=gadgets.rpctx.ifpc
}},call:function(j,k,p,n){j=j||"..";
var o="..";
if(j===".."){o=O
}++N;
if(p){i[N]=p
}var m={s:k,f:o,c:p?N:0,a:Array.prototype.slice.call(arguments,3),t:K[j],l:X[j]};
if(j!==".."&&!document.getElementById(j)){gadgets.log("WARNING: attempted send to nonexistent frame: "+j);
return 
}if(F(j,m)){return 
}var l=L[j]?L[j]:c;
if(!l){if(!V[j]){V[j]=[m]
}else{V[j].push(m)
}return 
}if(X[j]){l=gadgets.rpctx.ifpc
}if(l.call(j,o,m)===false){L[j]=g;
c.call(j,o,m)
}},getRelayUrl:function(k){var j=C[k];
if(j&&j.indexOf("//")==0){j=document.location.protocol+j
}return j
},setRelayUrl:H,setAuthToken:E,setupReceiver:h,getAuthToken:Y,getRelayChannel:function(){return c.getCode()
},receive:function(j){if(j.length>4){U(gadgets.json.parse(decodeURIComponent(j[j.length-1])))
}},receiveSameDomain:function(j){j.a=Array.prototype.slice.call(j.a);
window.setTimeout(function(){U(j)
},0)
},getOrigin:e,init:function(){if(c.init(U,b)===false){c=g
}if(M){h("..")
}},_getTargetWin:I,ACK:G,RPC_ID:O}
}();
gadgets.rpc.init()
};;
var friendconnect_serverBase = "http://www.google.com";var friendconnect_loginUrl = "https://www.google.com/accounts";var friendconnect_gadgetPrefix = "http://www.a.friendconnect.gmodules.com/gadgets";
var friendconnect_serverVersion = "0.546.6";
var friendconnect_imageUrl = "http://www.google.com/friendconnect/scs/images";
var friendconnect_lightbox = true;
function fca(a){throw a;}var fcb=true,fcc=null,fcd=false,fce=gadgets,fcf=undefined,fcg=friendconnect_serverBase,fch=encodeURIComponent,fcaa=parseInt,fci=String,fcj=window,fcba=setTimeout,fcca=Object,fck=document,fcl=Math;function fcda(a,b){return a.toString=b}function fcea(a,b){return a.length=b}function fcfa(a,b){return a.className=b}function fcm(a,b){return a.width=b}function fcn(a,b){return a.innerHTML=b}function fco(a,b){return a.height=b}
var fcp="appendChild",fcq="push",fcga="toString",fcr="length",fcha="propertyIsEnumerable",fcia="stringify",fc="prototype",fcja="test",fcs="width",fct="round",fcu="slice",fcv="replace",fcw="document",fcka="data",fcx="split",fcy="getElementById",fcla="offsetWidth",fcz="charAt",fcA="location",fcB="getUrlParameters",fcC="indexOf",fcma="Dialog",fcD="style",fcna="body",fcE="left",fcF="call",fcG="match",fcH="options",fcoa="random",fcI="createElement",fcpa="json",fcqa="addEventListener",fcra="bottom",fcJ=
"setAttribute",fcsa="href",fcK="util",fcta="maxHeight",fcua="type",fcL="apply",fcva="auth",fcwa="reset",fcxa="getSecurityToken",fcM="name",fcN="parentNode",fcya="display",fcO="height",fcza="offsetHeight",fcP="register",fcQ="join",fcAa="toLowerCase",fcR="right",goog=goog||{},fcS=this,fcCa=function(a,b,c){a=a[fcx](".");c=c||fcS;!(a[0]in c)&&c.execScript&&c.execScript("var "+a[0]);for(var d;a[fcr]&&(d=a.shift());)if(!a[fcr]&&fcBa(b))c[d]=b;else c=c[d]?c[d]:(c[d]={})},fcDa=function(a){var b=typeof a;
if(b=="object")if(a){if(a instanceof Array||!(a instanceof fcca)&&fcca[fc][fcga][fcF](a)=="[object Array]"||typeof a[fcr]=="number"&&typeof a.splice!="undefined"&&typeof a[fcha]!="undefined"&&!a[fcha]("splice"))return"array";if(!(a instanceof fcca)&&(fcca[fc][fcga][fcF](a)=="[object Function]"||typeof a[fcF]!="undefined"&&typeof a[fcha]!="undefined"&&!a[fcha]("call")))return"function"}else return"null";else if(b=="function"&&typeof a[fcF]=="undefined")return"object";return b},fcBa=function(a){return a!==
fcf},fcEa=function(a){var b=fcDa(a);return b=="array"||b=="object"&&typeof a[fcr]=="number"},fcT=function(a){return typeof a=="string"},fcFa=function(a){a=fcDa(a);return a=="object"||a=="array"||a=="function"};"closure_uid_"+fcl.floor(fcl[fcoa]()*2147483648)[fcga](36);
var fcU=function(a){var b=fcDa(a);if(b=="object"||b=="array"){if(a.clone)return a.clone[fcF](a);b=b=="array"?[]:{};for(var c in a)b[c]=fcU(a[c]);return b}return a},fcV=function(a,b){var c=b||fcS;if(arguments[fcr]>2){var d=Array[fc][fcu][fcF](arguments,2);return function(){var e=Array[fc][fcu][fcF](arguments);Array[fc].unshift[fcL](e,d);return a[fcL](c,e)}}else return function(){return a[fcL](c,arguments)}},fcGa=function(a){var b=Array[fc][fcu][fcF](arguments,1);return function(){var c=Array[fc][fcu][fcF](arguments);
c.unshift[fcL](c,b);return a[fcL](this,c)}},fcHa=function(a,b){for(var c in b)a[c]=b[c]},fcW=function(a,b,c){fcCa(a,b,c)},fcX=function(a,b){function c(){}c.prototype=b[fc];a.Kc=b[fc];a.prototype=new c;a[fc].constructor=a};SHA1=function(){this.c=new Array(5);this.ba=new Array(64);this.Bc=new Array(80);this.qa=new Array(64);this.qa[0]=128;for(var a=1;a<64;++a)this.qa[a]=0;this[fcwa]()};SHA1[fc].reset=function(){this.c[0]=1732584193;this.c[1]=4023233417;this.c[2]=2562383102;this.c[3]=271733878;this.c[4]=3285377520;this.wa=this.z=0};SHA1[fc].va=function(a,b){return(a<<b|a>>>32-b)&4294967295};
SHA1[fc].L=function(a){for(var b=this.Bc,c=0;c<64;c+=4){var d=a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3];b[c/4]=d}for(c=16;c<80;++c)b[c]=this.va(b[c-3]^b[c-8]^b[c-14]^b[c-16],1);a=this.c[0];d=this.c[1];var e=this.c[2],h=this.c[3],i=this.c[4],j,k;for(c=0;c<80;++c){if(c<40)if(c<20){j=h^d&(e^h);k=1518500249}else{j=d^e^h;k=1859775393}else if(c<60){j=d&e|h&(d|e);k=2400959708}else{j=d^e^h;k=3395469782}j=this.va(a,5)+j+i+k+b[c]&4294967295;i=h;h=e;e=this.va(d,30);d=a;a=j}this.c[0]=this.c[0]+a&4294967295;this.c[1]=
this.c[1]+d&4294967295;this.c[2]=this.c[2]+e&4294967295;this.c[3]=this.c[3]+h&4294967295;this.c[4]=this.c[4]+i&4294967295};SHA1[fc].update=function(a,b){if(!b)b=a[fcr];var c=0;if(this.z==0)for(;c+64<b;){this.L(a[fcu](c,c+64));c+=64;this.wa+=64}for(;c<b;){this.ba[this.z++]=a[c++];++this.wa;if(this.z==64){this.z=0;for(this.L(this.ba);c+64<b;){this.L(a[fcu](c,c+64));c+=64;this.wa+=64}}}};
SHA1[fc].digest=function(){var a=new Array(20),b=this.wa*8;this.z<56?this.update(this.qa,56-this.z):this.update(this.qa,64-(this.z-56));for(var c=63;c>=56;--c){this.ba[c]=b&255;b>>>=8}this.L(this.ba);for(c=b=0;c<5;++c)for(var d=24;d>=0;d-=8)a[b++]=this.c[c]>>d&255;return a};G_HMAC=function(a,b,c){if(!a||typeof a!="object"||!a[fcwa]||!a.update||!a.digest)fca(new Error("Invalid hasher object. Hasher unspecified or does not implement expected interface."));if(b.constructor!=Array)fca(new Error("Invalid key."));if(c&&typeof c!="number")fca(new Error("Invalid block size."));this.k=a;this.aa=c||16;this.Rb=new Array(this.aa);this.Qb=new Array(this.aa);if(b[fcr]>this.aa){this.k.update(b);b=this.k.digest()}for(c=0;c<this.aa;c++){a=c<b[fcr]?b[c]:0;this.Rb[c]=a^G_HMAC.OPAD;this.Qb[c]=
a^G_HMAC.IPAD}};G_HMAC.OPAD=92;G_HMAC.IPAD=54;G_HMAC[fc].reset=function(){this.k[fcwa]();this.k.update(this.Qb)};G_HMAC[fc].update=function(a){if(a.constructor!=Array)fca(new Error("Invalid data. Data must be an array."));this.k.update(a)};G_HMAC[fc].digest=function(){var a=this.k.digest();this.k[fcwa]();this.k.update(this.Rb);this.k.update(a);return this.k.digest()};G_HMAC[fc].Fb=function(a){this[fcwa]();this.update(a);return this.digest()};var fcIa=function(a){for(var b=[],c=0,d=0;d<a[fcr];d++){for(var e=a.charCodeAt(d);e>255;){b[c++]=e&255;e>>=8}b[c++]=e}return b};var fcJa=fcc,fcKa=fcc,fcLa=fcc,fcMa=fcc,fcOa=function(a,b){if(!fcEa(a))fca(Error("encodeByteArray takes an array as a parameter"));fcNa();for(var c=b?fcLa:fcJa,d=[],e=0;e<a[fcr];e+=3){var h=a[e],i=e+1<a[fcr],j=i?a[e+1]:0,k=e+2<a[fcr],l=k?a[e+2]:0,g=h>>2;h=(h&3)<<4|j>>4;j=(j&15)<<2|l>>6;l=l&63;if(!k){l=64;i||(j=64)}d[fcq](c[g],c[h],c[j],c[l])}return d[fcQ]("")},fcPa=function(a,b){if(a[fcr]%4)fca(Error("Length of b64-encoded data must be zero mod four"));fcNa();for(var c=b?fcMa:fcKa,d=[],e=0;e<a[fcr];e+=
4){var h=c[a[fcz](e)],i=c[a[fcz](e+1)],j=c[a[fcz](e+2)],k=c[a[fcz](e+3)];if(h==fcc||i==fcc||j==fcc||k==fcc)fca(Error());h=h<<2|i>>4;d[fcq](h);if(j!=64){i=i<<4&240|j>>2;d[fcq](i);if(k!=64){j=j<<6&192|k;d[fcq](j)}}}return d},fcNa=function(){if(!fcJa){fcJa={};fcKa={};fcLa={};fcMa={};for(var a=0;a<65;a++){fcJa[a]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="[fcz](a);fcKa[fcJa[a]]=a;fcLa[a]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_."[fcz](a);fcMa[fcLa[a]]=
a}}};var fcQa=function(a,b){var c=fci(a)[fcAa](),d=fci(b)[fcAa]();return c<d?-1:c==d?0:1},fcWa=function(a,b){if(b)return a[fcv](fcRa,"&amp;")[fcv](fcSa,"&lt;")[fcv](fcTa,"&gt;")[fcv](fcUa,"&quot;");else{if(!fcVa[fcja](a))return a;if(a[fcC]("&")!=-1)a=a[fcv](fcRa,"&amp;");if(a[fcC]("<")!=-1)a=a[fcv](fcSa,"&lt;");if(a[fcC](">")!=-1)a=a[fcv](fcTa,"&gt;");if(a[fcC]('"')!=-1)a=a[fcv](fcUa,"&quot;");return a}},fcRa=/&/g,fcSa=/</g,fcTa=/>/g,fcUa=/\"/g,fcVa=/[&<>\"]/,fcYa=function(a,b){for(var c=0,d=fci(a)[fcv](/^[\s\xa0]+|[\s\xa0]+$/g,
"")[fcx]("."),e=fci(b)[fcv](/^[\s\xa0]+|[\s\xa0]+$/g,"")[fcx]("."),h=fcl.max(d[fcr],e[fcr]),i=0;c==0&&i<h;i++){var j=d[i]||"",k=e[i]||"",l=new RegExp("(\\d*)(\\D*)","g"),g=new RegExp("(\\d*)(\\D*)","g");do{var f=l.exec(j)||["","",""],m=g.exec(k)||["","",""];if(f[0][fcr]==0&&m[0][fcr]==0)break;c=f[1][fcr]==0?0:fcaa(f[1],10);var n=m[1][fcr]==0?0:fcaa(m[1],10);c=fcXa(c,n)||fcXa(f[2][fcr]==0,m[2][fcr]==0)||fcXa(f[2],m[2])}while(c==0)}return c},fcXa=function(a,b){if(a<b)return-1;else if(a>b)return 1;return 0};var fcZa,fc_a,fc0a,fc1a,fc2a,fc3a,fc4a,fc5a,fc6a,fc7a=function(){return fcS.navigator?fcS.navigator.userAgent:fcc},fc8a=function(){return fcS.navigator},fc9a=function(){fc2a=fc1a=fc0a=fc_a=fcZa=fcd;var a;if(a=fc7a()){var b=fc8a();fcZa=a[fcC]("Opera")==0;fc_a=!fcZa&&a[fcC]("MSIE")!=-1;fc1a=(fc0a=!fcZa&&a[fcC]("WebKit")!=-1)&&a[fcC]("Mobile")!=-1;fc2a=!fcZa&&!fc0a&&b.product=="Gecko"}};fc9a();
var fc$a=fcZa,fcY=fc_a,fcab=fc2a,fcbb=fc0a,fccb=fc1a,fcdb=function(){var a=fc8a();return a&&a.platform||""},fceb=fcdb(),fcfb=function(){fc3a=fceb[fcC]("Mac")!=-1;fc4a=fceb[fcC]("Win")!=-1;fc5a=fceb[fcC]("Linux")!=-1;fc6a=!!fc8a()&&(fc8a().appVersion||"")[fcC]("X11")!=-1};fcfb();
var fcgb=function(){var a="",b;if(fc$a&&fcS.opera){a=fcS.opera.version;a=typeof a=="function"?a():a}else{if(fcab)b=/rv\:([^\);]+)(\)|;)/;else if(fcY)b=/MSIE\s+([^\);]+)(\)|;)/;else if(fcbb)b=/WebKit\/(\S+)/;if(b)a=(a=b.exec(fc7a()))?a[1]:""}return a},fchb=fcgb(),fcib={},fcjb=function(a){return fcib[a]||(fcib[a]=fcYa(fchb,a)>=0)};var fckb=/\s*;\s*/,fclb=function(a,b,c,d,e){if(/[;=]/[fcja](a))fca(Error('Invalid cookie name "'+a+'"'));if(/;/[fcja](b))fca(Error('Invalid cookie value "'+b+'"'));fcBa(c)||(c=-1);e=e?";domain="+e:"";d=d?";path="+d:"";if(c<0)c="";else if(c==0){c=new Date(1970,1,1);c=";expires="+c.toUTCString()}else{c=new Date((new Date).getTime()+c*1E3);c=";expires="+c.toUTCString()}fck.cookie=a+"="+b+e+d+c},fcmb=function(a,b){for(var c=a+"=",d=fci(fck.cookie)[fcx](fckb),e=0,h;h=d[e];e++)if(h[fcC](c)==0)return h.substr(c[fcr]);
return b},fcnb=function(a,b,c){var d=fcBa(fcmb(a));fclb(a,"",0,b,c);return d};var fcZ=Array[fc],fcob=fcZ[fcC]?function(a,b,c){return fcZ[fcC][fcF](a,b,c)}:function(a,b,c){c=c==fcc?0:c<0?fcl.max(0,a[fcr]+c):c;if(fcT(a)){if(!fcT(b)||b[fcr]!=1)return-1;return a[fcC](b,c)}for(c=c;c<a[fcr];c++)if(c in a&&a[c]===b)return c;return-1},fcpb=fcZ.forEach?function(a,b,c){fcZ.forEach[fcF](a,b,c)}:function(a,b,c){for(var d=a[fcr],e=fcT(a)?a[fcx](""):a,h=0;h<d;h++)h in e&&b[fcF](c,e[h],h,a)},fcqb=function(a,b){return fcob(a,b)>=0},fcrb=function(){return fcZ.concat[fcL](fcZ,arguments)},fcsb=
function(a){if(fcDa(a)=="array")return fcrb(a);else{for(var b=[],c=0,d=a[fcr];c<d;c++)b[c]=a[c];return b}},fctb=function(a,b,c){return arguments[fcr]<=2?fcZ[fcu][fcF](a,b):fcZ[fcu][fcF](a,b,c)};var fcub=function(a,b){this.x=fcBa(a)?a:0;this.y=fcBa(b)?b:0};fcub[fc].clone=function(){return new fcub(this.x,this.y)};fcda(fcub[fc],function(){return"("+this.x+", "+this.y+")"});var fc_=function(a,b){fcm(this,a);fco(this,b)};fc_[fc].clone=function(){return new fc_(this[fcs],this[fcO])};fcda(fc_[fc],function(){return"("+this[fcs]+" x "+this[fcO]+")"});fc_[fc].ceil=function(){fcm(this,fcl.ceil(this[fcs]));fco(this,fcl.ceil(this[fcO]));return this};fc_[fc].floor=function(){fcm(this,fcl.floor(this[fcs]));fco(this,fcl.floor(this[fcO]));return this};fc_[fc].round=function(){fcm(this,fcl[fct](this[fcs]));fco(this,fcl[fct](this[fcO]));return this};
fc_[fc].scale=function(a){this.width*=a;this.height*=a;return this};var fcvb=function(a,b,c){for(var d in a)b[fcF](c,a[d],d,a)},fcwb=function(a){var b=[],c=0;for(var d in a)b[c++]=a[d];return b},fcxb=function(a){var b=[],c=0;for(var d in a)b[c++]=d;return b},fcyb=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],fczb=function(a){for(var b,c,d=1;d<arguments[fcr];d++){c=arguments[d];for(b in c)a[b]=c[b];for(var e=0;e<fcyb[fcr];e++){b=fcyb[e];if(fcca[fc].hasOwnProperty[fcF](c,b))a[b]=c[b]}}};var fcAb=function(a){return(a=a.className)&&typeof a[fcx]=="function"?a[fcx](/\s+/):[]},fcCb=function(a){var b=fcAb(a),c=fctb(arguments,1);c=fcBb(b,c);fcfa(a,b[fcQ](" "));return c},fcBb=function(a,b){for(var c=0,d=0;d<b[fcr];d++)if(!fcqb(a,b[d])){a[fcq](b[d]);c++}return c==b[fcr]};var fcDb=function(a){return fcT(a)?fck[fcy](a):a},fcEb=fcDb,fcFb=function(a,b,c,d){d=d||a;b=b&&b!="*"?b.toUpperCase():"";if(d.querySelectorAll&&(b||c)&&(!fcbb||a.compatMode=="CSS1Compat"||fcjb("528"))){c=b+(c?"."+c:"");return d.querySelectorAll(c)}if(c&&d.getElementsByClassName){a=d.getElementsByClassName(c);if(b){d={};for(var e=0,h=0,i;i=a[h];h++)if(b==i.nodeName)d[e++]=i;fcea(d,e);return d}else return a}a=d.getElementsByTagName(b||"*");if(c){d={};for(h=e=0;i=a[h];h++){b=i.className;if(typeof b[fcx]==
"function"&&fcqb(b[fcx](/\s+/),c))d[e++]=i}fcea(d,e);return d}else return a},fcHb=function(a,b){fcvb(b,function(c,d){if(d=="style")a[fcD].cssText=c;else if(d=="class")fcfa(a,c);else if(d=="for")a.htmlFor=c;else if(d in fcGb)a[fcJ](fcGb[d],c);else a[d]=c})},fcGb={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder",type:"type"},fcIb=function(a){var b=a[fcw];if(fcbb&&!fcjb("500")&&
!fccb){if(typeof a.innerHeight=="undefined")a=fcj;b=a.innerHeight;var c=a[fcw].documentElement.scrollHeight;if(a==a.top)if(c<b)b-=15;return new fc_(a.innerWidth,b)}a=b.compatMode=="CSS1Compat"&&(!fc$a||fc$a&&fcjb("9.50"))?b.documentElement:b[fcna];return new fc_(a.clientWidth,a.clientHeight)},fc0=function(){return fcJb(fck,arguments)},fcJb=function(a,b){var c=b[0],d=b[1];if(fcY&&d&&(d[fcM]||d[fcua])){c=["<",c];d[fcM]&&c[fcq](' name="',fcWa(d[fcM]),'"');if(d[fcua]){c[fcq](' type="',fcWa(d[fcua]),'"');
d=fcU(d);delete d[fcua]}c[fcq](">");c=c[fcQ]("")}var e=a[fcI](c);if(d)if(fcT(d))fcfa(e,d);else fcHb(e,d);if(b[fcr]>2){d=function(i){if(i)e[fcp](fcT(i)?a.createTextNode(i):i)};for(c=2;c<b[fcr];c++){var h=b[c];fcEa(h)&&!(fcFa(h)&&h.nodeType>0)?fcpb(fcKb(h)?fcsb(h):h,d):d(h)}}return e},fcLb=function(a,b){a[fcp](b)},fcMb=function(a){return a&&a[fcN]?a[fcN].removeChild(a):fcc},fcNb=function(a,b){var c=b[fcN];c&&c.replaceChild(a,b)},fcOb=function(a,b){if(a.contains&&b.nodeType==1)return a==b||a.contains(b);
if(typeof a.compareDocumentPosition!="undefined")return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b[fcN];return b==a},fcKb=function(a){if(a&&typeof a[fcr]=="number")if(fcFa(a))return typeof a.item=="function"||typeof a.item=="string";else if(fcDa(a)=="function")return typeof a.item=="function";return fcd},fcPb=function(a){this.tb=a||fcS[fcw]||fck};fcPb[fc].createElement=function(a){return this.tb[fcI](a)};fcPb[fc].createTextNode=function(a){return this.tb.createTextNode(a)};
fcPb[fc].appendChild=fcLb;fcPb[fc].removeNode=fcMb;fcPb[fc].replaceNode=fcNb;fcPb[fc].contains=fcOb;var fcQb="StopIteration"in fcS?fcS.StopIteration:Error("StopIteration"),fcRb=function(){};fcRb[fc].next=function(){fca(fcQb)};fcRb[fc].__iterator__=function(){return this};var fc1=function(a){this.i={};this.e=[];var b=arguments[fcr];if(b>1){if(b%2)fca(Error("Uneven number of arguments"));for(var c=0;c<b;c+=2)this.set(arguments[c],arguments[c+1])}else a&&this.jb(a)};fc1[fc].q=0;fc1[fc].J=0;fc1[fc].Ka=function(){return this.q};fc1[fc].ja=function(){this.K();for(var a=[],b=0;b<this.e[fcr];b++){var c=this.e[b];a[fcq](this.i[c])}return a};fc1[fc].P=function(){this.K();return this.e.concat()};fc1[fc].qb=function(a){return fcSb(this.i,a)};
fc1[fc].clear=function(){this.i={};fcea(this.e,0);this.J=this.q=0};fc1[fc].remove=function(a){if(fcSb(this.i,a)){delete this.i[a];this.q--;this.J++;this.e[fcr]>2*this.q&&this.K();return fcb}return fcd};fc1[fc].K=function(){if(this.q!=this.e[fcr]){for(var a=0,b=0;a<this.e[fcr];){var c=this.e[a];if(fcSb(this.i,c))this.e[b++]=c;a++}fcea(this.e,b)}if(this.q!=this.e[fcr]){var d={};for(b=a=0;a<this.e[fcr];){c=this.e[a];if(!fcSb(d,c)){this.e[b++]=c;d[c]=1}a++}fcea(this.e,b)}};
fc1[fc].get=function(a,b){if(fcSb(this.i,a))return this.i[a];return b};fc1[fc].set=function(a,b){if(!fcSb(this.i,a)){this.q++;this.e[fcq](a);this.J++}this.i[a]=b};fc1[fc].jb=function(a){var b;if(a instanceof fc1){b=a.P();a=a.ja()}else{b=fcxb(a);a=fcwb(a)}for(var c=0;c<b[fcr];c++)this.set(b[c],a[c])};fc1[fc].clone=function(){return new fc1(this)};
fc1[fc].__iterator__=function(a){this.K();var b=0,c=this.e,d=this.i,e=this.J,h=this,i=new fcRb;i.next=function(){for(;;){if(e!=h.J)fca(Error("The map has changed since the iterator was created"));if(b>=c[fcr])fca(fcQb);var j=c[b++];return a?j:d[j]}};return i};var fcSb=function(a,b){return fcca[fc].hasOwnProperty[fcF](a,b)};var fcTb=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};fcTb[fc].clone=function(){return new fcTb(this.top,this[fcR],this[fcra],this[fcE])};fcda(fcTb[fc],function(){return"("+this.top+"t, "+this[fcR]+"r, "+this[fcra]+"b, "+this[fcE]+"l)"});fcTb[fc].contains=function(a){return fcUb(this,a)};fcTb[fc].expand=function(a,b,c,d){if(fcFa(a)){this.top-=a.top;this.right+=a[fcR];this.bottom+=a[fcra];this.left-=a[fcE]}else{this.top-=a;this.right+=b;this.bottom+=c;this.left-=d}return this};
var fcUb=function(a,b){if(!a||!b)return fcd;if(b instanceof fcTb)return b[fcE]>=a[fcE]&&b[fcR]<=a[fcR]&&b.top>=a.top&&b[fcra]<=a[fcra];return b.x>=a[fcE]&&b.x<=a[fcR]&&b.y>=a.top&&b.y<=a[fcra]};var fcVb=function(a,b,c,d){this.left=a;this.top=b;fcm(this,c);fco(this,d)};fcVb[fc].clone=function(){return new fcVb(this[fcE],this.top,this[fcs],this[fcO])};fcda(fcVb[fc],function(){return"("+this[fcE]+", "+this.top+" - "+this[fcs]+"w x "+this[fcO]+"h)"});fcVb[fc].contains=function(a){return a instanceof fcVb?this[fcE]<=a[fcE]&&this[fcE]+this[fcs]>=a[fcE]+a[fcs]&&this.top<=a.top&&this.top+this[fcO]>=a.top+a[fcO]:a.x>=this[fcE]&&a.x<=this[fcE]+this[fcs]&&a.y>=this.top&&a.y<=this.top+this[fcO]};var fcXb=function(a,b,c){fcT(b)?fcWb(a,c,b):fcvb(b,fcGa(fcWb,a))},fcWb=function(a,b,c){a[fcD][fcYb(c)]=b},fcZb=function(a,b){var c=a.nodeType==9?a:a.ownerDocument||a[fcw];if(c.defaultView&&c.defaultView.getComputedStyle)if(c=c.defaultView.getComputedStyle(a,""))return c[b];return fcc},fc_b=function(a,b,c){if(b instanceof fc_){c=b[fcO];b=b[fcs]}else{if(c==fcf)fca(Error("missing height argument"));c=c}fcm(a[fcD],typeof b=="number"?fcl[fct](b)+"px":b);fco(a[fcD],typeof c=="number"?fcl[fct](c)+"px":c)},
fc0b=function(a){var b=fc$a&&!fcjb("10");if((fcZb(a,"display")||(a.currentStyle?a.currentStyle[fcya]:fcc)||a[fcD][fcya])!="none")return b?new fc_(a[fcla]||a.clientWidth,a[fcza]||a.clientHeight):new fc_(a[fcla],a[fcza]);var c=a[fcD],d=c[fcya],e=c.visibility,h=c.position;c.visibility="hidden";c.position="absolute";c.display="inline";if(b){b=a[fcla]||a.clientWidth;a=a[fcza]||a.clientHeight}else{b=a[fcla];a=a[fcza]}c.display=d;c.position=h;c.visibility=e;return new fc_(b,a)},fc1b={},fcYb=function(a){return fc1b[a]||
(fc1b[a]=fci(a)[fcv](/\-([a-z])/g,function(b,c){return c.toUpperCase()}))},fc2b=function(a,b){a[fcD].display=b?"":"none"};var fc3b={},fc4b={};var fc5b=function(a,b,c,d){b=b||"800";c=c||"550";d=d||"friendconnect";a=fcj.open(a,d,"menubar=no,toolbar=no,dialog=yes,location=yes,alwaysRaised=yes,width="+b+",height="+c+",resizable=yes,scrollbars=1,status=1");fcj.focus&&a&&a.focus()},fc6b=function(a,b){var c=fce[fcK][fcB]().communityId;fce.rpc[fcF](fcc,"signin",fcc,c,a,b)};fcW("goog.peoplesense.util.openPopup",fc5b);fcW("goog.peoplesense.util.finishSignIn",fc6b);var fc9b=function(a,b){var c=fc7b()+"/friendconnect/invite/friends",d=fch(shindig[fcva][fcxa]());fc8b(c,d,a,b)},fc8b=function(a,b,c,d){a+="?st="+b;if(c)a+="&customMessage="+fch(c);if(d)a+="&customInviteUrl="+fch(d);b=760;if(fcY)b+=25;fc5b(a,fci(b),"515","friendconnect_invite")};fcW("goog.peoplesense.util.invite",fc9b);fcW("goog.peoplesense.util.inviteFriends",fc8b);var fc$b=function(a){this.url=a};fc$b[fc].l=function(a,b){if(this.url[fcC]("?"+a+"=")>=0||this.url[fcC]("&"+a+"=")>=0)fca(new Error("duplicate: "+a));if(b===fcc||b===fcf)return this;var c=this.url[fcC]("?")>=0?"&":"?";this.url+=c+a+"="+fch(b);return this};fcda(fc$b[fc],function(){return this.url});var fc7b=function(){return fcj.friendconnect_serverBase},fcac=function(a,b,c,d,e,h,i){b=b||"800";c=c||"550";d=d||"friendconnect";h=h||fcd;fce.rpc[fcF](fcc,"openLightboxIframe",i,a,shindig[fcva][fcxa](),b,c,d,e,fcc,fcc,fcc,h)},fcbc=function(a,b){var c=fce[fcK][fcB]().psinvite||"",d=new fc$b(fc7b()+"/friendconnect/signin/home");d.l("st",fcj.shindig[fcva][fcxa]());d.l("psinvite",c);d.l("iframeId",a);d.l("loginProvider",b);d.l("subscribeOnSignin","1");fc5b(d[fcga]());return fcd},fccc=function(){var a=
fce[fcK][fcB]().communityId;fce.rpc[fcF](fcc,"signout",fcc,a)},fcec=function(a,b){var c=fc7b()+"/friendconnect/settings/edit?st="+fch(shindig[fcva][fcxa]())+(a?"&iframeId="+fch(a):"");if(b)c=c+"&"+b;fcdc(c)},fcfc=function(a){a=fc7b()+"/friendconnect/settings/siteProfile?st="+fch(a);fcdc(a)},fcdc=function(a){var b=800,c=510;if(fcY)b+=25;fc5b(a,fci(b),fci(c))},fcgc=function(a,b,c,d){d=d||2;var e=fcc;if(b=="text"){e=fc0("div",{"class":"gfc-button-text"},fc0("div",{"class":"gfc-icon"},fc0("a",{href:"javascript:void(0);"},
c)));a[fcp](e)}else if(b=="long"||b=="standard"){e=d==1?fc0("div",{"class":"gfc-inline-block gfc-primaryactionbutton gfc-button-base"},fc0("div",{"class":"gfc-inline-block gfc-button-base-outer-box"},fc0("div",{"class":"gfc-inline-block gfc-button-base-inner-box"},fc0("div",{"class":"gfc-button-base-pos"},fc0("div",{"class":"gfc-button-base-top-shadow",innerHTML:"&nbsp;"}),fc0("div",{"class":"gfc-button-base-content"},fc0("div",{"class":"gfc-icon"},c)))))):fc0("table",{"class":"gfc-button-base-v2 gfc-button",
cellpadding:"0",cellspacing:"0"},fc0("tbody",{"class":""},fc0("tr",{"class":""},fc0("td",{"class":"gfc-button-base-v2 gfc-button-1"}),fc0("td",{"class":"gfc-button-base-v2 gfc-button-2"},c),fc0("td",{"class":"gfc-button-base-v2 gfc-button-3"}))));a[fcp](e);if(b=="standard"){b=fc0("div",{"class":"gfc-footer-msg"},"with Google Friend Connect");d==1&&a[fcp](fc0("br"));a[fcp](b)}}return e},fchc=function(a,b){if(!a)fca("google.friendconnect.renderSignInButton: missing options");var c=a[fcD]||"standard",
d=a.text,e=a.version;if(c=="standard")d=a.text||"Sign in";else if(c=="text"||c=="long")d=a.text||"Sign in with Friend Connect";var h=a.element;if(!h){h=a.id;if(!h)fca("google.friendconnect.renderSignInButton: options[id] and options[element] == null");h=fcEb(h);if(!h)fca("google.friendconnect.renderSignInButton: element "+a.id+" not found")}fcn(h,"");c=fcgc(h,c,d,e);fcj[fcqa]?c[fcqa]("click",b,fcd):c.attachEvent("onclick",b)},fcic=function(a,b){b=b||fcV(fcbc,fcc,fcc,fcc,fcc);fchc(a,b)},fcjc=function(a,
b){fce.rpc[fcF](fcc,"putReloadViewParam",fcc,a,b);var c=fce.views.getParams();c[a]=b},fckc=function(a,b){var c=new fc$b("/friendconnect/gadgetshare/friends");c.l("customMessage",a);c.l("customInviteUrl",b);c.l("container","glb");var d=310;if(fcY)d+=25;fcac(c[fcga](),fci(d),"370")};fcW("goog.peoplesense.util.getBaseUrl",fc7b);fcW("goog.peoplesense.util.finishSignIn",fc6b);fcW("goog.peoplesense.util.signout",fccc);fcW("goog.peoplesense.util.signin",fcbc);fcW("goog.peoplesense.util.editSettings",fcec);
fcW("goog.peoplesense.util.editSSProfile",fcfc);fcW("goog.peoplesense.util.setStickyViewParamToken",fcjc);fcW("google.friendconnect.renderSignInButton",fcic);fcW("goog.peoplesense.util.share",fckc);fcW("goog.peoplesense.util.userAgent.IE",fcY);var fclc={},fcmc={},fc2=function(a){this.h=new fc1;this.snippetId=a.id;this.site=a.site;a=a["view-params"];var b=a.skin;this.bc=(b?b.POSITION:"top")||"top";this.Cc={allowAnonymousPost:a.allowAnonymousPost||fcd,scope:a.scope||"SITE",docId:a.docId||"",features:a.features||"video,comment",startMaximized:"true",disableMinMax:"true",skin:b};this.absoluteBottom=fcY&&!fcjb("7");this.fixedIeSizes=fcY;fcj[fcqa]?fcj[fcqa]("resize",fcV(this.$a,this),fcd):fcj.attachEvent("onresize",fcV(this.$a,this));this.ob()};
fc2[fc].ob=function(){if(!this.site)fca(new Error("Must supply site ID."));if(!this.snippetId)fca(new Error("Must supply a snippet ID."))};fc2[fc].b=10;fc2[fc].za=1;fc2[fc].p="fc-friendbar-";fc2[fc].t=fc2[fc].p+"outer";fc2[fc].cb=fc2[fc].t+"-shadow";fc2[fc].render=function(){fck.write(this.xb());var a=fcDb(this.snippetId);fcn(a,this.N())};fc2[fc].yb=function(){var a=fcDb(this.t);return a=fc0b(a)[fcs]};
fc2[fc].$a=function(){for(var a=this.h.P(),b=0;b<a[fcr];b++)this.nc(a[b]);goog&&fc3b&&fc4b&&fcnc&&fcoc("resize")};fc2[fc].n=function(){return this.bc};fc2[fc].d=function(a){return this.p+"shadow-"+a};fc2[fc].ha=function(a){return this.p+"menus-"+a};fc2[fc].Q=function(a){return this.p+a+"Target"};fc2[fc].fa=function(a){return this.p+a+"Drawer"};fc2[fc].Pa=function(){return this.Q("")};fc2[fc].Qa=function(){return this.p+"wallpaper"};fc2[fc].La=function(){return this.fa("")};
fc2[fc].xb=function(){var a=fcj.friendconnect_imageUrl+"/",b=a+"shadow_tc.png",c=a+"shadow_bc.png",d=a+"shadow_bl.png",e=a+"shadow_tl.png",h=a+"shadow_tr.png",i=a+"shadow_br.png";a=a+"shadow_cr.png";var j=function(m,n){return fcY?'filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+m+'", sizingMethod="scale");':"background-image: url("+m+");background-repeat: "+n+"; "},k="position:absolute; top:";if(this.n()!="top"){k="position:fixed; bottom:";if(this.absoluteBottom)k="position:absolute; bottom:"}var l=
c;if(this.n()!="top")l=b;var g=0,f=[];f[g++]='<style type="text/css">';if(this.n()!="top"&&this.absoluteBottom)f[g++]="html, body {height: 100%; overflow: auto; };";f[g++]="#"+this.t+" {";f[g++]="background:#E0ECFF;";f[g++]="left:0;";f[g++]="height: "+(fcY?"35px;":"36px;");if(this.n()!="top"&&this.absoluteBottom)f[g++]="margin-right: 20px;";f[g++]="padding:0;";f[g++]=k+" 0;";f[g++]="width:100%;";f[g++]="z-index:5000;";f[g++]="}";f[g++]="#"+this.cb+" {";f[g++]=j(l,"repeat-x");f[g++]="left:0;";f[g++]=
"height:"+this.b+"px;";if(this.n()!="top"&&this.absoluteBottom)f[g++]="margin-right: 20px;";f[g++]="padding:0;";f[g++]=k+(fcY?"35px;":"36px;");f[g++]="width:100%;";f[g++]="z-index:4998;";f[g++]="}";f[g++]="."+this.La()+" {";f[g++]="display: block;";f[g++]="padding:0;";f[g++]=k+(fcY?"34px;":"35px;");f[g++]="z-index:4999;";f[g++]="}";f[g++]="."+this.Qa()+" {";f[g++]="background: white;";f[g++]="height: 100%;";f[g++]="margin-right: "+this.b+"px;";f[g++]="}";f[g++]="."+this.Pa()+" {";f[g++]="border: "+
this.za+"px solid #ccc;";f[g++]="height: 100%;";f[g++]="left: 0;";f[g++]="background-image: url("+fcj.friendconnect_imageUrl+"/loading.gif);";f[g++]="background-position: center;";f[g++]="background-repeat: no-repeat;";f[g++]="}";f[g++]="."+this.d("cr")+" {";f[g++]=j(a,"repeat-y");f[g++]="height: 100%;";f[g++]="position:absolute;";f[g++]="right: 0;";f[g++]="top: 0;";f[g++]="width:"+this.b+"px;";f[g++]="}";f[g++]="."+this.d("bl")+" {";f[g++]=j(d,"no-repeat");f[g++]="height: "+this.b+"px;";f[g++]="position:absolute;";
f[g++]="width:"+this.b+"px;";f[g++]="}";f[g++]="."+this.d("tl")+" {";f[g++]=j(e,"no-repeat");f[g++]="height: "+this.b+"px;";f[g++]="position:absolute;";f[g++]="left:0px;";f[g++]="width:"+this.b+"px;";f[g++]="}";f[g++]="."+this.d("bc")+" {";f[g++]=j(c,"repeat-x");f[g++]="height: "+this.b+"px;";f[g++]="left: "+this.b+"px;";f[g++]="position:absolute;";f[g++]="right: "+this.b+"px;";f[g++]="}";f[g++]="."+this.d("tc")+" {";f[g++]=j(b,"repeat-x");f[g++]="height: "+this.b+"px;";f[g++]="left: "+this.b+"px;";
f[g++]="margin-left: "+this.b+"px;";f[g++]="margin-right: "+this.b+"px;";f[g++]="right: "+this.b+"px;";f[g++]="}";f[g++]="."+this.d("br")+" {";f[g++]=j(i,"no-repeat");f[g++]="height: "+this.b+"px;";f[g++]="position:absolute;";f[g++]="right: 0;";f[g++]="width: "+this.b+"px;";f[g++]="}";f[g++]="."+this.d("tr")+" {";f[g++]=j(h,"no-repeat");f[g++]="height: "+this.b+"px;";f[g++]="position:absolute;";f[g++]="right: 0;";f[g++]="top: 0;";f[g++]="width: "+this.b+"px;";f[g++]="}";f[g++]="</style>";return f[fcQ]("")};
fc2[fc].N=function(){var a=['<div id="'+this.t+'"></div>','<div id="'+this.cb+'"></div>','<div id="'+this.ha(this.h.Ka())+'"></div>'];return a[fcQ]("")};fc2[fc].rb=function(a,b,c,d){if(!this.h.qb(a)){b=new fc3(this,a,b,c,d);c=this.h.Ka();d=fcDb(this.ha(c));fcn(d,b.N()+'<div id="'+this.ha(c+1)+'"></div>');this.h.set(a,b)}};fc2[fc].la=function(a){(a=this.h.get(a))&&a.drawer&&fc2b(a.drawer,fcd)};fc2[fc].dc=function(a){if(a=this.h.get(a))a.rendered=fcd};
fc2[fc].refresh=function(){for(var a=this.h.P(),b=0;b<a[fcr];b++){var c=a[b];this.la(c);this.dc(c)}};fc2[fc].Yb=function(a){for(var b=this.h.ja(),c=0;c<b[fcr];c++){var d=b[c];if(d.id==a){d.zc();break}}};fc2[fc].Xb=function(a){for(var b=this.h.ja(),c=0;c<b[fcr];c++){var d=b[c];if(d.id==a){d.Ub();break}}};fc2[fc].nc=function(a){if((a=this.h.get(a))&&a.drawer&&a.na()){a.da();a.Ha();a.ya()}};
fc2[fc].yc=function(a,b){var c=this.h.get(a);if(c){if(!c.drawer){c.drawer=fcDb(this.fa(c[fcM]));c.target=fcDb(this.Q(c[fcM]));c.sha_bc=fcFb(fck,"div",this.n()=="top"?this.d("bc"):this.d("tc"),c.drawer)[0];c.sha_cr=fcFb(fck,"div",this.d("cr"),c.drawer)[0]}for(var d=this.h.P(),e=0;e<d[fcr];e++){var h=d[e];a!==h&&this.la(h)}c.da(b);fc2b(c.drawer,fcb);fcj.setTimeout(function(){c.ya();c.Ha();c.render()},0)}};
var fc3=function(a,b,c,d,e){this.id=-1;this.bar=a;this.name=b;this.constraints=d;this.skin=e||{};fco(this,this.skin.HEIGHT||"0");this.url=fcj.friendconnect_serverBase+c;this.sha_bc=this.target=this.drawer=fcc;this.loaded=this.rendered=fcd;this.da()};
fc3[fc].da=function(a){fczb(this.constraints,a||{});fczb(this.skin,this.constraints);if(this.bar.fixedIeSizes&&this.constraints[fcE]&&this.constraints[fcR]){a=this.bar.yb();var b=this.constraints[fcE],c=this.constraints[fcR];a=a-(b+c);if(a%2){a-=1;this.skin.right+=1}fcm(this.skin,a);delete this.skin[fcE]}};
fc3[fc].ya=function(){if(this.drawer){if(this.skin[fcs]){var a=this.bar.za,b=this.bar.b,c=fcY?2:0;fc_b(this.target,this.skin[fcs],"");fc_b(this.sha_bc,this.skin[fcs]-b+2*a-c,"");this.skin.rightShadow?fc_b(this.drawer,this.skin[fcs]+b+2*a-c,""):fc_b(this.drawer,this.skin[fcs]+2*a-c,"")}if(this.skin[fcR])this.drawer[fcD].right=this.skin[fcR]+0+"px"}};
fc3[fc].Ha=function(){if(fcY&&this.drawer){var a=fc0b(this.target),b=a[fcs]-this.bar.b;a=a[fcO];if(b<0)b=0;this.sha_bc&&this.sha_bc[fcD]&&fc_b(this.sha_bc,b,"");this.sha_cr&&this.sha_cr[fcD]&&fc_b(this.sha_cr,"",a)}};
fc3[fc].N=function(){var a="display:none;",b="position: relative; ",c="",d="",e="",h="",i=!!this.skin.rightShadow;if(!i){c+="display: none; ";e+="display: none; ";d+="right: 0px; ";h+="margin-right: 0px; "}for(var j in this.skin){var k=Number(this.skin[j]);if(i&&fcQa(j,"width")==0)k+=this.bar.b;if(fcQa(j,"height")==0)b+=j+": "+k+"px; ";if(j!="rightShadow"){if(fcQa(j,"height")==0)k+=this.bar.b;if(fcQa(j,"width")==0)k+=2;a+=j+": "+k+"px; "}if(fcY&&fcQa(j,"width")==0){k-=i?2*this.bar.b:this.bar.b;d+=
j+": "+k+"px; "}}if(fcY&&(this[fcO]|0)>0){i=(this[fcO]|0)+2;c+="height: "+i+"px; "}i=0;j=[];j[i++]='<div id="'+this.bar.fa(this[fcM])+'"class="'+this.bar.La()+'"style="'+a+'"> ';if(this.bar.n()=="bottom")j[i++]='<div class="'+this.bar.d("tl")+'"></div> <div class="'+this.bar.d("tc")+'"style="'+d+'"></div> <div class="'+this.bar.d("tr")+'"style="'+e+'"></div> ';j[i++]='<div style="'+b+'"> <div class="'+this.bar.Qa()+'"style="'+h+'"><div id="'+this.bar.Q(this[fcM])+'"class="'+this.bar.Pa()+'"></div> <div class="'+
this.bar.d("cr")+'"style="'+c+'"></div> </div> </div> ';if(this.bar.n()=="top")j[i++]='<div class="'+this.bar.d("bl")+'"></div> <div class="'+this.bar.d("bc")+'"style="'+d+'"></div> <div class="'+this.bar.d("br")+'"style="'+e+'"></div> ';j[i++]="</div> ";return j[fcQ]("")};fc3[fc].zc=function(){this.rendered=this.na()};fc3[fc].Ub=function(){this.loaded=this.na()};fc3[fc].na=function(){return!!this.drawer&&this.drawer[fcD][fcya]!="none"};
fc3[fc].render=function(){if(this.rendered==fcd){var a={};a.url=this.url;a.id=this.bar.Q(this[fcM]);a.site=this.bar.site;a["view-params"]=fcU(this.bar.Cc);if(this[fcM]=="profile")a["view-params"].profileId="VIEWER";this.skin&&fczb(a["view-params"].skin,this.skin);a["view-params"].menuName=this[fcM];a["view-params"].opaque="true";a["view-params"].menuPosition=this.bar.bc;fco(a,"1px");if(fclc&&fcmc&&fc4)this.id=fc4.render(a)}};fcW("google.friendconnect.FriendBar",fc2);var fcpc="0123456789abcdefghijklmnopqrstuv",fcrc=function(a){a=new fcqc(a);if(a.pa()%5)fca(Error());for(var b=[],c=0;a.pa()>0;c++)b[c]=fcpc[fcz](a.$b(5));return b[fcQ]("")},fcqc=function(a){this.D=this.r=0;this.ca=a};fcqc[fc].pa=function(){return 8*(this.ca[fcr]-this.D)-this.r};
fcqc[fc].$b=function(a){var b=0;if(a>this.pa())fca(Error());if(this.r>0){b=255>>this.r&this.ca[this.D];var c=8-this.r,d=fcl.min(a%8,c);c=c-d;b=b>>c;a-=d;this.r+=d;if(this.r==8){this.r=0;this.D++}}for(;a>=8;){b<<=8;b|=this.ca[this.D];this.D++;a-=8}if(a>0){b<<=a;b|=this.ca[this.D]>>8-a;this.r=a}return b};var fcsc=function(){};fcsc[fc].F=function(){};fcsc[fc].I=function(){};var fctc=(new Date).getTime(),fc5=function(){},fcuc=function(){},fcvc=function(){},fcwc=function(){};fcX(fcwc,fcvc);var fcxc=function(a){if(a)for(var b in a)if(a.hasOwnProperty(b))this[b]=a[b];if(this.viewParams)for(var c in this.viewParams)if(/^FC_RELOAD_.*$/[fcja](c))this.viewParams[c]=fcc};fcxc[fc].render=function(a){var b=this;if(a){b.Ac();this.Ab(function(c){fcXb(a,"visibility","hidden");fcn(a,c);b.refresh(a,c);c=function(d){fcXb(d,"visibility","visible")};c=fcGa(c,a);fcba(c,500);b.chrome=a})}};
fcxc[fc].Ab=function(a){return this.Gb(a)};var fc6=function(a){fcxc[fcF](this,a);this.U="../../";this.rpcToken=fci(fcl[fct](2147483647*fcl[fcoa]()))};fcX(fc6,fcxc);fc6[fc].hb="gfc_iframe_";fc6[fc].ib="friendconnect";fc6[fc].Ia="";fc6[fc].oc="rpc_relay.html";fc6[fc].X=function(a){this.U=a};fc6[fc].Ac=function(){return this.Ia=fci(fcl[fct](2147483647*fcl[fcoa]()))};fc6[fc].ga=function(){return this.hb+this.Ia+"_"+this.id};
fc6[fc].refresh=function(a,b){var c=fc4.Fc,d,e={},h=fc4.Ja(this.communityId),i=h[fcx]("~"),j=fc4.sb;if(j&&i[fcr]>1){d=i[2];i=i[1];var k=[this.specUrl,this.communityId,i,j][fcQ](":");e.sig=fc4.hash(d,k);e.userId=i;e.dateStamp=j}e.container=this.ib;e.mid=this.id;e.nocache=fc4.ac;e.view=this.Z;e.parent=fc4.S;if(this.debug)e.debug="1";if(this.specUrl)e.url=this.specUrl;if(this.communityId){j=fce[fcK][fcB]().profileId;e.communityId=this.communityId;if(d=fce[fcK][fcB]().psinvite)e.psinvite=d;if(j)e.profileId=
j}e.caller=fcyc();e.rpctoken=this.rpcToken;j=fcd;d="";i=/Version\/3\..*Safari/;if((i=fcbb&&fc7a()[fcG](i))||!fc4.R[this.specUrl]&&this.viewParams){e["view-params"]=fce[fcpa][fcia](this.viewParams);d="?viewParams="+fch(e["view-params"]);j=fcb}if(this.prefs)e.prefs=fce[fcpa][fcia](this.prefs);if(this.viewParams&&this.sendViewParamsToServer)e["view-params"]=fce[fcpa][fcia](this.viewParams);if(this.locale)e.locale=this.locale;if(this.secureToken)e.st=this.secureToken;i=fc4.Oa(this.specUrl);d=i+"ifr"+
d+(this.hashData?"&"+this.hashData:"");if(fc4.Ec!=1||j||h||this.secureToken){if(h&&!e.sig)e.fcauth=h}else e.sig||(c="get");h=this.ga();fczc(h,d,c,e,a,b,this.rpcToken)};var fc7=function(){this.j={};this.S="http://"+fck[fcA].host;this.Z="default";this.ac=1;this.Jc=0;this.Gc="US";this.Hc="en";this.Ic=2147483647};fcX(fc7,fcuc);fc7[fc].v=fcxc;fc7[fc].A=new fcwc;fc7[fc].bb=function(a){this.ac=a};fc7[fc].Ga=function(a){this.Ec=a};fc7[fc].Na=function(a){return"gadget_"+a};fc7[fc].w=function(a){return this.j[this.Na(a)]};
fc7[fc].M=function(a){return new this.v(a)};fc7[fc].kb=function(a){a.id=this.Hb();this.j[this.Na(a.id)]=a};fc7[fc].Zb=0;fc7[fc].Hb=function(){return this.Zb++};var fcBc=function(){fc7[fcF](this);this.A=new fcAc};fcX(fcBc,fc7);fcBc[fc].v=fc6;fcBc[fc].W=function(a){a[fcG](/^http[s]?:\/\//)||(a=fck[fcA][fcsa][fcG](/^[^?#]+\//)[0]+a);this.S=a};fcBc[fc].H=function(a){var b=this.A.Ma(a);a.render(b)};var fcAc=function(){this.wb={}};fcX(fcAc,fcvc);
fcAc[fc].lb=function(a,b){this.wb[a]=b;var c=fck[fcy](b).className;if(!c&&c[fcr]==0)fcfa(fck[fcy](b),"gadgets-gadget-container")};fcAc[fc].Ma=function(a){return(a=this.wb[a.id])?fck[fcy](a):fcc};var fc8=function(a){fc6[fcF](this,a);a=a||{};this.Z=a.view||"profile"};fcX(fc8,fc6);fc8[fc].nb="canvas.html";fc8[fc].ub="/friendconnect/embed/";
var fcyc=function(){var a=fce[fcK][fcB]().canvas=="1"||fce[fcK][fcB]().embed=="1",b=fcc;if(a)b=fce[fcK][fcB]().caller;if(!b){a=fck[fcA];b=a.search[fcv](/([&?]?)psinvite=[^&]*(&?)/,function(c,d,e){return e?d:""});b=a.protocol+"//"+a.hostname+(a.port?":"+a.port:"")+a.pathname+b}return b};fc8[fc].wc=function(a){this.Z=a};fc8[fc].ka=function(){return this.Z};fc8[fc].getBodyId=function(){return this.ga()+"_body"};
fc8[fc].Gb=function(a){var b=this.specUrl;if(b===fcf)b="";b=(fc4.Oa(b)||this.U)+this.oc;var c=this.ga();fce.rpc.setRelayUrl(c,b);b='<div id="'+this.getBodyId()+'"><iframe id="'+c+'" name="'+c;b+=this[fcO]==0?'" style="width:1px; height:1px;':'" style="width:100%;';if(this.viewParams.opaque)b+="background-color:white;";b+='"';b+=' frameborder="0" scrolling="no"';this.viewParams.opaque||(b+=' allowtransparency="true"');b+=this[fcO]?' height="'+this[fcO]+'"':"";b+=this[fcs]?' width="'+this[fcs]+'"':
"";b+="></iframe>";if(this.showEmbedThis)b+='<a href="javascript:void(0);" onclick="google.friendconnect.container.showEmbedDialog(\''+this.divId+"'); return false;\">Embed this</a>";b+="</div>";a(b)};
fc8[fc].zb=function(){var a=fcyc();a="canvas=1&caller="+fch(a);var b=fce[fcK][fcB]().psinvite;if(b)a+="&psinvite="+fch(b);a+="&site="+fch(this.communityId);b=fcU(this.viewParams);if(b.skin!=fcc)for(var c=["BG_IMAGE","BG_COLOR","FONT_COLOR","BG_POSITION","BG_REPEAT","ANCHOR_COLOR","FONT_FACE","BORDER_COLOR","CONTENT_BG_COLOR","CONTENT_HEADLINE_COLOR","CONTENT_LINK_COLOR","CONTENT_SECONDARY_TEXT_COLOR","CONTENT_SECONDARY_LINK_COLOR","CONTENT_TEXT_COLOR","ENDCAP_BG_COLOR","ENDCAP_LINK_COLOR","ENDCAP_TEXT_COLOR",
"CONTENT_VISITED_LINK_COLOR","ALTERNATE_BG_COLOR"],d=0;d<c[fcr];d++)delete b.skin[c[d]];b=fch(fce[fcpa][fcia](b));b=b[fcv]("\\","%5C");return fc4.S+this.nb+"?url="+fch(this.specUrl)+(a?"&"+a:"")+"&view-params="+b};fc8[fc].C=function(a){a=a||fcg+this.ub+this.communityId;return this.Bb(a,"embed=1")};fc8[fc].B=function(a){return'<iframe src="'+this.C(a)+'" style="height:500px" scrolling="no" allowtransparency="true" border="0" frameborder="0" ></iframe>'};
fc8[fc].Bb=function(a,b){var c=fch(fce[fcpa][fcia](this.viewParams));c=c[fcv]("\\","%5C");return a+"?url="+fch(this.specUrl)+(b?"&"+b:"")+"&view-params="+c};fc8[fc].Kb=function(){var a=fce[fcK][fcB]().canvas=="1"||fce[fcK][fcB]().embed=="1",b=fcc;if(a)(b=fce[fcK][fcB]().caller)||(b="javascript:history.go(-1)");return b};fc8[fc].Lb=function(a){var b=fcc;if(a=="canvas")b=this.zb();else if(a=="profile")b=this.Kb();return b};
var fc9=function(){fcBc[fcF](this);fce.rpc[fcP]("signin",fc5[fc].signin);fce.rpc[fcP]("signout",fc5[fc].signout);fce.rpc[fcP]("resize_iframe",fc5[fc].ab);fce.rpc[fcP]("set_title",fc5[fc].setTitle);fce.rpc[fcP]("requestNavigateTo",fc5[fc].Za);fce.rpc[fcP]("api_loaded",fc5[fc].xa);fce.rpc[fcP]("createFriendBarMenu",fc5[fc].Ca);fce.rpc[fcP]("showFriendBarMenu",fc5[fc].db);fce.rpc[fcP]("hideFriendBarMenu",fc5[fc].Ra);fce.rpc[fcP]("putReloadViewParam",fc5[fc].Va);fce.rpc[fcP]("getViewParams",fc5[fc].Fa);
fce.rpc[fcP]("getContainerBaseTime",fc5[fc].Ea);fce.rpc[fcP]("openLightboxIframe",fc5[fc].Ua);fce.rpc[fcP]("showMemberProfile",fc5[fc].fb);fce.rpc[fcP]("closeLightboxIframe",fcV(this.u,this));fce.rpc[fcP]("setLightboxIframeTitle",fcV(this.sc,this));fce.rpc[fcP]("refreshAndCloseIframeLightbox",fcV(this.cc,this));var a=fcCc;a[fcP]();a.gb(this,"load",this.Nb);a.gb(this,"start",this.Ob);this.U="../../";this.W("");this.bb(0);this.Ga(1);this.oa=fcc;this.apiVersion="0.8";this.openSocialSecurityToken=fcc;
this.V="";this.Da={};this.Tb=fcc;this.Sb=fcd;this.sb=this.Wb=this.lastIframeLightboxOpenArguments=this.lastLightboxCallback=this.lastLightboxDialog=fcc;this.Fc="post"};fcX(fc9,fcBc);fc9[fc].qc=function(a){this.sb=a};fc9[fc].v=fc8;fc9[fc].R={};fc9[fc].uc=function(a){this.oa=a};fc9[fc].Oa=function(a){var b=fc9[fc].R[a];if(!b)if(this.oa[fcC]("http://")!==0){a=this.pb(a);b=["http://",a,this.oa][fcQ]("")}else b=this.oa;return b};
fc9[fc].pb=function(a){var b=new SHA1;a=fcIa(a);b.update(a);b=b.digest();return b=fcrc(b)};
var fcDc=function(a,b){var c=b?b:fcj.top,d=c.frames;try{if(c.frameElement.id==a)return c}catch(e){}for(c=0;c<d[fcr];++c){var h=fcDc(a,d[c]);if(h)return h}return fcc},fczc=function(a,b,c,d,e,h,i){var j="gfc_load_"+a;b='<html><head><style type="text/css">body {background:transparent;}</style>'+(fcY?'<script type="text/javascript">window.goback=function(){history.go(-1);};setTimeout("goback();", 0);<\/script>':"")+"</head><body><form onsubmit='window.goback=function(){};return false;' style='margin:0;padding:0;' id='"+
j+"' method='"+c+"' ' action='"+fce[fcK].escapeString(b)+"'>";for(var k in d)b+="<input type='hidden' name='"+k+"' value='' >";b+="</form></body></html>";c=fcDc(a);var l;try{l=c[fcw]||c.contentWindow[fcw]}catch(g){if(e&&h){fcn(e,"");fcn(e,h);c=fcDc(a);l=c[fcw]||c.contentWindow[fcw]}}i&&fce.rpc.setAuthToken(a,i);l.open();l.write(b);l.close();a=l[fcy](j);for(k in d)a[k].value=d[k];fcY&&a.onsubmit();a.submit()};
fc9[fc].vb=function(){var a=fce[fcK][fcB]().fcsite,b=fce[fcK][fcB]().fcprofile;a&&b&&fc4.I(b,a)};fc9[fc].rc=function(a,b){this.R[a]=b};fc9[fc].T=function(){var a=/Version\/3\..*Safari/;if(a=fcbb&&fc7a()[fcG](a))fck[fcA].reload();else{fc4.g!=fcc&&fc4.g.refresh();for(var b in fc4.j){a=fc4.j[b];this.H(a)}if(this.lastIframeLightboxOpenArguments!=fcc){b=this.lastIframeLightboxOpenArguments;this.u();this.F[fcL](this,b)}}};
fc9[fc].W=function(a){a[fcG](/^http[s]?:\/\//)||(a=a&&a[fcr]>0&&a.substring(0,1)=="/"?fck[fcA][fcsa][fcG](/^http[s]?:\/\/[^\/]+\//)[0]+a.substring(1):fck[fcA][fcsa][fcG](/^[^?#]+\//)[0]+a);this.S=a};fc9[fc].ea=function(a){return"fcauth"+a};fc9[fc].ia=function(a){return"fcauth"+a+"-s"};fc9[fc].hash=function(a,b){var c=new SHA1,d=fcPa(a,fcb);c=new G_HMAC(c,d,64);d=fcIa(b);c=c.Fb(d);(new Date).getTime();return fcOa(c,fcb)};
fc9[fc].Ja=function(a){return a=fcmb(this.ea(a))||fcmb(this.ia(a))||this.Da[a]||""};fc9[fc].X=function(a){this.U=a};fc9[fc].vc=function(a){this.V=a};fc9[fc].M=function(a){a=new this.v(a);a.X(this.U);return a};fc9[fc].ka=function(){return this.Z};fc9[fc].tc=function(a){this.Wb=a};var fc$=function(a){return(a=a[fcG](/_([0-9]+)$/))?fcaa(a[1],10):fcc};
fc9[fc].Y=function(a,b,c,d,e,h){if(!this.Dc){this.$(fcj.friendconnect_serverBase+"/friendconnect/styles/container.css?d="+this.V);this.Dc=fcb}var i=fcEc(d);if(this.Tb!=(i?"rtl":"ltr")){this.$(fcj.friendconnect_serverBase+"/friendconnect/styles/lightbox"+(i?"-rtl":"")+".css?d="+this.V);this.Tb=i?"rtl":"ltr"}if(!this.Sb){this.mb(fcj.friendconnect_serverBase+"/friendconnect/script/lightbox.js?d="+this.V);this.Sb=fcb}b=b||0;if(goog.ui&&goog.ui[fcma]){this.u();b=new goog.ui[fcma]("lightbox-dialog",fcb);
var j=this;goog.events.listen(b,goog.ui[fcma].EventType.AFTER_HIDE,function(){j.lastLightboxCallback&&j.lastLightboxCallback();j.Ba()});b.setDraggable(fcb);b.setDisposeOnHide(fcb);b.setBackgroundElementOpacity(0.5);b.setButtonSet(new goog.ui[fcma].ButtonSet);this.lastLightboxDialog=b;this.lastLightboxCallback=c||fcc;c=b.getDialogElement();e=e||702;fcXb(c,"width",fci(e)+"px");h&&fcXb(c,"height",fci(h)+"px");a(b);b.getDialogElement()[fcD].direction=i?"rtl":"ltr"}else if(b<5){b++;a=fcV(this.Y,this,a,
b,c,d,e,h);fcba(a,1E3)}else{this.Ba();fca(Error("lightbox.js failed to load"))}};fc9[fc].u=function(a){var b=this.lastLightboxDialog,c=this.lastLightboxCallback;this.lastLightboxCallback=fcc;if(b!=fcc){this.lastLightboxDialog.dispatchEvent(goog.ui[fcma].EventType.AFTER_HIDE);b.dispose();c!=fcc&&c(a)}};fc9[fc].Ba=function(){this.lastIframeLightboxOpenArguments=this.lastLightboxCallback=this.lastLightboxDialog=fcc};fc9[fc].sc=function(a){this.lastLightboxDialog&&this.lastLightboxDialog.setTitle(a)};
fc9[fc].cc=function(){this.u();this.T()};fc5[fc].Za=function(a,b){var c=fc$(this.f);c=fc4.w(c);var d=fcU(c.originalParams);if(b){d["view-params"]=d["view-params"]||{};d["view-params"]=b}d.locale=c.locale;if(c.useLightBoxForCanvas){d.presentation=a;fc4.lastLightboxDialog!=fcc?fc4.u():fc4.eb(d)}else if((c=c.Lb(a))&&fck[fcA][fcsa]!=c)if(fce[fcK][fcB]().embed=="1")try{fcj.parent.location=c}catch(e){fcj.top.location=c}else fck[fcA].href=c};
fc9[fc].eb=function(a,b){a=a||{};var c=a.locale,d=fcEc(c),e=this;this.u();this.Y(function(h){var i=fc0("div",{},fc0("div",{id:"gadget-signin",style:"background-color:#ffffff;height:32px;"}),fc0("div",{id:"gadget-lb-canvas",style:"background-color:#ffffff;"}));h.getTitleTextElement()[fcp](fc0("div",{id:"gfc-canvas-title",style:"color:#000000;"}));h.getContentElement()[fcp](i);h.setVisible(fcb);i=fcU(a);var j=fcIb(fcj),k=fcl[fct](j[fcO]*0.7);j={};j.BORDER_COLOR="#cccccc";j.ENDCAP_BG_COLOR="#e0ecff";
j.ENDCAP_TEXT_COLOR="#333333";j.ENDCAP_LINK_COLOR="#0000cc";j.ALTERNATE_BG_COLOR="#ffffff";j.CONTENT_BG_COLOR="#ffffff";j.CONTENT_LINK_COLOR="#0000cc";j.CONTENT_TEXT_COLOR="#333333";j.CONTENT_SECONDARY_LINK_COLOR="#7777cc";j.CONTENT_SECONDARY_TEXT_COLOR="#666666";j.CONTENT_HEADLINE_COLOR="#333333";i.id="gadget-lb-canvas";fco(i,fcl.min(498,k)+"px");i.maxHeight=k;if(i.keepMax){fco(i,k);fcXb(h.getContentElement(),"height",k+35+"px")}i["view-params"]=i["view-params"]||{};i["view-params"].opaque=fcb;i["view-params"].skin=
i["view-params"].skin||{};fcHa(i["view-params"].skin,j);e.render(i);k={};k.id="gadget-signin";k.presentation="canvas";k.site=i.site;k.titleDivId="gfc-canvas-title";k["view-params"]={};k["view-params"].opaque=fcb;k.keepMax=i.keepMax;if(i.securityToken)k.securityToken=i.securityToken;i=fcU(j);i.ALIGNMENT=d?"left":"right";e.Xa(k,i);h.reposition()},fcf,b,c)};fc5[fc].db=function(a,b){fc4.g!=fcc&&fc4.g.yc(a,b)};fc5[fc].Ra=function(a){fc4.g!=fcc&&fc4.g.la(a)};
fc5[fc].Ua=function(a,b,c,d,e,h,i,j,k,l){var g=this.f;a=a+(a[fcC]("?")>=0?"&":"?")+"iframeId="+g;fc4.F(a,b,c,d,e,h,i,j,k,l,this.callback)};
fc9[fc].F=function(a,b,c,d,e,h,i,j,k,l,g){var f=fcIb(fcj);d!=fcc||(d=fcl[fct](f[fcO]*0.7));c!=fcc||(c=fcl[fct](f[fcs]*0.7));var m=[];for(f=0;f<arguments[fcr]&&f<10;f++)m[fcq](arguments[f]);if(!a[0]=="/")fca(new Error("lightbox iframes must be relative to fc server"));var n=this,o=h?fcU(h):{},s=fci(fcl[fct](2147483647*fcl[fcoa]())),p="gfc_lbox_iframe_"+s;fce.rpc.setAuthToken(p,s);if(!b)b=fc4.openSocialSecurityToken;var t=fc4.openSocialSiteId;fc4.Y(function(q){n.lastIframeLightboxOpenArguments=m;var v=
"st="+fch(b)+"&parent="+fch(fc4.S)+"&rpctoken="+fch(s);if(!j){o.iframeId=p;o.iurl=a;a=fcg+"/friendconnect/lightbox"}var r=d-54;fco(o,r);var u='<iframe id="'+p;u+='" width="100%" height="'+r+'" frameborder="0" scrolling="auto"></iframe>';q.setContent(u);if(e){q.setTitle(e);if(l){r=q.getTitleTextElement();fcCb(r,"lightbox-dialog-title-small-text")}}q.setVisible(fcb);k||(o.fcauth=fc4.Ja(t));a+=(a[fcC]("?")>=0?"&":"?")+v+"&communityId="+t;fczc(p,a,"POST",o,fcc,fcc,fcc)},fcf,g,fcf,c,d)};
fc5[fc].Fa=function(){var a=fc$(this.f);a=fc4.w(a);return a.viewParams};fc5[fc].Ea=function(){return fctc};fc5[fc].Va=function(a,b){var c=fc$(this.f);c=fc4.w(c);c.viewParams[a]=b};fc9[fc].Nb=function(a,b){fc4.g!=fcc&&fc4.g.Xb(b)};fc9[fc].Ob=function(a,b){fc4.g!=fcc&&fc4.g.Yb(b)};fc5[fc].Ca=function(a,b,c,d){fc4.g!=fcc&&fc4.g.rb(a,b,c,d)};fc9[fc].H=function(a){var b=this.A.Ma(a);a.render(b);this.A.postProcessGadget&&this.A.postProcessGadget(a)};
fc5[fc].signout=function(a){fc4.Wa(fc4.ea(a));fc4.Wa(fc4.ia(a));fc4.Da={};fc4.T();return fcd};fc9[fc].Wa=function(a){var b=fck[fcA].pathname;b=b[fcx]("/");for(var c=0;c<b[fcr];c++){for(var d=new Array(c+1),e=0;e<c+1;e++)d[e]=b[e];fcnb(a,d[fcQ]("/")+"/")}};
fc5[fc].ab=function(a){var b=fck[fcy](this.f);if(b&&a>0)fco(b[fcD],a+"px");if((b=fck[fcy](this.f+"_body"))&&a>0)fco(b[fcD],a+"px");if(b=fc$(this.f)){var c=fc4.w(b);if(c){if((b=fck[fcy](c.divId))&&a>0){if(c&&c[fcta]&&c[fcta]<a){a=c[fcta];b[fcD].overflowY="auto"}fco(b[fcD],a+"px")}!c.keepMax&&c.ka()=="canvas"&&fc4.lastLightboxDialog&&fc4.lastLightboxDialog.reposition();fcXb(c.chrome,"visibility","visible")}}};
fc5[fc].setTitle=function(a){var b=fc$(this.f);b=fc4.w(b);if(b=b.titleDivId)fcn(fck[fcy](b),fce[fcK].escapeString(a))};fc5[fc].signin=function(a,b,c){fclb(fc4.ea(a),b,31104E3,c);fclb(fc4.ia(a),b,-1,c);fc4.Da[a]=b;fc4.T()};var fcGc=function(a){fchc(a,fcFc)};fc9[fc].ic=function(a,b){b&&this.m(b,a);var c={};c.url=fcg+"/friendconnect/gadgets/members.xml";this.render(this.s(a,c))};
fc9[fc].kc=function(a,b){b&&this.m(b,a);var c={};c.url=fcg+"/friendconnect/gadgets/review.xml";c["view-params"]={startMaximized:"true",disableMinMax:"true",features:"review"};this.render(this.s(a,c))};fc9[fc].ra=function(a,b){b&&this.m(b,a);var c={};c.url=fcg+"/friendconnect/gadgets/wall.xml";c["view-params"]={startMaximized:"true",disableMinMax:"true",features:"comment"};this.render(this.s(a,c))};
fc9[fc].Xa=function(a,b){b&&this.m(b,a);var c={};c.url=fcg+"/friendconnect/gadgets/signin.xml";fco(c,32);this.render(this.s(a,c))};fc9[fc].fc=function(a,b){b&&this.m(b,a);a.prefs=a.prefs||{};a.sendViewParamsToServer=fcb;a.prefs.hints=fcj.google_hints;var c={};c.url=fcg+"/friendconnect/gadgets/ads.xml";fco(c,90);this.render(this.s(a,c))};
fc9[fc].ua=function(a,b){if(a.id){b&&this.m(b,a);a["view-params"]=a["view-params"]||{};a["view-params"].opaque="true";this.g=new fc2(a);this.g.render();var c={};c.url=fcg+"/friendconnect/gadgets/friendbar.xml";a.id=this.g.t;fco(a,"1");this.render(this.s(a,c))}};fc9[fc].hc=fc9[fc].ua;fc9[fc].ta=function(a,b){a=a||{};a.url=fcg+"/friendconnect/gadgets/signin.xml";a.site=a.site||fce[fcK][fcB]().site;fco(a,32);this.sa(a,b)};fc9[fc].gc=fc9[fc].ta;fc9[fc].mc=fc9[fc].ra;
fc9[fc].m=function(a,b){var c=b["view-params"];if(!c){c={};b["view-params"]=c}c.skin=a};fc9[fc].s=function(a,b){var c=this.Ta(b,a);if(b["view-params"]){var d=b["view-params"];if(a["view-params"])d=this.Ta(d,a["view-params"]);c["view-params"]=d}return c};fc9[fc].jc=function(a,b){b&&this.m(b,a);this.render(a)};fc9[fc].Ta=function(a,b){var c={},d;for(d in b)c[d]=b[d];for(d in a)if(typeof c[d]=="undefined")c[d]=a[d];return c};
fc9[fc].render=function(a){this.openSocialSiteId=a.site;a["view-params"]=a["view-params"]||{};var b=this.M({divId:a.id,specUrl:a.url,communityId:a.site,height:a[fcO],locale:a.locale||this.Wb,secureToken:a.securityToken,titleDivId:a.titleDivId,showEmbedThis:a.showEmbedThis,useLightBoxForCanvas:a.useLightBoxForCanvas||typeof a.useLightBoxForCanvas=="undefined"&&fcj.friendconnect_lightbox,viewParams:a["view-params"],prefs:a.prefs,originalParams:a,debug:a.debug,maxHeight:a[fcta],sendViewParamsToServer:a.sendViewParamsToServer,
keepMax:a.keepMax});a.presentation&&b.wc(a.presentation);this.kb(b);this.A.lb(b.id,a.id);fcba(function(){fc4.H(b)},0);return b.id};fc9[fc].lc=function(a,b){a=a||{};a.presentation="canvas";this.Ya(a,b)};
fc9[fc].Ya=function(a,b,c){a=a||{};a.url=fce[fcK][fcB]().url;a.site=fce[fcK][fcB]().site||a.site;var d=fce[fcK][fcB]()["view-params"];if(d)a["view-params"]=fce[fcpa].parse(decodeURIComponent(d));if(c){a["view-params"]=a["view-params"]||{};a["view-params"].useFixedHeight=fcb;fco(a["view-params"],c);b=b||{};b.HEIGHT=fci(c)}this.sa(a,b)};fc9[fc].sa=function(a,b){a=a||{};b&&this.m(b,a);if(fce[fcK][fcB]().canvas=="1")a.presentation="canvas";else if(fce[fcK][fcB]().embed=="1")a.presentation="embed";fc4.render(a)};
fc9[fc].Mb=function(){var a=fce[fcK][fcB]().caller;if(a&&fck[fcA][fcsa]!=a&&a[fcr]>8&&(a.substr(0,7)[fcAa]()=="http://"||a.substr(0,8)[fcAa]()=="https://"))fck[fcA].href=a;else if(a=fce[fcK][fcB]().site)fck[fcA].href=fcg+"/friendconnect/directory/site?id="+a;else fcj.history.go(-1)};fc9[fc].G="";fc9[fc].Ib=function(){return this.G};fc9[fc].pc=function(a){this.apiVersion=a};fc9[fc].$=function(a){var b=fck[fcI]("link");b[fcJ]("rel","stylesheet");b[fcJ]("type","text/css");b[fcJ]("href",a);fck.getElementsByTagName("head")[0][fcp](b)};
fc9[fc].mb=function(a){var b=fck[fcI]("script");b[fcJ]("src",a);b[fcJ]("type","text/javascript");fck.getElementsByTagName("head")[0][fcp](b)};fc9[fc].Aa=function(a){if(fck[fcna])a();else fcj[fcqa]?fcj[fcqa]("load",a,fcd):fcj.attachEvent("onload",a)};
fc9[fc].ma=function(a){if(!a.site)fca("API not loaded, please pass in a 'site'");this.$(fcj.friendconnect_serverBase+"/friendconnect/styles/container.css?d="+this.V);this.openSocialSiteId=a.site;this.apiLoadedCallback=a.onload;this.Aa(fcV(this.Sa,this,a,"fc-opensocial-api"))};fc9[fc].Vb=fc9[fc].ma;fc9[fc].Pb=function(a){var b={};b.site=this.openSocialSiteId;b["view-params"]={txnId:a};this.Sa(b,"gfc-"+a)};
fc9[fc].ec=function(a){var b={};for(var c in this.j){var d=this.j[c];if(d.viewParams&&d.viewParams.txnId==a)break;else b[c]=d}this.j=b;(a=fck[fcy]("gfc-"+a))&&a[fcN]&&a[fcN].removeChild&&a[fcN].removeChild(a)};fc9[fc].Cb=function(){return"<Templates xmlns:fc='http://www.google.com/friendconnect/makeThisReal'>  <Namespace prefix='fc' url='http://www.google.com/friendconnect/makeThisReal'/>  <Template tag='fc:signIn'>    <div onAttach='google.friendconnect.renderSignInButton({element: this})'></div>  </Template></Templates>"};
fc9[fc].Jb=function(){return"<Templates xmlns:os='http://ns.opensocial.org/2008/markup'><Namespace prefix='os' url='http://ns.opensocial.org/2008/markup'/><Template tag='os:Name'>  <span if='${!My.person.profileUrl}'>${My.person.displayName}</span>  <a if='${My.person.profileUrl}' href='${My.person.profileUrl}'>      ${My.person.displayName}</a></Template><Template tag='os:Badge'>  <div><img if='${My.person.thumbnailUrl}' src='${My.person.thumbnailUrl}'/>   <os:Name person='${My.person}'/></div></Template><Template tag='os:PeopleSelector'>  <select onchange='google.friendconnect.PeopleSelectorOnChange(this)' name='${My.inputName}'          multiple='${My.multiple}' x-var='${My.var}' x-max='${My.max}'          x-onselect='${My.onselect}'>    <option repeat='${My.group}' value='${Cur.id}' selected='${Cur.id == My.selected}'>        ${Cur.displayName}    </option>  </select></Template></Templates>"};
var fcHc=function(a){var b;if(a.multiple){b=[];for(var c=0;c<a[fcH][fcr];c++)a[fcH][c].selected&&b[fcq](a[fcH][c].value);c=a.getAttribute("x-max");try{c=1*c}catch(d){c=0}if(c&&b[fcr]>c&&a["x-selected"]){b=a["x-selected"];for(c=0;c<a[fcH][fcr];c++){a[fcH][c].selected=fcd;for(var e=0;e<b[fcr];e++)if(a[fcH][c].value==b[e]){a[fcH][c].selected=fcb;break}}}}else b=a[fcH][a.selectedIndex].value;a["x-selected"]=b;(c=a.getAttribute("x-var"))&&fcj.opensocial[fcka]&&fcj.opensocial[fcka].getDataContext().putDataSet(c,
b);if(c=a.getAttribute("x-onselect"))if(fcj[c]&&typeof fcj[c]=="function")fcj[c](b);else if(a["x-onselect-fn"])a["x-onselect-fn"][fcL](a);else a["x-onselect-fn"]=new Function(c)};
fc9[fc].Sa=function(a,b){fcj.opensocial.template.Loader.loadContent(this.Jb());fcj.opensocial.template.Loader.loadContent(this.Cb());fcj.opensocial[fcka].processDocumentMarkup();var c=fck[fcI]("div");c.id=b;fco(c[fcD],"0px");fcm(c[fcD],"0px");c[fcD].position="absolute";c[fcD].visibility="hidden";fck[fcna][fcp](c);var d={};d.url=fcg+"/friendconnect/gadgets/osapi-"+this.apiVersion+".xml";fco(d,0);d.id=c.id;d.site=a.site;d["view-params"]=a["view-params"];this.render(d)};
fc5[fc].xa=function(){fc4.G=this.f;fc4.openSocialSecurityToken=this.a[0];var a=fc4.openSocialSecurityToken;fcj.opensocial[fcka].executeRequests();fcj.opensocial.template.process();if(fc4.apiLoadedCallback){a=fcGa(fc4.apiLoadedCallback,a);fcba(a,0)}};fc9[fc].O=function(a){var b=fcc;for(var c in this.j)if(this.j[c].divId==a){b=this.j[c];break}return b};fc9[fc].C=function(a,b){var c=this.O(a),d=fcc;if(c)d=c.C(b);return d};fc9[fc].B=function(a,b){var c=this.O(a),d=fcc;if(c)d=c.B(b);return d};
fc9[fc].xc=function(a,b){this.Y(function(c){var d=fck.createTextNode("Copy & paste this code into your site.");c.getContentElement()[fcp](d);c.getContentElement()[fcp](fck[fcI]("br"));d=fc4.B(a,b);var e=fck[fcI]("textarea");fcn(e,d);e[fcJ]("style","width:500px;");c.getContentElement()[fcp](e);c.setVisible(fcb)})};
var fcIc=["ar","dv","fa","iw","he","ku","pa","sd","tk","ug","ur","yi"],fcEc=function(a){a=a;var b=fcd;if(a){a=a[fcx]("_")[0];b=fcqb(fcIc,a)}else b=(a=fcZb(fck[fcna],"direction"))&&a=="rtl";return b};fc5[fc].fb=function(a,b){var c=0,d=fcc;try{var e=fc$(this.f),h=fc4.w(e);d=h.secureToken;c=h.communityId}catch(i){}if(b)c=b;fc4.I(a,c,this.callback,d)};
fc9[fc].I=function(a,b,c,d){b=b||this.openSocialSiteId;a={keepMax:fcb,presentation:"canvas",url:fcg+"/friendconnect/gadgets/members.xml",site:b,"view-params":{profileId:a}};if(d)a.securityToken=d;this.eb(a,c)};fc9[fc].Eb=function(a){var b=fcc;if((a=this.O(a))&&a.secureToken)b=a.secureToken;return b};fc9[fc].Db=function(a){var b=fcc;if((a=this.O(a))&&a.communityId)b=a.communityId;return b};
var fcFc=function(a){fc4.G&&fcbc(fc4.G,a)},fcJc=function(){fc5[fc].signout(fc4.openSocialSiteId)},fcKc=function(){fcec(fc4.G)},fcLc=function(a,b){fc9b(a,b)},fcnc=function(){this.o={}};fcnc[fc].register=function(){fce.rpc[fcP]("subscribeEventType",fc5[fc].subscribe);fce.rpc[fcP]("publishEvent",fc5[fc].publish)};fc5[fc].subscribe=function(a){var b=fcCc;b.o[a]=b.o[a]||[];a=b.o[a];a[a[fcr]]={frameId:this}};fcnc[fc].gb=function(a,b,c){var d=this;d.o[b]=d.o[b]||[];b=d.o[b];b[b[fcr]]={container:a,callback:c}};
fc5[fc].publish=function(a){var b=fcCc,c=0;if(this.f)c=fc$(this.f);b.o[a]=b.o[a]||[];b=b.o[a];for(var d=0;d<b[fcr];d++)b[d].container?b[d].callback[fcF](b[d].container,a,c):fce.rpc[fcF](b[d].frameId,a,fcc,a,c)};var fcoc=fcV(fc5[fc].publish,new fc5),fcCc=new fcnc,fc4=new fc9;fc4.Aa(fc4.vb);fcW("google.friendconnect.container",fc4);fcW("google.friendconnect.container.refreshGadgets",fc4.T);fcW("google.friendconnect.container.setParentUrl",fc4.W);fcW("google.friendconnect.container.setServerBase",fc4.X);
fcW("google.friendconnect.container.setServerVersion",fc4.vc);fcW("google.friendconnect.container.createGadget",fc4.M);fcW("google.friendconnect.container.openLightboxIframe",fc4.F);fcW("google.friendconnect.container.renderGadget",fc4.H);fcW("google.friendconnect.container.render",fc4.render);fcW("google.friendconnect.container.goBackToSite",fc4.Mb);fcW("google.friendconnect.container.renderMembersGadget",fc4.ic);fcW("google.friendconnect.container.renderReviewGadget",fc4.kc);
fcW("google.friendconnect.container.renderCommentsGadget",fc4.ra);fcW("google.friendconnect.container.renderSignInGadget",fc4.Xa);fcW("google.friendconnect.container.renderFriendBar",fc4.hc);fcW("google.friendconnect.container.renderSocialBar",fc4.ua);fcW("google.friendconnect.container.renderCanvasSignInGadget",fc4.gc);fcW("google.friendconnect.container.renderUrlCanvasGadget",fc4.lc);fcW("google.friendconnect.container.renderEmbedSignInGadget",fc4.ta);
fcW("google.friendconnect.container.renderUrlEmbedGadget",fc4.Ya);fcW("google.friendconnect.container.renderEmbedGadget",fc4.sa);fcW("google.friendconnect.container.renderWallGadget",fc4.mc);fcW("google.friendconnect.container.renderAdsGadget",fc4.fc);fcW("google.friendconnect.container.renderOpenSocialGadget",fc4.jc);fcW("google.friendconnect.container.setNoCache",fc4.bb);fcW("google.friendconnect.container.enableProxy",fc4.Ga);fcW("google.friendconnect.container.setDomain",fc4.rc);
fcW("google.friendconnect.container.setLockedDomainSuffix",fc4.uc);fcW("google.friendconnect.container.setLocale",fc4.tc);fcW("google.friendconnect.container.loadOpenSocialApi",fc4.Vb);fcW("google.friendconnect.container.initOpenSocialApi",fc4.ma);fcW("google.friendconnect.container.getOpenSocialApiIframeId",fc4.Ib);fcW("google.friendconnect.container.setApiVersion",fc4.pc);fcW("google.friendconnect.container.getEmbedUrl",fc4.C);fcW("google.friendconnect.container.getEmbedHtml",fc4.B);
fcW("google.friendconnect.container.getGadgetSecurityToken",fc4.Eb);fcW("google.friendconnect.container.getGadgetCommunityId",fc4.Db);fcW("google.friendconnect.container.showEmbedDialog",fc4.xc);fcW("google.friendconnect.container.showMemberProfile",fc4.I);fcW("google.friendconnect.requestSignIn",fcFc);fcW("google.friendconnect.requestSignOut",fcJc);fcW("google.friendconnect.requestSettings",fcKc);fcW("google.friendconnect.requestInvite",fcLc);fcW("google.friendconnect.renderSignInButton",fcGc);
fcW("google.friendconnect.container.invokeOpenSocialApiViaIframe",fc4.Pb);fcW("google.friendconnect.container.removeOpenSocialApiViaIframe",fc4.ec);fcW("google.friendconnect.userAgent.WEBKIT",fcbb);fcW("google.friendconnect.userAgent.IE",fcY);fcW("google.friendconnect.PeopleSelectorOnChange",fcHc);fcW("google.friendconnect.container.setDateStamp_",fc4.qc);
google.friendconnect.container.setServerBase('http://www.a.friendconnect.gmodules.com/ps/');google.friendconnect.container.setServerVersion('0.546.6');google.friendconnect.container.setApiVersion('0.8');
google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/activities.xml', 'http://q8j0igk2u2f6kf7jogh6s66md2d7r154.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/ads.xml', 'http://t767uouk8skpac15v8ue0n16regb3m2t.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/ask.xml', 'http://uofgf6lm45rimd9jp6hn983ul6n2en81.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/friendbar.xml', 'http://p7rjrrl49ose4gob99eonlvp0drmce3d.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/content_reveal.xml', 'http://n0mc7q283f00tpk3uifa7sjv4hmrults.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/chat.xml', 'http://4mmefl67as0q39gf1o4pnocubqmdgei0.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/donate.xml', 'http://7v4nflqvq38notsghmcr5a9t6o9g6kn4.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/lamegame.xml', 'http://ffbrstu9puk7qmt45got9mqe5k7ijrs4.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/map.xml', 'http://k0dfp8trn0hi5d2spmo7jmc88n6kr1cc.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/members.xml', 'http://r1rk9np7bpcsfoeekl0khkd2juj27q3o.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/newsletterSubscribe.xml', 'http://k830suiki828goudg9448o6bp0tpu5r3.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/poll.xml', 'http://1ivjd75aqp679vbgohjv74tlhn13rgdu.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/recommended_pages.xml', 'http://iqavu79a908u5vcecp0pq80hhbhkv33b.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/review.xml', 'http://r85jiaoot111joesr8bilfhfeslcc496.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/sample.xml', 'http://785aoao97uti9iqffknjp5e0kn2ljlm4.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/signin.xml', 'http://8fkcem1ves287v3g5lu9gep1j91p3kk1.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/wall.xml', 'http://o29lt44ell30t7ljcdfr8lq2mjakv2co.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setDomain('http://www.google.com/friendconnect/gadgets/osapi-0.8.xml', 'http://mc8tdi0ripmbpds25eboaupdulritrp6.a.friendconnect.gmodules.com/ps/');

google.friendconnect.container.setLockedDomainSuffix('.a.friendconnect.gmodules.com/ps/');
window['__ps_loaded__'] = true; 
 }google.friendconnect_ = google.friendconnect;
google.friendconnect.container.setDateStamp_('128703acd5b');

/* _script/search */



function submitGoogle(theForm) {
	theForm.ie.disabled=theForm.oe.disabled=theForm.hl.disabled=theForm.q.disabled=theForm.meta.disabled=theForm.num.disabled=theForm.lr.disabled=false; 
	theForm.mslul.disabled=theForm.erk.disabled=true; 
	theForm.q.value=theForm.erk.value+" site:www.tora.us.fm"; 
	theForm.action="http://www.google.co.il/search"; 
	theForm.submit(); 
	theForm.mslul.disabled=theForm.erk.disabled=false;
	theForm.ie.disabled=theForm.oe.disabled=theForm.hl.disabled=theForm.q.disabled=theForm.meta.disabled=theForm.num.disabled=theForm.lr.disabled=true;
}

function submitFindPsuq(theForm) {
	theForm.action=path_from_site_to_cgi + "/../_script/findpsuq.php"; 
	//theForm.mslul.value = "tnk1/_magr/psuqim_gross.csv";
	theForm.mslul.disabled=true; 
	theForm.submit();
}


function submitFind(theForm) {
	theForm.action= '../tnk1/mftx.php'; 
	theForm.mslul.value = site.replace(/nxt/,"tnk1");
	theForm.submit();
}

function submitFindTaconite(theForm) {
	baseurl = '../tnk1/mftx.php?site=tnk1&erk=' + theForm.erk.value + '&format=';
	if (typeof new_window=='undefined' || !new_window) {
		url = baseurl + "taconite";
		$.get(url); //Create AjaxRequest object

		$("#searchresults_anchor").show();
		$(".dor2").hide();
		$("#searchresults_anchor").siblings().show();
	}
	else {
		url = baseurl + "html";
		window.open(url);
	}
}

function goSfrPrq(sfr, prq) {
	if (sfr.length>0)
		top.location.href = "http://tora.us.fm/tnk1/prqim/t"+sfr+prq+".htm";
}



var values = Array (1,2,3,4,5,6,7,8,9,10,20,20,30,40,40,50,50,60,70,80,80,90,90,100,200,300,400);
var letters1 = 'אבגדהוזחטי'.split('');
var letters2 = 'יכלמנסעפצק'.split('');
var letters3 = 'קרשת'.split('');
function number2hebrew(num) {
	heb = "";
	while (num > 400) {
		heb += "ת";
		num -= 400;
	}
	if (num >= 100) {
		heb += letters3[ Math.floor(num / 100) - 1 ];
		num %= 100;
	}
	if (num >= 10) {
		if (num == 15) {
			heb += "טו";
			num = 0;
		}
		else if (num == 16) {
			heb += "טז";
			num = 0;
		}
		else {
			heb += letters2[ Math.floor(num / 10) - 1 ];
			num %= 10;
		}
	}
	if (num >= 1) {
		heb += letters1[ num - 1 ];
	}
	
	return heb;
}




function setPrq(sfrIndex, prqElement) {
	prqElement.options.length=0;
	if (sfrIndex<=0) return;

	var kmuyot_prqim = new Array(50,40,27,36,34,24,21,31,24,22,25,66,52,48,14,4,9,1,4,7,3,3,3,2,14,3,29,36,150,42,31,4,8,12,5,10,12,10,13);
	var kmut_prqim = kmuyot_prqim[sfrIndex-1];

	prqElement.options[0] = new Option("-", "");
	for (var i=1; i<=kmut_prqim; ++i) {
		var kotrt = number2hebrew(i);
		var ktovt = (
			i<10? "0"+i:
			i<100? i:
			i<110? "a"+(i-100): 
			i<120? "b"+(i-110): 
			i<130? "c"+(i-120): 
			i<140? "d"+(i-130): 
			i<150? "e"+(i-140): 
			i<160? "f"+(i-150): "");
		prqElement.options[i] = new Option(kotrt, ktovt);
	}
}



/* _script/etc */


path_from_document_to_scripts = path_from_document_to_site + '../_script/';

use_richtext_for_adding_text = false;

select_other_versions = 
	!/\/t0/.test(path_from_root_to_document) && 
	!/\/index/.test(path_from_root_to_document) && 
	1;

var gfc_skin = {};
gfc_skin['BORDER_COLOR'] = '#cccccc';
gfc_skin['ENDCAP_BG_COLOR'] = '#ddffcc';
gfc_skin['ENDCAP_TEXT_COLOR'] = '#333333';
gfc_skin['ENDCAP_LINK_COLOR'] = '#990033';
gfc_skin['ALTERNATE_BG_COLOR'] = '#ffffff';
gfc_skin['CONTENT_BG_COLOR'] = '#ffffff';
gfc_skin['CONTENT_LINK_COLOR'] = '#990033';
gfc_skin['CONTENT_TEXT_COLOR'] = '#333333';
gfc_skin['CONTENT_SECONDARY_LINK_COLOR'] = '#990033';
gfc_skin['CONTENT_SECONDARY_TEXT_COLOR'] = '#666666';
gfc_skin['CONTENT_HEADLINE_COLOR'] = '#333333';

initRTE(
	path_from_document_to_scripts+"rteimages/", 
	path_from_document_to_scripts,
	'', //path_from_document_to_site+"_themes/klli.css",
	false);


var SUBSEQUENT_CLICKS_TO_EDIT = 10;


var lang = document.body.lang;

function initialLanguage() {
	// language-string may be set by the search string (i.e. ...html?en or ...html?he)
	if (location.search == '?en' || location.search == '?he')
		languageString = location.search.replace(/^\?+/,"^");
	else {
		languageString = getCookie('language');
		if (languageString.length<=1)
			languageString = '^' + document.body.lang;
		if (languageString.length<=1)
			languageString = '^he';          // default value
	}
	setCookie('language', languageString, 30, '/');
	return languageString;
}

function setLanguage(theNewLanguage) {
	showSingleLanguage(theNewLanguage);
	setCookie('language', theNewLanguage, 365, '/');
	theTguvotHeading = document.getElementById('tguvot');
	newTguvotHeading1 = "<span lang='he' xml:lang='he'>תגובות</span> <span lang='en' xml:lang='en'>Replies</span>";
	newTguvotHeading2 = "<span lang='he' xml:lang='he'>תת-נושאים</span> <span lang='en' xml:lang='en'>Subjects</span>";
	if (theNewLanguage == '^he') {
		lang = 'he';
		lang_direction = document.body.dir = 'rtl';
		if (theTguvotHeading) {
			theTguvotHeading.innerHTML = theTguvotHeading.innerHTML.
				replace(/^Replies ?$/,newTguvotHeading1).
				replace(/^Subjects ?$/,newTguvotHeading2);
		}
	}
	else if (theNewLanguage == '^en') {
		lang = 'en';
		lang_direction = document.body.dir = 'ltr';
		if (theTguvotHeading) {
			theTguvotHeading.innerHTML = theTguvotHeading.innerHTML.
				replace(/^תגובות ?$/,newTguvotHeading1).
				replace(/^תת-נושאים ?$/,newTguvotHeading2);
		}
	}
	addVersionsByStyle(lang);
	addVersionsByLanguage(lang);
	addVersionsByContent(lang);
}



function text2HTML(theText) {
	theText = theText.
		replace(/(http:\/\/[^ \r\n\t()<>{}]+)/gi, "<a href='$1'>$1</a>").
		replace(/\cM/g, "").
		replace(/\n\n/g, "</p><p>").
		replace(/\n/g, "<br />").
		replace(/&lt;/gi, "<").
		replace(/&gt;/gi, ">").
		replace(/&quot;/gi, "\"").
		replace(/^(<p>)+/,"").
		replace(/(<\/p>)+$/,"");
	if (theText.length>0)
		return "<p>" + theText + "</p>";
	else
		return "";
}


var theTosft, theBnim, theTokn, theTguvot, theTguvotHeading, theTitle, documentHasEditableParts, documentHasExecutableParts;
function getContentElements() { // called in "tguva" 
	theTosft = document.getElementById('tosft');
	theBnim = document.getElementById('ulbnim');
	theTokn = document.getElementById('tokn');
	theTguvot = document.getElementById('ultguvot');
	theTguvotHeading = document.getElementById('tguvot');
	theTitle = document.getElementById('h1');

	documentHasEditableParts = (theTokn && theTguvot) || theBnim;
	documentHasExecutableParts = false;       // might be changed in getCodeElements
}

var theAddForm, theEditForm, theButtons;  // updated in "tguva" 
function getFormElements() { // called in "tguva" 
	theAddForm = document.getElementById('addform');
	theEditForm = document.getElementById('editform');
	theButtons = document.getElementById('buttons');
}


function disableHiddenRTEs() {
	var vRTEs = allRTEs.split(";");
	for(var i=vRTEs.length-1; i>=0; --i) {
		$('hdn'+vRTEs[i]).attr("disabled", "disabled");
		$('size'+vRTEs[i]).attr("disabled", "disabled");
		//document.getElementById('hdn'+vRTEs[i]).disabled = true;
		//document.getElementById('size'+vRTEs[i]).disabled = true;
	}
}












var lastClickTime = new Date();
var clickCount = 0;

function countSubsequentClicks() {
    var now = new Date();
    var difference = now.getTime() - lastClickTime.getTime();
    if (difference <= 300)
       ++clickCount;
    else
       clickCount=1;
    lastClickTime = now;
    return clickCount;
}

function toggleEdit(eventObject) {
    count = countSubsequentClicks();
    if (count==SUBSEQUENT_CLICKS_TO_EDIT) {
       clickType=(navigator.appName=="Netscape")? eventObject.which: event.button;
       if (theEditForm.style.display=='none')
          showEdit('editwithbuttons');
       else
          hideEdit();
    }
}





function authorLink (authorname, authoremail, authoremailserver) {
	return authorname + " (<a href='mailto:" + authoremail + "@" + authoremailserver + "?subject=" + title_without_quotes.replace(/ /g,"_") + "'>" + authoremail + "@" + authoremailserver + "</a>)";
}

function linkToOtherVersion(params, pdf) {
	var script = (pdf? "printpdf.php": "print.php");
	var current_params = (/print[.]php/.test(location.href)?
		(location.search.substr(1)):
		('lang=' + lang + 
		(theLang2? '&lang2=' + theLang2: '') + 
		'&ktovt=' + path_from_root_to_document));
	if (pdf)
		current_params = current_params.replace(/numbering=[^&]+/,"");
	return path_from_document_to_scripts + script + '?' + current_params + "&" + params;
}


function linkToOtherLanguages() {
	var theText = '';
	theText += "<div class='versionlink'>";
	if (theLang2) {
		theText += "<a lang='en' class='lang' dir='ltr' href='javascript:setLanguage(\"^he\")'>עברית</a>&nbsp;";
		theText += "<a lang='he' class='lang' dir='rtl' href='javascript:setLanguage(\"^en\")'>English</a>&nbsp;";
		theText += "<a class='lang' dir='rtl' href='javascript:setLanguage(\"^(he|en)\")'>English+עברית</a>&nbsp;";
	}
	theText += "</div>";
	return theText;
}


function emptyVersionSelector(id) {
	theText = '<div class="versionselector"><select size="1" id="' + id + '" onchange="if (selectedIndex>0) location.href=this.value">'; // + 

	theText += '</select></div>';
	return theText;
}

function hide_old_idfields() {
	try {hide('idfields');} catch (e) {};
}

function kotrt() {

	if (/צחור/.test(theAuthor) || /אביתר/.test(theAuthor))  {
		google_ad_client = "pub-4131841895603404";
		/* 728x90, נוצר 11/05/08 */
		google_ad_slot = "5267744417";
		google_ad_width = 728;
		google_ad_height = 90;
		document.write('<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>');
	}

	var theText="";
	if (theReceiver=='סגלות משלי') {
		theText += ("<p class='sgulot'>" + 
			"<a href='http://stores.lulu.com/erel'>" +
			"<img src='/tnk1/ktuv/mjly/mdrik/thumbnail2.png' alt='סגולות משלי' title='מתוך הספר סגולות משלי'/>" +
			"</a>" +
			"</p>");
	}

	// add a header, if it doesn't exist yet
	theText += ("<h1 id='h1'>" + document.title + "</h1>\n");
	if (document.getElementById("h1")) {
		hide("h1");
	}

	hide_old_idfields();

	if (site=="tnk1") {
		theText += "<a href='"+path_from_document_to_root+site+"/index.html'>"+"<img class='logo' title='חזרה לדף הראשי' alt='חזרה לדף הראשי' src='" + path_from_document_to_root + site + "/_themes/logo_small.gif' /></a>";
		hideByClass('link_to_homepage');
	}
	
	theText += "<div id='visible_idfields'>\n";
	if (theAuthor.length>1 && !/erelsgl|brain/.test(path_from_root_to_document) && !(site == "horsha")) {
		if ((theAuthor=="אראל" || theAuthor=="אראל סגל"))
			authorForTitle = bilingual(lang,theLang2,"span",authorLink("אראל סגל, ללא הסמכה לפסיקת הלכה, לא עצבני, לא עיתונאי", "erelsgl","gmail.com"),"Erel Segal");
		else if (/erel/i.test(theAuthor)) 
			authorForTitle = bilingual(lang,theLang2,"span","אראל סגל","Erel Segal");
		else if ("רענן" == theAuthor || /רענן אייכלר/.test(theAuthor))
			authorForTitle = authorLink("רענן אייכלר", "raananyosef","yahoo.com");
		else if ("צחור" == theAuthor)
			authorForTitle = authorLink("צחור", "the.tzahor","gmail.com");
		else if ("אביגיל גוטליב" == theAuthor)
			authorForTitle = authorLink("אביגיל גוטליב", "avigaelgotlib", "walla.com")
		else if ("יעל פרקל" == theAuthor)
			authorForTitle = authorLink("יעל פרקל", "syaelp","t2.technion.ac.il");
		else if (/אביהו/.test(theAuthor) && /איתן/.test(theAuthor))
			authorForTitle = authorLink("שלח: אביהו איתן חדד", "eitan-avioh","iec.co.il");
		else if (/ירון תאנה/.test(theAuthor))
			authorForTitle = authorLink("ירון תאנה", "yaront","kibbutzmerav.co.il");
		else if (/משה בלידשטיין/.test(theAuthor))
			authorForTitle = authorLink("משה בלידשטיין", "moblid","gmail.com");
		else if (/אברהם בן עזרא/.test(theAuthor))
			authorForTitle = authorLink("ד'ר אברהם בן עזרא", "bezra","inter.net.il");
		else if (/חגי רפי/.test(theAuthor) || /רפאל בר אשר חגבי/.test(theAuthor) )
			authorForTitle = authorLink("רפאל בר אשר חגבי - חגי רפי", "Hagay_r","tahal.com");
		else if ("אביתר"==theAuthor || "אביתר כהן"==theAuthor )
			authorForTitle = authorLink("<a href='http://www.google.co.il/search?hl=iw&q=\"מאת+אביתר\"+site:www.tora.us.fm&meta=&ie=windows-1255&oe=windows-1255&num=100'>אביתר כהן</a>", "evycohen","walla.com");
		else if (/אליהו מאלי/.test(theAuthor))
			authorForTitle = ("הרב אליהו מאלי <p style='font-weight:bold; color:#080'>מותר להעתיק שלא למטרות מסחריות</p>");
		else if (/יוסף פריאל/.test(theAuthor))
			authorForTitle = authorLink ("יוסף פריאל","priel9","biu.013.net.il");
		else
			authorForTitle = theAuthor;

		theText += (
			bilingual(lang,theLang2, "span", "מאת: ", "By: ") +
			authorForTitle);
		
		if (document.body.className == "dmwt") {
			theText += ("<br />" + "מימון: " + "אראל");
		}
	}

	if (theReceiver.length>0) {
		if (theReceiver=='סגלות משלי') {
			theText += ("<br />" + "מתוך הספר " + 
				"<a href='http://stores.lulu.com/erel'>סְגֻלּוֹת מִשְׁלֵי</a>");
		} else {
			theReceiver = theReceiver.replace(/כפית( של נח.?ת)?/, "כפית של <a href='nachat.ipaper.co.il'>נח\"ת</a>");
			if (!/פו\'\'ס/.test(theReceiver) && !/ננ\'\'נ/.test(theReceiver) )
				theText += ("<br />" + 
					bilingual(lang,theLang2, "span", "אל: ", "To: ") +
					theReceiver);
		}
	}

	if (/jdl.*Mefar/.test(path_from_root_to_document))   theText += ('<p>מהדורה אלקטרונית זו של פירושי שד"ל מוקדשת לעילוי נשמתו של ד"ר שלמה א. נכון (ליוורנו, תרס"ו - ירושלים, תשל"ד), גואלם ומוציאם לאור של פירושי שד"ל בימינו. כל הזכויות שמורות למשפחה.');

	theText += "</div>\n";

	// add links to other versions (languages, printer friendly, all replies, etc)
	if (select_other_versions) {
		theText += "<table class='versionselectors'>\n<tr>\n" + 
			"<td>" + emptyVersionSelector('versionsByStyle') + "</td>\n" + 
			"<td>" + emptyVersionSelector('versionsByLanguage') + "</td>\n" + 
			"<td>" + emptyVersionSelector('versionsByContent') + "</td>\n" + 
		"</tr>\n</table>\n";
	}
	document.write(theText);
}

function currentVersionIsFormal() {
	return !(/\d\d\d\d\d\d\d\d\d\d\d\d/.test(document.URL) || /-open/.test(document.URL));
}


function linkToFormalVersion() {
	return  " " + 
		"<a href='" + path_from_document_to_document + siomt + "'>" + 
		(lang=='en'? "Click here to view the formal version of this document": "לחצו כאן כדי לראות את הגירסה הרשמית של הדף") + 
		"</a> ";
}

function linksToOtherVersions() {
	document.write("<div id='formerversions' class='formerversions'>\n");

	server_version="c";
	if (/http:/.test(document.URL) && currentVersionIsFormal() && !/compact|csv_ezor[.]p/.test(document.URL)) {
		document.write("</div>\n");

		/*
		google.friendconnect.container.renderOpenSocialGadget(
		{ id: 'formerversions',
		url: 'http://tora.us.fm/quest/gfc/serve.xml?'+server_version+'&mslul='+encodeURIComponent('_script/versionlist.php?versionlist=short&lang='+lang+'&followup='+path_from_root_to_document),
		site: '11268733983612202568'},
		gfc_skin);
		*/

		
		theText += (
			'<iframe width="100%" height="42" src="' +
			path_from_document_to_root +
			'_script/versionlist.php?versionlist=short&lang='+
			lang +
			'&followup='+path_from_root_to_document+
			'"></iframe>');
		
	} else if (!/compact|csv_ezor[.]p/.test(document.URL)) {
		if (currentVersionIsFormal()) {
			document.write(lang=='en'? 'This is the <b>formal version</b> of the document, last updated at ': 'זוהי <b>הגרסה הרשמית</b> של הדף, שעודכנה לאחרונה ב-');
			document.write(document.lastModified + '. ');
		} else {
			document.write
			(lang=='en'? 'This is a non-formal version of the document, created ': 'זוהי גירסה לא רשמית של הדף, שנוצרה ' );
			document.write(document.lastModified + '. ');
			document.write(linkToFormalVersion());
		}
		document.write("</div>\n");
	} // end of "if http..."
}

function addVersionsByLanguage(lang) {
	var theVersionSelector = document.getElementById('versionsByLanguage');
	if (!theVersionSelector) return;
	if (theLang2) {
		var i = theVersionSelector.options.length = 0;
		theVersionSelector.options[i++] = new Option('* ... שפה language ... *'  , '');
		if (lang=='en')
			theVersionSelector.options[i++] = new Option('עברית',
				'javascript:setLanguage("^he")');
		else
			theVersionSelector.options[i++] = new Option('English',
				'javascript:setLanguage("^en")');
		theVersionSelector.options[i++] = new Option('עברית + English',
			'javascript:setLanguage("^(he|en)")');
		theVersionSelector.style.display = "";
	}
	else
		theVersionSelector.style.display = "none";
}


function addVersionsByStyle(lang) {
	var theVersionSelector = document.getElementById('versionsByStyle');
	if (!theVersionSelector) return;
	var i = theVersionSelector.options.length = 0;
	theVersionSelector.options[i++] = new Option( (lang=='en'? '* select style... *': '* בחר סגנון... *'), '');

	theVersionSelector.options[i++] = new Option( (lang=='en'? "book print": "הדפסה לספר"), linkToOtherVersion("style=print&toclevel=1&pagebreaklevel=1"));

	theVersionSelector.options[i++] = new Option( (lang=='en'? "compact print": "הדפסה חסכונית"), linkToOtherVersion("style=print+compact"));

	if (document.body.dir=='ltr') { // ... because princexml can't handle rtl docs
		theVersionSelector.options[i++] = new Option( (lang=='en'? "book pdf": "pdf לספר"), linkToOtherVersion("style=print&toclevel=1&pagebreaklevel=1","pdf"));
		theVersionSelector.options[i++] = new Option( (lang=='en'? "compact pdf": "pdf צפוף"), linkToOtherVersion("style=print+compact","pdf"));
	}

	theVersionSelector.style.display = (theVersionSelector.options.length<2? "none": "");
}


function addVersionsByContent(lang) {
	var theVersionSelector = document.getElementById('versionsByContent');
	if (!theVersionSelector) return;
	var i = theVersionSelector.options.length = 0;
	theVersionSelector.options[i++] = new Option( (lang=='en'? '* select content... *': '* בחר תוכן... *'), '');
	if (site=='za') {
			theVersionSelector.options[i++] = new Option(
				"Zooogi formal document - HTML",
				linkToOtherVersion("followuplevel=99&toclevel=99&pagebreaklevel=0&style=print+compact"));
			theVersionSelector.options[i++] = new Option(
				"Zooogi formal document - Word",
				linkToOtherVersion("followuplevel=99&toclevel=99&pagebreaklevel=0&style=print+compact&editor=Word&output=" + path_from_root_to_document + "_word&lang=en&lang2="));
			theVersionSelector.options[i++] = new Option(
				"Zooogi formal document - PDF",
				linkToOtherVersion("followuplevel=99&toclevel=99&pagebreaklevel=1&style=print&lang=en&lang2=","pdf"));
	}
	if (/ktuv\/mjly\//.test(path_from_root_to_document) || /msr/.test(path_from_root_to_document) || /0smx/.test(path_from_root_to_document)) {
			var followuplevel = (/mdrik$/.test(path_from_root_to_document)? "2": "1");
			var filebreaklevel = followuplevel-1;
			var timelimit =  (/mdrik$/.test(path_from_root_to_document)? "0": "30");
			//alert(followuplevel);
			theVersionSelector.options[i++] = new Option(
				"מדריך משלי לחיים - גרסת רשת מלאה",
				linkToOtherVersion("followuplevel="+followuplevel+"&toclevel="+followuplevel+"&pagebreaklevel=1&databaselevel=50&style=print+compact&internallinks=1&author=אראל&timelimit="+timelimit));
			/*theVersionSelector.options[i++] = new Option(
				"מדריך משלי לחיים - גרסת התמל",
				linkToOtherVersion("followuplevel="+followuplevel+"&toclevel="+followuplevel+"&pagebreaklevel=1&databaselevel=50&style=print+compact&internallinks=1&author=אראל&timelimit=30&output=html"));*/
			theVersionSelector.options[i++] = new Option(
				"מדריך משלי לחיים - גרסת וורד",
				linkToOtherVersion("followuplevel="+followuplevel+"&toclevel="+followuplevel+"&pagebreaklevel=1&filebreaklevel="+filebreaklevel+"&databaselevel=50&style=print+compact&internallinks=1&author=אראל&timelimit="+timelimit+"&output=word&editor=Word"));
			/*theVersionSelector.options[i++] = new Option(
				"מדריך משלי לחיים - גרסת הדפסה מלאה משמאל לימין",
				linkToOtherVersion("followuplevel=99&toclevel=99&pagebreaklevel=1&databaselevel=50&style=print","pdf"));*/
	}
	// add "show all replies" option if relevant:
	followups = theTguvot? theTguvot.innerHTML: theBnim? theBnim.innerHTML: "";
	if (followups.length>15) {
		theVersionSelector.options[i++] = new Option( (lang == 'en'? "all sub-articles, numbered": "כל תת-המאמרים, ממוספרים"), linkToOtherVersion("followuplevel=99&numbering=(%d)%20"));
		
		if (theAuthor && theAuthor.length>0 && followups.indexOf(theAuthor)>0) {
			var theLabel = (lang == 'en'? "all sub-articles of ": "כל תת-המאמרים של ") + theAuthor;

			theVersionSelector.options[i++] = new Option( 
				theLabel,
				linkToOtherVersion("followuplevel=99&author="+encodeURI(theAuthor)));
		}
		
		theVersionSelector.options[i++] = new Option( (lang == 'en'? "2 levels sub-articles": "שתי רמות של תת-מאמרים"), linkToOtherVersion("followuplevel=2"));
	}
	theVersionSelector.style.display = (theVersionSelector.options.length<2? "none": "");
}

function uriOfGoogleSearchResults(query) {
	return "http://www.google.co.il/search?hl=iw&q=" + 
		query.replace(/ /g,"+") + 
		"+site:www.tora.us.fm" + 
		"&meta=&ie=windows-1255&oe=windows-1255&num=100";
}

function linkToGoogleSearchResults(query) {
	return "<a href='" + 
		uriOfGoogleSearchResults(query) + 
		"'>" + 
		query.replace(/\"/g,'') +
		"</a>";
}


function txtit() {

	document.write("</div><div style='clear:both'>");   // close the outside div and open a new div, to prevent "blinking"
	document.write("<hr />");

	linksToOtherVersions();
	if (select_other_versions) {
		addVersionsByStyle(lang);
		addVersionsByLanguage(lang);
		addVersionsByContent(lang);
	}

	theText = ("<div class='txtit'>");

	if (/אראל/.test(theAuthor))
		theText += ("<br />ניתן להעתיק ולהשתמש בדף זה באופן חופשי, על-פי תנאי הרשיון של קרן התוכנה החופשית (שב<a href='"+path_from_document_to_site+"../rjyon.html'>קישור</a>)");
	if (!/compact/.test(location.href)) {
		if (theAuthor.length>0 || (theReceiver.length>0 && !/[@]/.test(theReceiver)) )
			theText += (lang=='en'? "<br />more articles:&nbsp;&nbsp;&nbsp;" :"<br />קראו מאמרים נוספים:&nbsp;&nbsp;&nbsp; ");
		if (theAuthor.length>0) {
			theAuthorWithoutParens = theAuthor.
				replace(/ ?\(.*\)/,'').
				replace(/^ע["]?פ /, '');
			theText += linkToGoogleSearchResults('"מאת ' + theAuthorWithoutParens + '"') + '&nbsp;&nbsp;&nbsp; ';
			if (/ /.test(theAuthorWithoutParens)) {
				theAuthorFirstWord = theAuthorWithoutParens.replace(/ .*$/,'');
				theText += linkToGoogleSearchResults('"מאת ' + theAuthorFirstWord + '"') + '&nbsp;&nbsp;&nbsp; ';
			}
		}
		if (theReceiver.length>0 && !/[@]/.test(theReceiver)) {
			theReceiverWithoutParens = theReceiver.replace(/ ?\(.*\)/,'');
			theText += linkToGoogleSearchResults('"אל ' + theReceiverWithoutParens + '"') + '&nbsp;&nbsp;&nbsp; ';
			if (/ /.test(theReceiverWithoutParens)) {
				theReceiverFirstWord = theReceiverWithoutParens.replace(/ .*$/,'');
				theText += linkToGoogleSearchResults('"אל ' + theReceiverFirstWord + '"') + '&nbsp;&nbsp;&nbsp; ';
			}
		}

		if (site=='tnk1' || site=='tryg') {
			theText += " <br />" + "<a href='http://he.wikisource.org/wiki/" + 
				path_from_root_to_document.replace(/.html?/,"") +
				"'>" +
				"ויקי טקסט" +
			"</a>";
		}
		/*	
		theText += " <br />" + (lang=='en'? "Document validity check: ": "בדיקת תקינות המסמך: ") + 
		"<a href='http://validator.w3.org/check/referrer?outline=1'>" + "html" + "</a> " + 
		"<a href='http://validator.w3.org/checklink/checklink?uri=" + encodeURI(document.URL) + "'>" + "link" + "</a> " + 
		"<a href='http://jigsaw.w3.org/css-validator/validator?uri=" + encodeURI(document.URL) + "'>" + "css" + "</a>"; 
		*/
	}
	
	if (/findpsuq[.]/.test(location.href)) {
		absolute_document_url_to_display = location.href;
	}
	else {
		absolute_document_url_to_display = absolute_document_url;
	}
	theText += (" <br /> " + 
	(lang=='en'? "The internet address of this document is": "דף זה נמצא ברשת בכתובת") +
	 ": <a dir='ltr' href='" + absolute_document_url_to_display  + "'>" + absolute_document_url_to_display   + "</a>");
	theText += (" <br />" + site_name + ": <a dir='ltr' href='" + absolute_site_url + "'>" + absolute_site_url + "</a>");
	theText += ("</div>");

	document.write(theText);
}


function LI2P(html) {
	return document.all? html: 
	html.replace(/<li[^>]*>/ig,"<p>(*)").replace(/<\/li>/ig,"").replace(/<\/p>/ig,"");
}

function P2LI(html) {
	result = document.all? 
		html: 
		html.
			replace(/<span[^>]*>\s*<\/span>/ig,"").
			replace(/<span>([^<]*)<\/span>/ig,"$1").
			replace(/<span[^>]*>\s*<\/span>/ig,"").
			replace(/<span>([^<]*)<\/span>/ig,"$1").
			replace(/<\/?p[^>]*>\s*[(][*][)]/ig,"</li><li>").
			replace(/(<br[^>]*>\s*)+[(][*][)]/ig,"</li><li>").
			replace(/^\s*[(][*][)]/ig,"</li><li>").
			replace(/^\s*<\/li>/ig,"").
			replace(/<\/?p[^>]*>/ig,"").
			replace(/<br[^>]*>/ig,"");
		if (/<li/.test(result))
			result += "</li>";
	return result;
}


function standardizeHTMLTokn(theHTML) {
	theText = theHTML.
	/* add newline before a start-tag (except an underline and a super/subscript) */
		replace(/(<[^uU\/!])/ig,"\r\n$1").
		replace(/\r\n(<su[bp]>)/ig,"$1").
	/* add space after an end-tag (except an underline and a subscript) */
		replace(/(<\/[^uUaA>][^>]*>)/ig,"$1 ").
		replace(/(<\/su[bp]>) /ig,"$1").
	/* move space from end of tags to after the tags */
		replace(/ (<\/[^>]*>)/ig,"$1 ").
		replace(/ (<\/[^>]*>)/ig,"$1 ").
		replace(/ (<\/[^>]*>)/ig,"$1 ").
	/* remove links and meta-tags that somehow get into the text (through word, for example) */
		replace(/<link[^>]*>/ig,"").
		replace(/<meta[^>]*>/ig,"").
	/* replace deprecated elements with styles */
		replace(/<u>([^<]*)<\/u>/ig,"<span class='u'>$1</span>").
		replace(/(<\/sub>) /ig,"$1").
		replace(/<o:p>\s*<\/o:p>/ig,"").
	/* remove unneeded properties (added by "Word") */
		replace(/<o:p>\s*<\/o:p>/ig,"").
		replace(/<\/?o:p>/ig,"").
		replace(/ class=MsoNormal[a-z]*/ig,"").
		replace(/mso-[^ ">]*:\s*[^ ">]*/ig,"").
		replace(/margin[^ ">]*:\s*[^ ">]*/ig,"").
		replace(/style=[\"\'][\"\']/ig,"").
		replace(/TEXT-INDENT: -[0-9a-z.]*/ig,"").
	/* remove unneeded properties (added by "Visual Studio") */
		replace(/href=\"vid:/ig,"href=\"").
		replace(/margin[^ ">]*:\s*[^ ">]*/ig,"").
		replace(/style=[\"\'][\"\']/ig,"").
	/* remove unneeded properties (added by Mozilla) */
		replace(/ wrap=\"\"/ig,"").
		replace(/ class=\"moz-txt-citetags\"/ig,"").
		replace(/ border-collapse:\s*collapse/ig, "").
		replace(/ lang=["']["']/ig, "").
		replace(/ target=["']?_self["']?/ig, "").
	/* remove unneeded spans */
		replace(/<span[^>]*>\s*<\/span>/ig,"").
		replace(/<span>([^<]*)<\/span>/ig,"$1").
		replace(/<span[^>]*>\s*<\/span>/ig,"").
		replace(/<span>([^<]*)<\/span>/ig,"$1").
		replace(/<font[^>]*>\s*<\/font>/ig,"").
		replace(/<a[^>]*>\s*<\/a>/ig,"").
		replace(/<q[^>]*>\s*<\/q>/ig,"").
	/* remove problematic FireFox list elements */
		replace(/<ul>\s*<li>\s*<\/li>\s*<\/ul>/ig,"").  // empty list
		replace(/<\/li>\s*<ul>/ig,"<ul>").                  // list inside list
	/* remove unallowed character-data */
		replace(/(<[oud]l[^>]*>\s*)&nbsp;/ig,"$1").
		replace(/(<\/li[^>]*>\s*)&nbsp;/ig,"$1").
	/* remove unallowed tags */
		replace(/<p>\s*(<\/[^p])/ig,"$1").
	/* create small text: replace "[[...]]" with "<small>...</small>" */
		replace(/\[\[/ig, "<small>").
		replace(/\]\]/ig, "<\/small>").
	/* remove unneeded parts of a link */
		replace(/(\.htm)\?[^\"\'<>]*/ig,"$1").
	/* fix span direction (for bidi text) */
		//replace(/(<p[^>]*>\s*)(<B[^>]*>\s*)*(<span[^>]*>\s*)*(<span[^>]*)dir=...([^>]*>)/ig,"$1$2$3$4$5").
		replace(/(<p[^>]*>)([^א-ת]*)(<span[^>]*)dir=\"?...\"?([^>]*>)/ig,"$1$2$3$4").
		replace(/(<li[^>]*>)([^א-ת]*)(<span[^>]*)dir=\"?...\"?([^>]*>)/ig,"$1$2$3$4").
	/* remove unneeded newlines */
		replace(/\r\n(\r\n)+/ig, "\r\n").
		replace(/^\r\n/ig, "").
		replace(/\r\n$/ig, "").
		replace(/(<br[^>]*>\s*)(<br[^>]*>\s*)+/ig, "<p>").
	/* remove unneeded comments */
		replace(/<!--[a-z]-->/ig, "").
	/* correct links */
		replace(/tnk\//ig, "tnk1/").
	/* close tags*/
		replace(/<p>\s*(<[hpou])/ig,"<p />$1").
		replace(/<(hr[^>]*)>/ig, "<$1 />").
		replace(/<(br[^>]*)>/ig, "<$1 />").
		replace(/<(input[^>]*)>/ig, "<$1 />").
		replace(/<(img[^>]*)>/ig, "<$1 />");
	return theText;
}

function standardizeHTMLTguvot(theHTML) {
	return P2LI(theHTML).
		replace(/^<ul>((.|\r|\n)*)<\/ul>$/i,"$1").
		replace(/[\r\n]/ig,"").
		replace(/(<[!][-][-]top:)/ig,"\r\n$1").
		replace(/(<li[^>]*>)/ig,"\r\n$1").
		replace(/[(]<[!][-][-]responses:[^>]+>\d+[)]/ig,"").
		replace(/<span> ?<\/span>/ig,"").
		replace(/(<ul><[!][-][-]insert:)/ig,"\r\n$1").
		replace(/(<\/ul><[!][-][-]end:)/ig,"\r\n$1").
		replace(/\r\n(\r\n)+/ig, "\r\n").
		replace(/^\r\n/ig, "").
		replace(/\r\n$/ig, "");
}

function standardizeHTMLToknAndTguvot(toknHTML, tguvotHTML) {
	return "<div id='tokn'>\r\n" + 
		standardizeHTMLTokn(toknHTML) + "\r\n" +
		"</div><!-" + "-tokn-->" + "\r\n" + 
		"<h2 id='tguvot'>" + theTguvotHeading.innerHTML + "</h2>\r\n\r\n" + 
		"<ul id='ultguvot'>\r\n" + 
		standardizeHTMLTguvot(tguvotHTML) + "\r\n" +
		"</ul><!-" + "-end-->\r\n\r\n";
}

function standardizeHTMLBnim(bnimHTML) {
	return 	"<ul id='ulbnim'>\r\n" + 
		standardizeHTMLTguvot(bnimHTML) + "\r\n" +
		"</ul><!--end-->\r\n\r\n";
}

function standardizeHTMLTosftAndBnim(tosftHTML, bnimHTML) {
	return 	"<!--tosft0--><div id='tosft'>\r\n" +
		standardizeHTMLTokn(tosftHTML) + "\r\n" +
		"</div><!--tosft1-->\r\n"+
		standardizeHTMLBnim(bnimHTML);
}


function standardizeHTML() {
	if (theTokn && theTguvot) {
		return standardizeHTMLToknAndTguvot(theTokn.innerHTML, theTguvot.innerHTML);
	}
	else if (theBnim && theTosft) {
		return standardizeHTMLTosftAndBnim(theTosft.innerHTML, theBnim.innerHTML);
	}
	else if (theBnim) {
		return standardizeHTMLBnim(theBnim.innerHTML);
	}
	else {
		alert('התגלתה תקלה במבנה המסמך. נא להודיע למנהל האתר!');
	}
}

function standardizeHTMLRTE() {
	if (theTokn && theTguvot) {
		updateRTE('ToknRTE');
		updateRTE('TguvotRTE');
		return standardizeHTMLToknAndTguvot(document.getElementById('hdnToknRTE').value, document.getElementById('hdnTguvotRTE').value);
	}
	else if (theBnim && theTosft) {
		updateRTE('ToknRTE');
		updateRTE('TguvotRTE');
		return standardizeHTMLTosftAndBnim(document.getElementById('hdnToknRTE').value, document.getElementById('hdnTguvotRTE').value);
	}
	else if (theBnim) {
		updateRTE('TguvotRTE');  
		return standardizeHTMLBnim(document.getElementById('hdnTguvotRTE').value);
	}
	else {
		alert('התגלתה תקלה במבנה המסמך. נא להודיע למנהל האתר!');
	}
}


function hideEdit() {
	if (document.all) {
		//hide(theEditForm);
		hide('editform');
	}
	else {
		//hide(theEditForm);     // This causes a BUG in RTE on Firefox
		hide('helpedit');
		showHideRTE('ToknRTE', 'hide');
		showHideRTE('TguvotRTE', 'hide');
		theEditForm.style.visibility = 'hidden';
		//theEditForm.style.position = 'absolute';
		//theEditForm.style.left = "-10000px";
		//theEditForm.style.top = "-10000px";
	}
}

function showAdd(theForm) {
	if (!theAddForm) return;
	show(theAddForm);
	hideEdit(theEditForm);
	hide('addtext');
	hide('addlink');
	hide('addfile');
	show(theForm);

	if (!theAddForm.bodyclass.options) return;
	theAddForm.bodyclass.length = 0;
	
	i = 0;
	theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? '* add what? *': '* מה להוסיף? *'), '');
	if (theForm == 'addtext') {
		theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'reply': 'תגובה'), 'tguva');
		theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'new article': 'מאמר חדש'), 'newarticle');
		theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'new subject': 'נושא חדש'), 'newsubject');
		theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'question': 'שאלה'), 'la_gmwr');
		theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'sticky message': 'הודעה חשובה'), 'hodaa');
		theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'executable function': 'פונקציה ניתנת להרצה'), 'jsfunction');
		if (/^js/.test(path_from_root_to_document)) {
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'Javascript algorithm': 'אלגוריתם בשפת javascript'), 'jsalgorithm');
		}
		if (/tnk1.ljon.jorj/.test(path_from_root_to_document)) {
			theAddForm.bodyclass.options[i++] = new Option('הגדרה', 'hgdrh');
			theAddForm.bodyclass.options[i++] = new Option('הבדל', 'hbdl');
		}
		if (/tnk1/.test(path_from_root_to_document)) {
			theAddForm.bodyclass.options[i++] = new Option('מאמר דמיוני', 'hpwk');
			theAddForm.bodyclass.options[i++] = new Option('שיר', 'jyr');
		}
		if (/tryg.mcwa/.test(path_from_root_to_document)) {
			theAddForm.bodyclass.options[i++] = new Option('הגדרה', 'hgdrh');
			theAddForm.bodyclass.options[i++] = new Option('טעם', 'fem');
		}

		if (use_richtext_for_adding_text) {
			setRTE('NewRTE', '...');
			returnRTE('NewRTE').document.body.dir = document.body.dir;
			//setRTESize('NewRTE', 180, 360);
		}
	}
	else if (theForm == 'addfile') {
		if (documentHasExecutableParts) {
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'input file - requires password': 'קובץ קלט - דורש סיסמה'), 'inputfile');
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'other file': 'קובץ אחר'), 'file');
		}
		else {
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'image': 'ציור או צילום'), 'image');
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'tab-seperated text': 'טבלה בקובץ טקסט'), 'magr');
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'other file': 'קובץ מסוג אחר'), 'file');
		}
	}
	else {
		if (documentHasExecutableParts) {
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'link to an input file - requires password': 'קישור לקובץ קלט  - דורש סיסמה'), 'inputlink');
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'link to another code file to use - requires password': 'קישור לקובץ קוד אחר כדי להשתמש בפונקציות שלו'), 'uselink');
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'other link': 'קישור אחר'), 'link');
		}
		else {
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'link to a file in this site': 'קישור למאמר באתר זה'), 'internallink');
			theAddForm.bodyclass.options[i++] = new Option( (lang=='en'? 'link to a file in another site': 'קישור למאמר באתר אחר'), 'externallink');
		}
	}
}



function pausecomp(millis)
{
date = new Date();
var curDate = null;

do { var curDate = new Date(); }
while(curDate-date < millis);
}


function minmax(val, min, max) {
	return val<min? min: val>max? max: val;
}

function fixRTEAppearance() {
	returnRTE('ToknRTE').document.body.dir = returnRTE('TguvotRTE').document.body.dir = document.body.dir;

	var width = theTokn? theTokn.clientWidth: 0.9*document.body.clientWidth;
	var height1 = theTokn? 360: theTosft? Math.min(theTosft.clientHeight+20,360):   0;
	var height2 = theBnim? 360: theTguvot?  Math.min(theTguvot.clientHeight+20,360): 0;

	if (!isIE) {
		setRTESize('ToknRTE', width, height1);
		setRTESize('TguvotRTE', width, height2);
	}
}

function fixTokn() {
	t = theTokn.innerHTML;
	i = t.indexOf("<h2 id=\"tguvot");
	if (i>0)
		t = t.substr(0,i);
	return t.replace(/<!--tokn-->/ig,"").replace(/<!--end-->/ig,"");
}



function copyTextareasToHtml(html) {
	var codeAreas = document.getElementsByTagName("textarea");
	for (var i=0; i<codeAreas.length; ++i) {
		var codeArea = codeAreas[i];
		if (codeArea.id.length>0) {
			var regexp = new RegExp("(<textarea[^>]*id=['\"]?" + codeArea.id + "['\"]?[^>]*>)([^<>]|\r|\n)*<\/textarea>", "ig");
			html = html.replace(regexp, "$1" + codeArea.value + "</textarea>");
		}
	}
	return html;
}


function showEdit(theForm) {
	if (theAddForm) {
		theAddForm.qijur.disabled = true;
		theAddForm.jm_qovc_al_hlqox.disabled = true;
		hide(theAddForm);
	}
	if (document.all) {
		 show(theEditForm);     
	} else {
		show('helpedit');     
		showHideRTE('ToknRTE', 'show');
		showHideRTE('TguvotRTE', 'show');     
		theEditForm.style.visibility = 'visible';
	//	theEditForm.style.position = '';
	//	theEditForm.style.left = "auto";
	//	theEditForm.style.top = "auto";
	}

	if (theTokn)
		setRTE('ToknRTE', copyTextareasToHtml(fixTokn()));
	else if (theTosft) 
		setRTE('ToknRTE', theTosft.innerHTML);

	if (theTguvot)
		setRTE('TguvotRTE', LI2P(theTguvot.innerHTML));
	else if (theBnim)
		setRTE('TguvotRTE', LI2P(theBnim.innerHTML));

	fixRTEAppearance();
	show('editwithbuttons');
}


function removeHTMLColor (theHTML) {
   return theHTML.
      replace(/<TD.*?>/ig, "<TD>").
      replace(/<FONT.*?>/ig, "").
      replace(/<\/FONT>/ig, "").
      replace(/font-family:[^;\"\' >]*[;]?/ig, "").
      replace(/font-size:[^;\"\' >]*[;]?/ig, "").
      replace(/color:[^;\"\' >]*[;]?/ig, "").
      replace(/background:[^;\"\' >]*[;]?/ig, "").
      replace(/moz-.*?:[^;\"\' >]*[;]?/ig, "");

}


help_en = '<li>To delete the document, insert the text "delete me" anywhere in the document. ';

help_he = '<li>כדי למחוק את המסמך, הכניסו את הטקסט "למחיקה" במקום כלשהו במסמך.'+
	'<li>ניתן להשתמש במקשי-עריכה: <STRONG>Ctrl+B להדגשה</STRONG>, <EM>Ctrl+I להטיה</EM>, <U>Ctrl+U לקו-תחתי</U>, <a href="javascript:alert(\'Ctrl+K = הוספת קישור\')">Ctrl+K להוספת קישור</a>' +
	'<li>ניתן לערוך ב"וורד" או בתוכנה אחרת, ואז להעתיק ולהדביק כאן.' + 
	'<li>להוספת ציור או צילום יש שתי אפשרויות: <ul>' + 
	'<li>אם הציור נמצא באינטרנט - פשוט סמנו אותו בעזרת העכבר, העתיקו (Ctrl+C) והדביקו (Ctrl+V). זהירות - אל תפגעו בזכויות יוצרים!' + 
	'<li>אם הציור נמצא על המחשב שלכם - לחצו על "הוסף קובץ" והוסיפו את הציור שלכם לאתר, ואז תוכלו לסמן אותו להעתיק ולהדביק באותו אופן.</ul>' + 
	'לאחר שמדביקים את הציור במסמך, ניתן להקליק עליו ואז לשנות את גודלו ע"י משיכת הריבועים הלבנים הקטנים שמקיפים אותו.<ul>'; + 
	'';

help = "&nbsp;<div></div><div id='helpedit'>" + 
	bilingual(lang,theLang2,"ul",help_he,help_en)+ 
	"</div>";



origSubjectInput = '<input type=hidden name="origsubject" value="' + title_without_quotes + '">';


function setRewriteTitle(theForm) {
  if (theTitle) {
      theForm.title.value = theTitle.innerHTML;
      if (theForm.title.value.replace(/<[^>]*>/g,"") == document.title)
         theForm.titlechanged.disabled = true;
      else {
         theForm.titlechanged.disabled = false;
         theForm.titlechanged.value = "1";
      }
   }
}


function submitOrDebug(text) {
	if (/^file:/.test(location.href)) {
		alert(text);
		return false;
	}
	if (text == null) {
		alert ("הטקסט ריק! אנא הודיעו למנהל האתר!");
		return false;
	}
	if (text.length == 0) {
		alert ("הטקסט השתבש! אנא הודיעו למנהל האתר!");
		return false;
	}
	
	return true;
}



function onSubmitAdd(theForm) {
	if (theForm.username.value && theForm.title.value && (!passwordIsRequired || theForm.password.value)) {
		if (use_richtext_for_adding_text) {
			updateRTE('NewRTE');
			theForm.body.value = document.getElementById('hdnNewRTE').value;
		}
		else {
			theForm.body.value = text2HTML(theForm.body.value);
		}
	}
}

function onSubmitEdit(theForm) {
	setRewriteTitle(theEditForm); 
	theForm.content.value=standardizeHTMLRTE();
	return submitOrDebug(theForm.content.value); 
}

function renderMembersGadget() {
	gfc_skin['HEIGHT'] = '200';
	
	google.friendconnect.container.renderMembersGadget(
	{ id: 'members_gadget',
	site: '11268733983612202568',
	locale: 'il'},
	gfc_skin);
}

function renderSigninGadget() {
	gfc_skin['HEIGHT'] = '200';
	
	google.friendconnect.container.renderSignInGadget(
	{ id: 'signin_gadget',
	site: '11268733983612202568',
	locale: 'il'},
	gfc_skin);
}

function old_tguva() {
		server_version="c";
		google.friendconnect.container.setParentUrl('/' /* location of rpc_relay.html and canvas.html */);
		if (theTvnit.length<=0) {
			document.write('<div id="rate_gadget"></div>\n');
			document.write('<div style="clear:both"></div>');

			gfc_skin['DEFAULT_COMMENT_TEXT'] = '- \u05d4\u05d5\u05e1\u05d9\u05e4\u05d5 \u05d4\u05e2\u05e8\u05d4 \u05d7\u05d3\u05e9\u05d4 -';
			gfc_skin['HEADER_TEXT'] = '\u05d3\u05d9\u05e8\u05d5\u05d2\u05d9\u05dd';
			gfc_skin['POSTS_PER_PAGE'] = '20';

			google.friendconnect.container.renderReviewGadget(
			{ id: 'rate_gadget',
			site: '11268733983612202568',
			'view-params':{"disableMinMax":"false","scope":"PAGE","startMaximized":"true"}
			},
			gfc_skin);
		} else { // theTvnit.length>0
			document.write('<div dir="rtl" id="addtext_gadget">\n</div>\n');
			document.write('<div dir="ltr" id="members_gadget">\n</div>\n');

			document.write('<div style="clear:both"></div>');
	
			google.friendconnect.container.renderOpenSocialGadget(
			{ id: 'addtext_gadget',
			url: 'http://tora.us.fm/quest/gfc/serve.xml?'+server_version+'&mslul=_script/gfc_addtext.php',
			site: '11268733983612202568',
			locale: 'il'},
			gfc_skin);

			renderMembersGadget();
		}
}

function tguva () {
	//ktov_tqla();
	//return;

	getContentElements();
	if (/ברוריה/.test(theAuthor)) {
		document.write('<div style="font-style:italic">ניתן ליצור קשר עם הכותבת דרך <a href="http://www.mycreation.co.il" target="_blank">האתר שלה</a>.</div>');
	} else {
		if (!theTvnit.length)
			document.write("<iframe class='tguvot' width='100%' src='"+path_from_document_to_scripts+"tguva.php?followup="+path_from_root_to_document+"'></iframe>");
		//else
		//	old_tguva();
	}


	if (theTvnit == "0") {
		teur1 = "לחצו כאן כדי להוסיף לאתר דף חדש שהגולשים יוכלו להגיע אליו מהדף הראשי.";
	} else if (theTvnit.length>0) {
		teur1 = "אם כתבתם מאמר שקשור ל"+document.title+", אתם מוזמנים לשים אותו כאן; אם יש לכם שאלה על דף זה (לא שאלה הלכתית) אתם מוזמנים לשאול אותה כאן";
	} else {
		teur1 = "אם יש לכם תגובה על "+document.title+", אתם מוזמנים לשים אותה כאן; אם יש לכם שאלה על דף זה (לא שאלה הלכתית) אתם מוזמנים לשאול אותה כאן";
	}

	document.write("<div id='buttonGroup'>");
	document.write(buttonGroup(
	   (theTvnit.length>0? "showAdd('addtext');theAddForm.qijur.disabled=true;theAddForm.jm_qovc_al_hlqox.disabled=true;": ""),
	   bilingual(lang, theLang2, "span", "הוסף דף חדש או תגובה", "Add a new page or reply"),
	   (lang=='en'? '': teur1),

	   (theTvnit.length>0? "showAdd('addlink');theAddForm.qijur.disabled=false;theAddForm.jm_qovc_al_hlqox.disabled=true;": ""),
	   bilingual(lang, theLang2, "span", "הוסף קישור", "add hyperlink"),
	   (lang=='en'? '': 'אם מצאתם באינטרנט מאמר או אתר שקשור ל'+document.title+', אתם מוזמנים לשים כאן קישור. <small>אפשר להוסיף גם קישור למאמר שנמצא באתר זה.</small>'),

	   (theTvnit.length>0? "showAdd('addfile');theAddForm.qijur.disabled=true;theAddForm.jm_qovc_al_hlqox.disabled=false;": ""),
	   bilingual(lang, theLang2, "span", "הוסף ציור, צילום או קובץ אחר", "add image or another file"),
	   (lang=='en'? '': 'אם יש לכם קובץ שקשור ל'+document.title+' (ציור, מצגת, שיר...) אתם מוזמנים לשים אותו כאן'),

	   (documentHasEditableParts? "showEdit('editwithbuttons')": ""),
	   bilingual(lang, theLang2, "span", "עצב דף זה", "edit with style"),
	   (lang=='en'? '': 'אם אתם רוצים להוסיף צבעים, כותרות, רשימות או עיצובים אחרים - לחצו כאן')
	) + "\n\n");
	document.write("</div><!--buttonGroup-->");

	if (theTvnit.length>0) {
		document.write(formHeader('addform', '', path_from_document_to_scripts + 'rewrite.php?to=add')+idFields(path_from_root_to_document,usernameHint,passwordHint,emailHint)+
			'<p>'+
			bodyclassInput+
			titleInputVisible+
			languageInputVisible+
			authorInputVisible+
			origSubjectInput);

		if (theTvnit=='0') {
			document.write(
				"<div id='addtext'>\n" + 
				"</div>\n");
		} else {
			document.write(
				"<div id='addtext'>\n" + 
					(lang=='en'? '': '<p><B>תנאי שימוש</B>: הטופס מיועד לתגובות ענייניות בלבד. ביטויי לעג וזלזול יימחקו ללא אזהרה. לחיצה על כפתור "שליחה" מהווה הסכמה לתנאי זה.') + 
					(lang=='en'? '<h3>Content (text and hyperlinks)</h3>': '<h3>תוכן (טקסט וקישורים):</h3>') + 

					(theTvnit.length>0? "<p><textarea id='addtext_body' name='body' cols='50' rows='10'></textarea></p>\n": "") );
			//SYNTAX: writeRichText(rte,    html, css, width,     height,   buttons,readOnly, full)

			if (use_richtext_for_adding_text) {
				writeRichText('NewRTE',   '',   '',  150, 300, true, false, false);
				hide('addtext_body');
			}
			document.write(
				"</div>\n");
		}

		document.write(
			"<div id='addfile'>\n"+
				(lang=='en'? "<h3>A file from your computer</h3>": "<h3>קובץ מהמחשב שלכם</h3>")+
				"<p><input type='file' name='jm_qovc_al_hlqox' size='40' onmouseout='if(jm_qovc_al_hlqox.value) theAddForm.title.value=fileparse(jm_qovc_al_hlqox.value)[2];'>"+
				"<p><input type='checkbox' name='hxlf_qovc'>" + 
				(lang=='en'? 'replace file if it exists': 'החלף קובץ קיים בשם זה')+
			"</div>\n"+

			"<div id='addlink'>\n"+
				(lang=='en'? "<h3>A hyperlink</h3>\n": "<h3>קישור חיצוני לאתר ברחבי הרשת</h3>\n")+
				"<p><input type='text' name='qijur' dir='ltr' value='http://' size='45' /></p>\n"+
			"</div>\n"+

			(theTvnit=='0'?
				"<input name='add' type='submit' value='"+submitLabel+"'  onclick=''>":
				"<input name='add' type='submit' value='"+submitLabel+"' onclick='onSubmitAdd(this.form)'>") +
			(lang=='en'? "Please be patient, your reply will be posted in a few minutes": 
			"התגובה תופיע באתר תוך מספר דקות. אנא התאזרו בסבלנות! אם התגובה לא נשלחת - אנא כתבו דואל למנהל האתר")+

		"</form>\n");
	} else {
		//document.write("<form id='addform'></form>");
		theAddForm = null;
	}

	document.write(formHeader('editform', 'rewrite_result_frame', path_from_document_to_scripts + 'rewrite.php?to=rewrite')+idFields(path_from_root_to_document,usernameHint,passwordHint)+
		titleInputHidden+languageInputHidden+
		"<textarea style='display:none' name='content' rows='40' cols='80'></textarea>");
	if (documentHasEditableParts) {
		document.write("<div id='editwithbuttons'>" + 
			(lang=='en'? '<h3>Edit</h3>': '<h3>עריכה</h3>')+
			(lang=='en'? '<p>edit the text below, fill in your details, and push ': '<p>ערכו את המסמך למטה, מלאו את פרטיכם ולחצו על ') + 
			'"' + saveLabel + '"' + 
			"");
			document.writeln("<p dir='ltr'><a target='_blank' href='http://www.kevinroth.com/rte/'>Rich Text Editor by Kevin Roth</a>, <a target='_blank' href='http://richtext.cabspace.com/'>Fork by Timothy S. Bell</a></p>");
			//SYNTAX: writeRichText(rte,    html, css, width,     height,   buttons,readOnly, full)
			var width = theTokn? theTokn.clientWidth: 0.9*document.body.clientWidth;
			var height1 = theTokn? 360: theTosft? Math.max(theTosft.clientHeight,20): 0;
			var height2 = theTguvot? Math.max(theTguvot.clientHeight,20): theBnim? 360: 0;

			writeRichText('ToknRTE',   '',   '',  width, height1, (theTokn || theTosft)? true: false, false, false);
			if (!(theTokn || theTosft)) showHideRTE('ToknRTE','hide');

			if (theTokn&&theTguvot) document.write("<h2 id='TguvotRTE_heading'>" + theTguvotHeading.innerHTML + '</h2>');

			writeRichText('TguvotRTE', '',   '',  width, height2, (theTguvot || theBnim)? true: false, false, false);

			if (!(theTguvot || theBnim)) showHideRTE('TguvotRTE','hide');
		document.write(
			'<p>' + 
			'<iframe src="about:blank" width="100%" height="100px" name="rewrite_result_frame" id="rewrite_result_frame" ></iframe>' + 
			'</p>' + 
			'<p>' + 
			"<input accesskey='ד' type='submit' name='rewrite' value='" + saveLabel + "' onclick='onSubmitEdit(this.form)'>"+ " " + 
			'<input type=button onclick="document.getElementById(\'ToknRTE\').contentWindow.document.body.innerHTML=removeHTMLColor(document.getElementById(\'ToknRTE\').contentWindow.document.body.innerHTML);return false;" value="'+formatLabel+'">' + ' ' +
			"</p></div>\n");
		disableHiddenRTEs();
	}

	document.write(help);
	document.write('</form>');

	getFormElements();

	if (theTvnit.length>0)
		hide('addform');

	if (document.all)
		hide('editform');
	else
		hideEdit(); // MISSION IMPOSSIBLE: hide the edit form WITHOUT causing an error in RTE in Mozilla.

	if (theLang2)
		setLanguage(initialLanguage());    // for the selector and the buttons

	document.onclick = toggleEdit;
	document.onmousedown = toggleEdit;
}  // end of function "tguva"



function ktov_whatsnew() {

	//ktov_tqla();
	//return;

	theText = '';
	if (/http:/.test(document.URL)) {
		if (site=='tnk1') {
			theText = 
				"<div style='text-align:center'><div style='margin:0 auto 0 auto'> " + 
				"<iframe height='200' width='100%' src='../_script/display.php?site=" + site + "&file=board&showstart=0&show=9999&expand=0&sort=1&maxtopics=20'></iframe>" + 
				"<br />"+
				//"<iframe height='200' width='100%' src='../_script/display.php?site=" + site + "&file=whatsnew&showstart=0&expand=0&maxtopics=40'>    </iframe>" + 
				"</div></div>";
		}
		else {
			theText = 
				"<div style='text-align:center'> <table style='margin:0 auto 0 auto'><TR>" + 
				"<td><iframe width='400' height='200' src='../_script/display.php?site=" + site + "&file=board&showstart=0&show=9999&expand=0&sort=1&maxtopics=20'></iframe></td>&nbsp;" + 
				//"<td><iframe width='400' height='200' src='../_script/display.php?site=" + site + "&file=whatsnew&showstart=0&expand=0&maxtopics=40'></iframe></td>" + 
				"</table> </div>";
		}
	}
	else
		theText = "<p style='text-align: center; margin-left: 2cm; margin-right: 2cm; padding-top: 0.5cm; padding-bottom: 0.5cm'><a href='board.html'>המאמרים האחרונים שנוספו לאתר</a>";
	document.write(theText);
}

function ktov_mftx(current) {
	chars = "אבגדהוזחטיכלמנסעפצקרשת"
	for (ii=10; ii<=31; ++ii) {
		if (ii!=current) document.write("<a href='mftx" + ii + ".html'>");
		document.write(chars.substr(ii-10,1));
		if (ii!=current) document.write("</a>");
		document.write("&nbsp;")
	}
}


/* _script/jquery.taconite */

/*
 * jQuery Taconite plugin - A port of the Taconite framework by Ryan Asleson and
 *     Nathaniel T. Schutta: http://taconite.sourceforge.net/
 *
 * Examples and documentation at: http://malsup.com/jquery/taconite/
 * Copyright (c) 2007-2008 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * Thanks to Kenton Simpson for contributing many good ideas!
 *
 * $Id$
 * @version: 3.03  10/22/2008
 * @requires jQuery v1.2.3 or later
 */

(function($) {

$.taconite = function(xml) { processDoc(xml); };

$.taconite.debug = 0;  // set to true to enable debug logging to Firebug
$.taconite.version = '3.03';
$.taconite.defaults = {
    cdataWrap: 'div'
};

if (typeof $.fn.replace == 'undefined')
    $.fn.replace = function(a) { return this.after(a).remove(); };
if (typeof $.fn.replaceContent == 'undefined')
    $.fn.replaceContent = function(a) { return this.empty().append(a); };

$.expr[':'].taconiteTag = 'a.taconiteTag';

$.taconite._httpData = $.httpData; // original jQuery httpData function

$.httpData = $.taconite.detect = function(xhr, type) {
    var ct = xhr.getResponseHeader('content-type');
    if ($.taconite.debug) {
        log('[AJAX response] content-type: ', ct, ';  status: ', xhr.status, ' ', xhr.statusText, ';  has responseXML: ', xhr.responseXML != null);
        log('type: ' + type);
        log('responseXML: ' + xhr.responseXML);
    }
    var data = $.taconite._httpData(xhr, type); // call original method
    if (data && data.documentElement) {
        var root = data.documentElement.tagName;
        log('XML document root: ', root);
        if (root == 'taconite') {
            log('taconite command document detected');
            $.taconite(data);
        }
    }
    else { 
        log('jQuery core httpData returned: ' + data);
        log('httpData: response is not XML (or not "valid" XML)');
    }
    return data;
};

$.taconite.enableAutoDetection = function(b) {
    $.httpData = b ? $.taconite.detect : $.taconite._httpData;
};

var logCount = 0;
function log() {
    if (!$.taconite.debug || !window.console || !window.console.log) return;
    if (!logCount++)
        log('Plugin Version: ' + $.taconite.version);
    window.console.log('[taconite] ' + [].join.call(arguments,''));
};

function processDoc(xml) { 
    var status = true, ex;
    try {
        $.event.trigger('taconite-begin-notify', [xml])
        status = go(xml); 
    } catch(e) {
        status = ex = e;
    }
    $.event.trigger('taconite-complete-notify', [xml, !!status, status === true ? null : status]);
    if (ex) throw ex;
};

function go(xml) {
    var trimHash = { wrap: 1 };

    if (typeof xml == 'string')
        xml = convert(xml);
    if (!xml || !xml.documentElement) {
        log('$.taconite invoked without valid document; nothing to process');
        return false;
    }
    try {
        var t = new Date().getTime();
        // process the document
        process(xml.documentElement.childNodes);
        $.taconite.lastTime = (new Date().getTime()) - t;
        log('time to process response: ' + $.taconite.lastTime + 'ms');
    } catch(e) {
        if (window.console && window.console.error)
            window.console.error('[taconite] ERROR processing document: ' + e);
        throw e;
    }
    return true;
    
    function convert(s) {
        var doc;
        log('attempting string to document conversion');
        try {
            if($.browser.msie) {
                doc = $("<xml>")[0];
                doc.async = 'false';
                doc.loadXML(s);
            }
            else {
                var parser = new DOMParser();
                doc = parser.parseFromString(s, 'text/xml');
            }
        }
        catch(e) {
            if (window.console && window.console.error)
                window.console.error('[taconite] ERROR parsing XML string for conversion: ' + e);
            throw e;
        }
        var ok = doc && doc.documentElement && doc.documentElement.tagName != 'parsererror';
        log('conversion ', ok ? 'successful!' : 'FAILED');
        return doc;
    };

    function process(commands) {
        var doPostProcess = 0;
        for(var i=0; i < commands.length; i++) {
            if (commands[i].nodeType != 1)
                continue; // commands are elements
            var cmdNode = commands[i], cmd = cmdNode.tagName;
            if (cmd == 'eval') {
                var js = (cmdNode.firstChild ? cmdNode.firstChild.nodeValue : null);
                log('invoking "eval" command: ', js);
                if (js) $.globalEval(js);
                continue;
            }
            var q = cmdNode.getAttribute('select');
            var jq = $(q);
            if (!jq[0]) {
                log('No matching targets for selector: ', q);
                continue;
            }
            var cdataWrap = cmdNode.getAttribute('cdataWrap') || $.taconite.defaults.cdataWrap;

            var a = [];
            if (cmdNode.childNodes.length > 0) {
                doPostProcess = 1;
                for (var j=0,els=[]; j < cmdNode.childNodes.length; j++)
                    els[j] = createNode(cmdNode.childNodes[j]);
                a.push(trimHash[cmd] ? cleanse(els) : els);
            }

            // remain backward compat with pre 2.0.9 versions
            var n = cmdNode.getAttribute('name');
            var v = cmdNode.getAttribute('value');
            if (n !== null) a.push(n);
            if (v !== null) a.push(v);

            // @since: 2.0.9: support arg1, arg2, arg3...
            for (var j=1; true; j++) {
                v = cmdNode.getAttribute('arg'+j);
                if (v === null)
                    break;
                a.push(v);
            }

            if ($.taconite.debug) {
                var arg = els ? '...' : a.join(',');
                log("invoking command: $('", q, "').", cmd, '('+ arg +')');
            }
            jq[cmd].apply(jq,a);
        }
        // apply dynamic fixes
        if (doPostProcess) 
            postProcess();
    
        function postProcess() {
            if ($.browser.mozilla) return; 
            // post processing fixes go here; currently there is only one:
            // fix1: opera, IE6, Safari/Win don't maintain selected options in all cases (thanks to Karel Fucםk for this!)
            $('select:taconiteTag').each(function() {
                var sel = this;
                $('option:taconiteTag', this).each(function() {
                    this.setAttribute('selected','selected');
                    this.taconiteTag = null;
                    if (sel.type == 'select-one') {
                        var idx = $('option',sel).index(this);
                        sel.selectedIndex = idx;
                    }
                });
                this.taconiteTag = null;
            });
        };
        
        function cleanse(els) {
            for (var i=0, a=[]; i < els.length; i++)
                if (els[i].nodeType == 1) a.push(els[i]);
            return a;
        };
        
        function createNode(node) {
            var type = node.nodeType;
            if (type == 1) return createElement(node);
            if (type == 3) return fixTextNode(node.nodeValue);
            if (type == 4) return handleCDATA(node.nodeValue);
            return null;
        };
        
        function handleCDATA(s) {
            var el = document.createElement(cdataWrap);
            el.innerHTML = s;
            return el;
        };
        
        function fixTextNode(s) {
            if ($.browser.msie) s = s.replace(/\n/g, '\r').replace(/\s+/g, ' ');
            return document.createTextNode(s);
        };
        
        function createElement(node) {
            var e, tag = node.tagName.toLowerCase();
            // some elements in IE need to be created with attrs inline
            if ($.browser.msie) {
                var type = node.getAttribute('type');
                if (tag == 'table' || type == 'radio' || type == 'checkbox' || tag == 'button' || 
                    (tag == 'select' && node.getAttribute('multiple'))) {
                    e = document.createElement('<' + tag + ' ' + copyAttrs(null, node, true) + '>');
                }
            }
            if (!e) {
                e = document.createElement(tag);
                copyAttrs(e, node, tag == 'option' && $.browser.safari);
            }
            
            // IE fix; colspan must be explicitly set
            if ($.browser.msie && tag == 'td') {
                var colspan = node.getAttribute('colspan');
                if (colspan) e.colSpan = parseInt(colspan);
            }

            // IE fix; script tag not allowed to have children
            if($.browser.msie && !e.canHaveChildren) {
                if(node.childNodes.length > 0)
                    e.text = node.text;
            }
            else {
                for(var i=0, max=node.childNodes.length; i < max; i++) {
                    var child = createNode (node.childNodes[i]);
                    if(child) e.appendChild(child);
                }
            }
            if (! $.browser.mozilla) {
                if (tag == 'select' || (tag == 'option' && node.getAttribute('selected')))
                    e.taconiteTag = 1;
            }
            return e;
        };
        
        function copyAttrs(dest, src, inline) {
            for (var i=0, attr=''; i < src.attributes.length; i++) {
                var a = src.attributes[i], n = $.trim(a.name), v = $.trim(a.value);
                if (inline) attr += (n + '="' + v + '" ');
                else if (n == 'style') { // IE workaround
                    dest.style.cssText = v;
                    dest.setAttribute(n, v);
                }
                else $.attr(dest, n, v);
            }
            return attr;
        };
    };
};

})(jQuery);
